// Class: TribeEndScreen
// Size:  0x488
//
// VTable Layout:
// [00] `scalar_deleting_destructor'
// [01] setup
// [02] set_rect
// [03] set_rect
// [04] set_color
// [05] set_active
// [06] set_positioning
// [07] set_fixed_position
// [08] set_redraw
// [09] set_overlapped_redraw
// [10] draw_setup
// [11] draw_finish
// [12] draw
// [13] draw_rect
// [14] draw_offset
// [15] draw_rect2
// [16] draw_offset2
// [17] paint
// [18] wnd_proc
// [19] handle_idle
// [20] handle_size
// [21] handle_paint
// [22] handle_key_down
// [23] handle_char
// [24] handle_command
// [25] handle_user_command
// [26] handle_timer_command
// [27] handle_scroll
// [28] handle_mouse_down
// [29] handle_mouse_move
// [30] handle_mouse_up
// [31] handle_mouse_dbl_click
// [32] mouse_move_action
// [33] mouse_left_down_action
// [34] mouse_left_hold_action
// [35] mouse_left_move_action
// [36] mouse_left_up_action
// [37] mouse_left_dbl_click_action
// [38] mouse_right_down_action
// [39] mouse_right_hold_action
// [40] mouse_right_move_action
// [41] mouse_right_up_action
// [42] mouse_right_dbl_click_action
// [43] key_down_action
// [44] char_action
// [45] action
// [46] get_true_render_rect
// [47] is_inside
// [48] set_focus
// [49] set_tab_order
// [50] set_tab_order
// [51] get_help_info
// [52] stop_sound_system
// [53] restart_sound_system
// [54] take_snapshot
// [55] handle_reactivate
// [56] draw_background
// [57] set_ideal_size
// [58] create_button
// [59] create_button
// [60] create_check_box
// [61] create_radio_button
// [62] create_text
// [63] create_text
// [64] create_text
// [65] create_input
// [66] create_edit
// [67] create_drop_down
// [68] create_list
// [69] create_scrollbar
// [70] create_auto_scrollbar
// [71] create_vert_slider
// [72] create_horz_slider
// [73] position_panel
// [74] `scalar_deleting_destructor'
// [75] setup
// [76] set_rect
// [77] set_rect
// [78] set_color
// [79] set_active
// [80] set_positioning
// [81] set_fixed_position
// [82] set_redraw
// [83] set_overlapped_redraw
// [84] draw_setup
// [85] draw_finish
// [86] draw
// [87] draw_rect
// [88] draw_offset
// [89] draw_rect2
// [90] draw_offset2
// [91] paint
// [92] wnd_proc
// [93] handle_idle
// [94] handle_size
// [95] handle_paint
// [96] handle_key_down
// [97] handle_char
// [98] handle_command
// [99] handle_user_command
// [100] handle_timer_command
// [101] handle_scroll
// [102] handle_mouse_down
// [103] handle_mouse_move
// [104] handle_mouse_up
// [105] handle_mouse_dbl_click
// [106] mouse_move_action
// [107] mouse_left_down_action
// [108] mouse_left_hold_action
// [109] mouse_left_move_action
// [110] mouse_left_up_action
// [111] mouse_left_dbl_click_action
// [112] mouse_right_down_action
// [113] mouse_right_hold_action
// [114] mouse_right_move_action
// [115] mouse_right_up_action
// [116] mouse_right_dbl_click_action
// [117] key_down_action
// [118] char_action
// [119] action
// [120] get_true_render_rect
// [121] is_inside
// [122] set_focus
// [123] set_tab_order
// [124] set_tab_order
// [125] get_help_info
// [126] stop_sound_system
// [127] restart_sound_system
// [128] take_snapshot
// [129] handle_reactivate
// [130] pick_through_fog
// [131] pick_weight
// [132] start_scroll_view
// [133] handle_scroll_view
// [134] end_scroll_view
// [135] do_paint
// [136] draw_multi_object_outline
// [137] command_place_object
// [138] command_make_do
// [139] command_make_move
// [140] command_make_work
// [141] command_place_multi_object
// [142] `vector_deleting_destructor'
// [143] setup
// [144] set_rect
// [145] set_rect
// [146] set_color
// [147] set_active
// [148] set_positioning
// [149] set_fixed_position
// [150] set_redraw
// [151] set_overlapped_redraw
// [152] draw_setup
// [153] draw_finish
// [154] draw
// [155] draw_rect
// [156] draw_offset
// [157] draw_rect2
// [158] draw_offset2
// [159] paint
// [160] wnd_proc
// [161] handle_idle
// [162] handle_size
// [163] handle_paint
// [164] handle_key_down
// [165] handle_char
// [166] handle_command
// [167] handle_user_command
// [168] handle_timer_command
// [169] handle_scroll
// [170] handle_mouse_down
// [171] handle_mouse_move
// [172] handle_mouse_up
// [173] handle_mouse_dbl_click
// [174] mouse_move_action
// [175] mouse_left_down_action
// [176] mouse_left_hold_action
// [177] mouse_left_move_action
// [178] mouse_left_up_action
// [179] mouse_left_dbl_click_action
// [180] mouse_right_down_action
// [181] mouse_right_hold_action
// [182] mouse_right_move_action
// [183] mouse_right_up_action
// [184] mouse_right_dbl_click_action
// [185] key_down_action
// [186] char_action
// [187] action
// [188] get_true_render_rect
// [189] is_inside
// [190] set_focus
// [191] set_tab_order
// [192] set_tab_order
// [193] get_help_info
// [194] stop_sound_system
// [195] restart_sound_system
// [196] take_snapshot
// [197] handle_reactivate
// [198] draw_background
// [199] set_ideal_size
// [200] create_button
// [201] create_button
// [202] create_check_box
// [203] create_radio_button
// [204] create_text
// [205] create_text
// [206] create_text
// [207] create_input
// [208] create_edit
// [209] create_drop_down
// [210] create_list
// [211] create_scrollbar
// [212] create_auto_scrollbar
// [213] create_vert_slider
// [214] create_horz_slider
// [215] position_panel
//
// Member Layout:
// [0x478] TPicturePanel * background
// [0x47C] TTextPanel * title
// [0x480] TTextPanel * text
// [0x484] TButtonPanel * okButton
// ----------------------------------------------------------------

// Function: TribeEndScreen
// Address: 004936d0
// [HELPER] s_End_Screen: "End Screen"
// [HELPER] s_OK: "OK"
// [HELPER] s_bgA1024: "bgA1024"
// [HELPER] s_bgA640: "bgA640"
// [HELPER] s_bgA800: "bgA800"
TribeEndScreen * __thiscall
TribeEndScreen::TribeEndScreen(TribeEndScreen *this,char *param_1,char **param_2,int param_3)
{
  char cVar1;
  int iVar2;
  int iVar3;
  long lVar4;
  TPicturePanel *pTVar5;
  RGE_Font *pRVar6;
  TTextPanel *pTVar7;
  TDigital *pTVar8;
  TButtonPanel *this_00;
  uint uVar9;
  uint uVar10;
  char *pcVar11;
  char *pcVar12;
  char *pcVar13;
  undefined4 *unaff_FS_OFFSET;
  TTextPanel *local_20;
  char backgroundName [10];
  undefined4 local_c;
  code *pcStack_8;
  int local_4;
  
  local_4 = 0xffffffff;
  pcStack_8 = FUN_0055eb74;
  local_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &local_c;
  backgroundName._0_4_ = this;
  TScreenPanel::TScreenPanel((TScreenPanel *)this,s_End_Screen);
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  lVar4 = TScreenPanel::setup((TScreenPanel *)this,rge_base_game->draw_area,(char *)0x0,0,1);
  if (lVar4 == 0) {
    this->_padding_ = 1;
  }
  else {
    iVar2 = *(int *)(this->_padding_ + 0x18);
    if (iVar2 < 800) {
      pcVar11 = &s_bgA640;
    }
    else {
      pcVar11 = s_bgA800;
      if (0x3ff < iVar2) {
        pcVar11 = s_bgA1024;
      }
    }
    pcVar13 = backgroundName;
    uVar9 = 0xffffffff;
    do {
      pcVar12 = pcVar11;
      if (uVar9 == 0) break;
      uVar9 = uVar9 - 1;
      pcVar12 = pcVar11 + 1;
      cVar1 = *pcVar11;
      pcVar11 = pcVar12;
    } while (cVar1 != '\0');
    uVar9 = ~uVar9;
    pcVar11 = pcVar12 + -uVar9;
    for (uVar10 = uVar9 >> 2; pcVar13 = pcVar13 + 4, uVar10 != 0; uVar10 = uVar10 - 1) {
      *(undefined4 *)pcVar13 = *(undefined4 *)pcVar11;
      pcVar11 = pcVar11 + 4;
    }
    for (uVar9 = uVar9 & 3; uVar9 != 0; uVar9 = uVar9 - 1) {
      *pcVar13 = *pcVar11;
      pcVar11 = pcVar11 + 1;
      pcVar13 = pcVar13 + 1;
    }
    pTVar5 = (TPicturePanel *)operator_new(0x11c);
    local_4._0_1_ = 1;
    if (pTVar5 == (TPicturePanel *)0x0) {
      pTVar5 = (TPicturePanel *)0x0;
    }
    else {
      pTVar5 = (TPicturePanel *)TPicturePanel::TPicturePanel(pTVar5);
    }
    local_4._0_1_ = 0;
    this->background = pTVar5;
    if (pTVar5 == (TPicturePanel *)0x0) {
      this->_padding_ = 1;
    }
    else {
      lVar4 = TPicturePanel::setup
                        (pTVar5,(TDrawArea *)this->_padding_,(TPanel *)this,0,0,0,0,
                         backgroundName + 4,-1,0,1);
      if (lVar4 == 0) {
        this->_padding_ = 1;
      }
      else {
        iVar2 = (this->_padding_ * 0x1e0) / 0x1e0;
        iVar3 = (this->_padding_ * 0x280) / 0x280;
        (**(code **)(this->background->_padding_ + 0x18))(2,0,0,0,0,iVar3,iVar3,iVar2,iVar2,0,0,0,0)
        ;
        pRVar6 = RGE_Base_Game::get_font(rge_base_game,1);
        pTVar7 = (TTextPanel *)operator_new(0x188);
        local_4._0_1_ = 2;
        if (pTVar7 == (TTextPanel *)0x0) {
          local_20 = (TTextPanel *)0x0;
        }
        else {
          local_20 = (TTextPanel *)TTextPanel::TTextPanel(pTVar7);
        }
        local_4._0_1_ = 0;
        this->title = local_20;
        if (local_20 == (TTextPanel *)0x0) {
          this->_padding_ = 1;
        }
        else {
          TTextPanel::setup(local_20,(TDrawArea *)this->_padding_,(TPanel *)this->background,
                            (this->_padding_ * 0x14) / 0x280,(this->_padding_ * 0x14) / 0x1e0,
                            (this->_padding_ * 600) / 0x280,(this->_padding_ * 0x1e) / 0x1e0,
                            pRVar6->font,pRVar6->font_wid,pRVar6->font_hgt,(char *)0x0,0,'\0',0,'\0'
                            ,0,param_1);
          pTVar7 = (TTextPanel *)operator_new(0x188);
          local_4._0_1_ = 3;
          if (pTVar7 == (TTextPanel *)0x0) {
            pTVar7 = (TTextPanel *)0x0;
          }
          else {
            pTVar7 = (TTextPanel *)TTextPanel::TTextPanel(pTVar7);
          }
          local_4._0_1_ = 0;
          this->text = pTVar7;
          if (pTVar7 == (TTextPanel *)0x0) {
            this->_padding_ = 1;
          }
          else {
            pRVar6 = RGE_Base_Game::get_font(rge_base_game,0xb);
            TTextPanel::setup(this->text,(TDrawArea *)this->_padding_,(TPanel *)this->background,
                              (this->_padding_ * 0x14) / 0x280,(this->_padding_ * 0x46) / 0x1e0,
                              (this->_padding_ * 600) / 0x280,(this->_padding_ * 0x154) / 0x1e0,
                              pRVar6->font,pRVar6->font_wid,pRVar6->font_hgt,(char *)0x0,0,'\0',0,
                              '\0',0,(char *)0x0);
            (**(code **)(this->text->_padding_ + 0xe0))(param_2,param_3);
            TTextPanel::set_alignment(this->text,AlignCenter,AlignCenter);
            TTextPanel::scroll(this->text,'\x06',0,1);
            pTVar8 = RGE_Base_Game::get_sound(rge_base_game,0);
            pRVar6 = RGE_Base_Game::get_font(rge_base_game,0);
            this_00 = (TButtonPanel *)operator_new(0x2b8);
            local_4._0_1_ = 4;
            if (this_00 == (TButtonPanel *)0x0) {
              param_1 = (char *)0x0;
            }
            else {
              param_1 = (char *)TButtonPanel::TButtonPanel(this_00);
            }
            local_4 = (uint)local_4._1_3_ << 8;
            this->okButton = (TButtonPanel *)param_1;
            if (param_1 == (char *)0x0) {
              this->_padding_ = 1;
            }
            else {
              TButtonPanel::setup((TButtonPanel *)param_1,(TDrawArea *)this->_padding_,
                                  (TPanel *)this->background,(this->_padding_ * 0xaa) / 0x280,
                                  (this->_padding_ * 0x1ae) / 0x1e0,(this->_padding_ * 300) / 0x280,
                                  (this->_padding_ * 0x28) / 0x1e0,DrawTextA,pTVar8,NotifyAction,0);
              TButtonPanel::set_text_info
                        (this->okButton,s_OK,pRVar6->font,pRVar6->font_wid,pRVar6->font_hgt,-1,-1);
              TPanel::set_curr_child((TPanel *)this,(TPanel *)this->background);
              TPanel::set_curr_child((TPanel *)this->background,(TPanel *)this->text);
            }
          }
        }
      }
    }
  }
  *unaff_FS_OFFSET = local_c;
  return this;
}

// --------------------------------------------------

// Function: `scalar_deleting_destructor'
// Address: 00493be0
void * __thiscall TribeEndScreen::_scalar_deleting_destructor_(TribeEndScreen *this,uint param_1)
{
  ~TribeEndScreen(this);
  if ((param_1 & 1) != 0) {
    operator_delete(this);
  }
  return this;
}

// --------------------------------------------------

// Function: ~TribeEndScreen
// Address: 00493c00
void __thiscall TribeEndScreen::~TribeEndScreen(TribeEndScreen *this)
{
  undefined4 *unaff_FS_OFFSET;
  undefined4 uStack_c;
  code *pcStack_8;
  undefined4 local_4;
  
  pcStack_8 = FUN_0055eb88;
  uStack_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &uStack_c;
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  if (this->title != (TTextPanel *)0x0) {
    (**(code **)this->title->_padding_)(1);
  }
  if (this->text != (TTextPanel *)0x0) {
    (**(code **)this->text->_padding_)(1);
  }
  if (this->okButton != (TButtonPanel *)0x0) {
    (**(code **)this->okButton->_padding_)(1);
  }
  if (this->background != (TPicturePanel *)0x0) {
    (**(code **)this->background->_padding_)(1);
  }
  local_4 = 0xffffffff;
  TScreenPanel::~TScreenPanel((TScreenPanel *)this);
  *unaff_FS_OFFSET = uStack_c;
  return;
}

// --------------------------------------------------

// Function: action
// Address: 00493c90
// [HELPER] s_Achievements_Screen: "Achievements Screen"
// [HELPER] s_End_Screen: "End Screen"
long __thiscall
TribeEndScreen::action
          (TribeEndScreen *this,TPanel *param_1,long param_2,ulong param_3,ulong param_4)
{
  TribeAchievementsScreen *this_00;
  char *pcVar1;
  long lVar2;
  undefined4 *unaff_FS_OFFSET;
  int iVar3;
  undefined4 local_c;
  code *pcStack_8;
  undefined4 local_4;
  
  local_c = *unaff_FS_OFFSET;
  local_4 = 0xffffffff;
  pcStack_8 = FUN_0055ebab;
  *unaff_FS_OFFSET = &local_c;
  if ((param_1 != (TPanel *)0x0) && (param_2 == 1)) {
    this_00 = (TribeAchievementsScreen *)operator_new(0x5f8);
    local_4 = 0;
    if (this_00 != (TribeAchievementsScreen *)0x0) {
      iVar3 = 1;
      pcVar1 = TPanel::get_string((TPanel *)this,0x269e);
      TribeAchievementsScreen::TribeAchievementsScreen(this_00,pcVar1,iVar3);
    }
    local_4 = 0xffffffff;
    TPanelSystem::setCurrentPanel(&panel_system,s_Achievements_Screen,0);
    TPanelSystem::destroyPanel(&panel_system,s_End_Screen);
    *unaff_FS_OFFSET = local_c;
    return 1;
  }
  lVar2 = TEasy_Panel::action((TEasy_Panel *)this,param_1,param_2,param_3,param_4);
  *unaff_FS_OFFSET = local_c;
  return lVar2;
}

// --------------------------------------------------

