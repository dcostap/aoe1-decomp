// Class: TEditPanel
// Size:  0x16C
//
// VTable Layout:
// [00] `vector_deleting_destructor'
// [01] setup
// [02] set_rect
// [03] set_rect
// [04] set_color
// [05] set_active
// [06] set_positioning
// [07] set_fixed_position
// [08] set_redraw
// [09] set_overlapped_redraw
// [10] draw_setup
// [11] draw_finish
// [12] draw
// [13] draw_rect
// [14] draw_offset
// [15] draw_rect2
// [16] draw_offset2
// [17] paint
// [18] wnd_proc
// [19] handle_idle
// [20] handle_size
// [21] handle_paint
// [22] handle_key_down
// [23] handle_char
// [24] handle_command
// [25] handle_user_command
// [26] handle_timer_command
// [27] handle_scroll
// [28] handle_mouse_down
// [29] handle_mouse_move
// [30] handle_mouse_up
// [31] handle_mouse_dbl_click
// [32] mouse_move_action
// [33] mouse_left_down_action
// [34] mouse_left_hold_action
// [35] mouse_left_move_action
// [36] mouse_left_up_action
// [37] mouse_left_dbl_click_action
// [38] mouse_right_down_action
// [39] mouse_right_hold_action
// [40] mouse_right_move_action
// [41] mouse_right_up_action
// [42] mouse_right_dbl_click_action
// [43] key_down_action
// [44] char_action
// [45] action
// [46] get_true_render_rect
// [47] is_inside
// [48] set_focus
// [49] set_tab_order
// [50] set_tab_order
// [51] get_help_info
// [52] stop_sound_system
// [53] restart_sound_system
// [54] take_snapshot
// [55] handle_reactivate
// [56] `scalar_deleting_destructor'
// [57] setup
// [58] set_rect
// [59] set_rect
// [60] set_color
// [61] set_active
// [62] set_positioning
// [63] set_fixed_position
// [64] set_redraw
// [65] set_overlapped_redraw
// [66] draw_setup
// [67] draw_finish
// [68] draw
// [69] draw_rect
// [70] draw_offset
// [71] draw_rect2
// [72] draw_offset2
// [73] paint
// [74] wnd_proc
// [75] handle_idle
// [76] handle_size
// [77] handle_paint
// [78] handle_key_down
// [79] handle_char
// [80] handle_command
// [81] handle_user_command
// [82] handle_timer_command
// [83] handle_scroll
// [84] handle_mouse_down
// [85] handle_mouse_move
// [86] handle_mouse_up
// [87] handle_mouse_dbl_click
// [88] mouse_move_action
// [89] mouse_left_down_action
// [90] mouse_left_hold_action
// [91] mouse_left_move_action
// [92] mouse_left_up_action
// [93] mouse_left_dbl_click_action
// [94] mouse_right_down_action
// [95] mouse_right_hold_action
// [96] mouse_right_move_action
// [97] mouse_right_up_action
// [98] mouse_right_dbl_click_action
// [99] key_down_action
// [100] char_action
// [101] action
// [102] get_true_render_rect
// [103] is_inside
// [104] set_focus
// [105] set_tab_order
// [106] set_tab_order
// [107] get_help_info
// [108] stop_sound_system
// [109] restart_sound_system
// [110] take_snapshot
// [111] handle_reactivate
// [112] set_text
// [113] set_text
// [114] set_text
// [115] set_bevel_info
// [116] `vector_deleting_destructor'
// [117] setup
// [118] set_rect
// [119] set_rect
// [120] set_color
// [121] set_active
// [122] set_positioning
// [123] set_fixed_position
// [124] set_redraw
// [125] set_overlapped_redraw
// [126] draw_setup
// [127] draw_finish
// [128] draw
// [129] draw_rect
// [130] draw_offset
// [131] draw_rect2
// [132] draw_offset2
// [133] paint
// [134] wnd_proc
// [135] handle_idle
// [136] handle_size
// [137] handle_paint
// [138] handle_key_down
// [139] handle_char
// [140] handle_command
// [141] handle_user_command
// [142] handle_timer_command
// [143] handle_scroll
// [144] handle_mouse_down
// [145] handle_mouse_move
// [146] handle_mouse_up
// [147] handle_mouse_dbl_click
// [148] mouse_move_action
// [149] mouse_left_down_action
// [150] mouse_left_hold_action
// [151] mouse_left_move_action
// [152] mouse_left_up_action
// [153] mouse_left_dbl_click_action
// [154] mouse_right_down_action
// [155] mouse_right_hold_action
// [156] mouse_right_move_action
// [157] mouse_right_up_action
// [158] mouse_right_dbl_click_action
// [159] key_down_action
// [160] char_action
// [161] action
// [162] get_true_render_rect
// [163] is_inside
// [164] set_focus
// [165] set_tab_order
// [166] set_tab_order
// [167] get_help_info
// [168] stop_sound_system
// [169] restart_sound_system
// [170] take_snapshot
// [171] handle_reactivate
// [172] set_text
// [173] set_text
// [174] set_text
// [175] set_bevel_info
// [176] `scalar_deleting_destructor'
// [177] setup
// [178] set_rect
// [179] set_rect
// [180] set_color
// [181] set_active
// [182] set_positioning
// [183] set_fixed_position
// [184] set_redraw
// [185] set_overlapped_redraw
// [186] draw_setup
// [187] draw_finish
// [188] draw
// [189] draw_rect
// [190] draw_offset
// [191] draw_rect2
// [192] draw_offset2
// [193] paint
// [194] wnd_proc
// [195] handle_idle
// [196] handle_size
// [197] handle_paint
// [198] handle_key_down
// [199] handle_char
// [200] handle_command
// [201] handle_user_command
// [202] handle_timer_command
// [203] handle_scroll
// [204] handle_mouse_down
// [205] handle_mouse_move
// [206] handle_mouse_up
// [207] handle_mouse_dbl_click
// [208] mouse_move_action
// [209] mouse_left_down_action
// [210] mouse_left_hold_action
// [211] mouse_left_move_action
// [212] mouse_left_up_action
// [213] mouse_left_dbl_click_action
// [214] mouse_right_down_action
// [215] mouse_right_hold_action
// [216] mouse_right_move_action
// [217] mouse_right_up_action
// [218] mouse_right_dbl_click_action
// [219] key_down_action
// [220] char_action
// [221] action
// [222] get_true_render_rect
// [223] is_inside
// [224] set_focus
// [225] set_tab_order
// [226] set_tab_order
// [227] get_help_info
// [228] stop_sound_system
// [229] restart_sound_system
// [230] take_snapshot
// [231] handle_reactivate
// [232] set_font
//
// Member Layout:
// [0x0F4] void * edit_wnd
// [0x0F8] short fixed_len
// [0x0FC] char * text
// [0x100] int text_len
// [0x104] int hidden
// [0x108] void * brush
// [0x10C] int stock_brush
// [0x110] void * old_sub_wnd_proc
// [0x114] ulong text_color1
// [0x118] ulong text_color2
// [0x11C] ulong highlight_text_color1
// [0x120] ulong highlight_text_color2
// [0x124] ulong back_color
// [0x128] FormatType format
// [0x12C] void * font
// [0x130] int multi_line
// [0x134] tagRECT draw_rect (sz: 0x10)
// [0x144] uint draw_format
// [0x148] int auto_sel
// [0x14C] int sel_len
// [0x150] int bevel_type
// [0x154] uchar bevel_color1
// [0x155] uchar bevel_color2
// [0x156] uchar bevel_color3
// [0x157] uchar bevel_color4
// [0x158] uchar bevel_color5
// [0x159] uchar bevel_color6
// [0x15C] int bevel_size
// [0x160] ulong imc
// [0x164] int enable_ime
// [0x168] int turn_ime_on
// ----------------------------------------------------------------

// Function: TEditPanel
// Address: 004755c0
/* public: __thiscall TEditPanel::TEditPanel(void) */

TEditPanel * __thiscall TEditPanel::TEditPanel(TEditPanel *this)
{
  TPanel::TPanel((TPanel *)this);
  this->edit_wnd = (void *)0x0;
  this->text = (char *)0x0;
  this->fixed_len = 0;
  this->brush = (void *)0x0;
  this->old_sub_wnd_proc = (void *)0x0;
  this->text_color1 = 0;
  this->text_color2 = 0;
  this->highlight_text_color1 = 0;
  this->highlight_text_color2 = 0;
  this->back_color = 0;
  this->sel_len = 0;
  this->bevel_color1 = '\0';
  this->bevel_color2 = '\0';
  this->bevel_color3 = '\0';
  this->bevel_color4 = '\0';
  this->bevel_color5 = '\0';
  this->bevel_color6 = '\0';
  this->bevel_size = 0;
  this->imc = 0;
  this->enable_ime = 0;
  this->turn_ime_on = 0;
  this->_padding_ = (int)&_vftable_;
  this->_padding_ = 1;
  this->hidden = 1;
  this->bevel_type = 1;
  return this;
}

// --------------------------------------------------

// Function: `vector_deleting_destructor'
// Address: 00475670
/* public: virtual void * __thiscall TEditPanel::`vector deleting destructor'(unsigned int) */

void * __thiscall TEditPanel::_vector_deleting_destructor_(TEditPanel *this,uint param_1)
{
  ~TEditPanel(this);
  if ((param_1 & 1) != 0) {
    operator_delete(this);
  }
  return this;
}

// --------------------------------------------------

// Function: ~TEditPanel
// Address: 00475690
/* public: virtual __thiscall TEditPanel::~TEditPanel(void) */

void __thiscall TEditPanel::~TEditPanel(TEditPanel *this)
{
  undefined4 *unaff_FS_OFFSET;
  undefined4 uStack_c;
  code *pcStack_8;
  undefined4 local_4;
  
  pcStack_8 = FUN_0055e468;
  uStack_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &uStack_c;
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  if ((this->edit_wnd != (void *)0x0) && (this->hidden == 0)) {
    ShowWindow(this->edit_wnd,0);
    this->hidden = 1;
  }
  if (this->text != (char *)0x0) {
    free(this->text);
    this->text = (char *)0x0;
  }
  if (this->edit_wnd != (void *)0x0) {
    if (this->imc != 0) {
      _ImmNotifyIME_16(this->imc,0x15,4,0);
      if (this->enable_ime != 0) {
        _ImmReleaseContext_8(this->edit_wnd,this->imc);
      }
      this->imc = 0;
    }
    DestroyWindow(this->edit_wnd);
    this->edit_wnd = (void *)0x0;
  }
  local_4 = 0xffffffff;
  TPanel::~TPanel((TPanel *)this);
  *unaff_FS_OFFSET = uStack_c;
  return;
}

// --------------------------------------------------

// Function: setup
// Address: 00475770
// [HELPER] s_edit: "edit"
/* public: long __thiscall TEditPanel::setup(class TDrawArea *,class TPanel
   *,long,long,long,long,void *,short,char *,enum TEditPanel::FormatType,int) */

long __thiscall
TEditPanel::setup(TEditPanel *this,TDrawArea *param_1,TPanel *param_2,long param_3,long param_4,
                 long param_5,long param_6,void *param_7,short param_8,char *param_9,
                 FormatType param_10,int param_11)
{
  long lVar1;
  void *pvVar2;
  char *pcVar3;
  
  this->format = param_10;
  if (0 < param_8) {
    param_8 = param_8 + 1;
  }
  this->fixed_len = param_8;
  this->font = param_7;
  this->auto_sel = param_11;
  lVar1 = TPanel::setup((TPanel *)this,param_1,param_2,param_3,param_4,param_5,param_6,0xff);
  if (lVar1 == 0) {
    return 0;
  }
  pvVar2 = (void *)CreateWindowExA(0,s_edit,0,
                                   (-(uint)(this->format != FormatMultiLine) & 0xffe0003c) +
                                   0x40200044,param_3 + 1,param_4 + 1,param_5 + -2,param_6 + -2,
                                   param_1->Wnd,1,**(undefined4 **)this->_padding_,0);
  this->edit_wnd = pvVar2;
  if (pvVar2 == (void *)0x0) {
    return 0;
  }
  SetWindowLongA(pvVar2,0xffffffeb,this);
  pvVar2 = (void *)GetWindowLongA(this->edit_wnd,0xfffffffc);
  this->old_sub_wnd_proc = pvVar2;
  SetWindowLongA(this->edit_wnd,0xfffffffc,pnl_sub_wnd_proc);
  pcVar3 = (char *)calloc(this->fixed_len + 2,1);
  this->text = pcVar3;
  if (pcVar3 == (char *)0x0) {
    return 0;
  }
  *pcVar3 = '\0';
  this->text_len = 0;
  if ((param_9 != (char *)0x0) && (*param_9 != '\0')) {
    set_text(this,param_9);
  }
  pvVar2 = (void *)GetStockObject(4);
  this->brush = pvVar2;
  this->text_color1 = 0xffffff;
  this->highlight_text_color1 = 0xffffff;
  this->back_color = 0;
  this->text_color2 = 0;
  this->highlight_text_color2 = 0;
  if (this->font != (void *)0x0) {
    SendMessageA(this->edit_wnd,0x30,this->font,0);
  }
  this->draw_format = 0x2000;
  this->draw_format = (-(uint)(this->format != FormatMultiLine) & 0x10) + 0x2010;
  return 1;
}

// --------------------------------------------------

// Function: set_text
// Address: 00475970
/* public: void __thiscall TEditPanel::set_text(char *) */

void __thiscall TEditPanel::set_text(TEditPanel *this,char *param_1)
{
  char cVar1;
  short sVar2;
  uint uVar3;
  char *pcVar4;
  
  if (this->edit_wnd != (void *)0x0) {
    if (param_1 == (char *)0x0) {
      *this->text = '\0';
      this->text_len = 0;
    }
    else {
      sVar2 = this->fixed_len;
      pcVar4 = this->text;
      for (uVar3 = (uint)(int)sVar2 >> 2; uVar3 != 0; uVar3 = uVar3 - 1) {
        pcVar4[0] = '\0';
        pcVar4[1] = '\0';
        pcVar4[2] = '\0';
        pcVar4[3] = '\0';
        pcVar4 = pcVar4 + 4;
      }
      for (uVar3 = (int)sVar2 & 3; uVar3 != 0; uVar3 = uVar3 - 1) {
        *pcVar4 = '\0';
        pcVar4 = pcVar4 + 1;
      }
      strncpy(this->text,param_1,this->fixed_len + -1);
      uVar3 = 0xffffffff;
      this->text[this->fixed_len + -1] = '\0';
      pcVar4 = this->text;
      do {
        if (uVar3 == 0) break;
        uVar3 = uVar3 - 1;
        cVar1 = *pcVar4;
        pcVar4 = pcVar4 + 1;
      } while (cVar1 != '\0');
      this->text_len = ~uVar3 - 1;
    }
    SetWindowTextA(this->edit_wnd,this->text);
    this->sel_len = 0;
  }
  (**(code **)(this->_padding_ + 0x20))(1);
  return;
}

// --------------------------------------------------

// Function: update_text
// Address: 00475a30
/* WARNING: Variable defined which should be unmapped: end */
/* public: void __thiscall TEditPanel::update_text(void) */

void __thiscall TEditPanel::update_text(TEditPanel *this)
{
  char cVar1;
  uint uVar2;
  char *pcVar3;
  ulong end;
  ulong start;
  int iStack_4;
  
  if (this->edit_wnd != (void *)0x0) {
    GetWindowTextA(this->edit_wnd,this->text,this->fixed_len + 1);
    uVar2 = 0xffffffff;
    pcVar3 = this->text;
    do {
      if (uVar2 == 0) break;
      uVar2 = uVar2 - 1;
      cVar1 = *pcVar3;
      pcVar3 = pcVar3 + 1;
    } while (cVar1 != '\0');
    this->text_len = ~uVar2 - 1;
    this->text[this->fixed_len + -1] = '\0';
    if (this->fixed_len + -1 < this->text_len) {
      SetWindowTextA(this->edit_wnd,this->text);
      MessageBeep(0xffffffff);
    }
    iStack_4 = 0;
    start = 0;
    SendMessageA(this->edit_wnd,0xb0,&iStack_4,&start);
    this->sel_len = start - iStack_4;
  }
  return;
}

// --------------------------------------------------

// Function: get_text
// Address: 00475af0
/* public: char * __thiscall TEditPanel::get_text(void) */

char * __thiscall TEditPanel::get_text(TEditPanel *this)
{
  update_text(this);
  return this->text;
}

// --------------------------------------------------

// Function: get_input_buffer
// Address: 00475b00
/* public: char * __thiscall TEditPanel::get_input_buffer(void) */

char * __thiscall TEditPanel::get_input_buffer(TEditPanel *this)
{
  update_text(this);
  return this->text;
}

// --------------------------------------------------

// Function: currentLine
// Address: 00475b10
/* public: char * __thiscall TEditPanel::currentLine(void) */

char * __thiscall TEditPanel::currentLine(TEditPanel *this)
{
  update_text(this);
  return this->text;
}

// --------------------------------------------------

// Function: set_active
// Address: 00475b20
/* public: virtual void __thiscall TEditPanel::set_active(int) */

void __thiscall TEditPanel::set_active(TEditPanel *this,int param_1)
{
  TPanel::set_active((TPanel *)this,param_1);
  if ((this->edit_wnd != (void *)0x0) && (this->_padding_ == 0)) {
    ShowWindow(this->edit_wnd,0);
    this->hidden = 1;
  }
  return;
}

// --------------------------------------------------

// Function: set_focus
// Address: 00475b60
/* public: virtual void __thiscall TEditPanel::set_focus(int) */

void __thiscall TEditPanel::set_focus(TEditPanel *this,int param_1)
{
  int iVar1;
  void *pvVar2;
  void *pvVar3;
  ulong uVar4;
  
  iVar1 = this->_padding_;
  TPanel::set_focus((TPanel *)this,param_1);
  if (this->edit_wnd != (void *)0x0) {
    pvVar3 = (void *)GetFocus();
    pvVar2 = this->edit_wnd;
    if (this->_padding_ == 0) {
      if ((pvVar3 == pvVar2) && (pvVar2 = *(void **)(this->_padding_ + 4), pvVar3 != pvVar2)) {
        SetFocus(pvVar2);
      }
    }
    else {
      if (pvVar3 != pvVar2) {
        SetFocus(pvVar2);
      }
      if (this->imc == 0) {
        if (this->enable_ime == 0) {
          uVar4 = _ImmAssociateContext_8(this->edit_wnd,0);
        }
        else {
          uVar4 = _ImmGetContext_4(this->edit_wnd);
        }
        this->imc = uVar4;
      }
      uVar4 = this->imc;
      if ((uVar4 != 0) && (this->enable_ime != 0)) {
        if (this->turn_ime_on == 0) {
          imc_retval = _ImmSetOpenStatus_8(uVar4,0);
        }
        else {
          imc_retval = _ImmSetOpenStatus_8(uVar4,1);
        }
      }
    }
  }
  if ((iVar1 != 0) && (this->_padding_ == 0)) {
    update_text(this);
    (**(code **)(this->_padding_ + 0x20))(1);
  }
  if ((((this->edit_wnd != (void *)0x0) && (this->_padding_ != 0)) && (iVar1 == 0)) &&
     (this->auto_sel != 0)) {
    SendMessageA(this->edit_wnd,0xb1,0,0xffffffff);
  }
  if (((DAT_0086b240 == 0) && (this->edit_wnd != (void *)0x0)) &&
     ((this->_padding_ == 0 && (this->hidden == 0)))) {
    ShowWindow(this->edit_wnd,0);
    this->hidden = 1;
  }
  if (this->_padding_ != 0) {
    DAT_0086b244 = 0;
  }
  return;
}

// --------------------------------------------------

// Function: set_rect
// Address: 00475cc0
/* public: virtual void __thiscall TEditPanel::set_rect(long,long,long,long) */

void __thiscall
TEditPanel::set_rect(TEditPanel *this,long param_1,long param_2,long param_3,long param_4)
{
  int iVar1;
  int iVar2;
  int iVar3;
  undefined4 uVar4;
  
  TPanel::set_rect((TPanel *)this,param_1,param_2,param_3,param_4);
  if (this->edit_wnd != (void *)0x0) {
    if (((this->hidden == 0) && (this->_padding_ != 0)) && (this->_padding_ != 0)) {
      uVar4 = 1;
    }
    else {
      uVar4 = 0;
    }
    iVar1 = this->bevel_size;
    MoveWindow(this->edit_wnd,this->_padding_ + iVar1,this->_padding_ + iVar1,
               this->_padding_ + iVar1 * -2 + -1,this->_padding_ + iVar1 * -2 + -1,uVar4);
  }
  iVar1 = this->bevel_size;
  if (this->format == FormatMultiLine) {
    iVar2 = this->_padding_;
    (this->draw_rect).left = this->_padding_ + 1 + iVar1;
    (this->draw_rect).top = iVar2 + iVar1;
    iVar3 = GetSystemMetrics(0x15);
    iVar2 = this->_padding_;
    (this->draw_rect).right = ((this->_padding_ - iVar1) - iVar3) + -1;
    (this->draw_rect).bottom = iVar2 - iVar1;
    return;
  }
  iVar2 = this->_padding_;
  (this->draw_rect).left = this->_padding_ + 8 + iVar1;
  iVar3 = this->_padding_;
  (this->draw_rect).top = iVar2 + iVar1;
  iVar2 = this->_padding_;
  (this->draw_rect).right = iVar3 - iVar1;
  (this->draw_rect).bottom = iVar2 - iVar1;
  return;
}

// --------------------------------------------------

// Function: set_redraw
// Address: 00475dd0
/* public: virtual void __thiscall TEditPanel::set_redraw(enum TPanel::RedrawMode) */

void __thiscall TEditPanel::set_redraw(TEditPanel *this,RedrawMode param_1)
{
  TPanel::set_redraw((TPanel *)this,RedrawNormal);
  if ((((this->_padding_ != 0) && (param_1 != RedrawNone)) && (this->edit_wnd != (void *)0x0)) &&
     (this->hidden == 0)) {
    InvalidateRect(this->edit_wnd,0,1);
  }
  return;
}

// --------------------------------------------------

// Function: set_text_color
// Address: 00475e10
/* public: void __thiscall TEditPanel::set_text_color(unsigned long,unsigned long) */

void __thiscall TEditPanel::set_text_color(TEditPanel *this,ulong param_1,ulong param_2)
{
  this->text_color1 = param_1;
  this->text_color2 = param_2;
  (**(code **)(this->_padding_ + 0x20))(1);
  return;
}

// --------------------------------------------------

// Function: set_highlight_text_color
// Address: 00475e30
/* public: void __thiscall TEditPanel::set_highlight_text_color(unsigned long,unsigned long) */

void __thiscall TEditPanel::set_highlight_text_color(TEditPanel *this,ulong param_1,ulong param_2)
{
  return;
}

// --------------------------------------------------

// Function: set_back_color
// Address: 00475e40
/* public: void __thiscall TEditPanel::set_back_color(void *,unsigned long,unsigned char) */

void __thiscall
TEditPanel::set_back_color(TEditPanel *this,void *param_1,ulong param_2,uchar param_3)
{
  return;
}

// --------------------------------------------------

// Function: set_bevel_info
// Address: 00475e50
/* public: void __thiscall TEditPanel::set_bevel_info(int,int,int,int,int,int,int) */

void __thiscall
TEditPanel::set_bevel_info
          (TEditPanel *this,int param_1,int param_2,int param_3,int param_4,int param_5,int param_6,
          int param_7)
{
  int iVar1;
  
  this->bevel_color1 = (uchar)param_2;
  this->bevel_color2 = (uchar)param_3;
  this->bevel_type = param_1;
  this->bevel_color3 = (uchar)param_4;
  this->bevel_color4 = (uchar)param_5;
  this->bevel_color5 = (uchar)param_6;
  this->bevel_color6 = (uchar)param_7;
  switch(param_1) {
  case 1:
  case 2:
  case 5:
    this->bevel_size = 1;
    break;
  case 3:
  case 6:
    this->bevel_size = 2;
    break;
  case 4:
  case 7:
    this->bevel_size = 3;
    break;
  default:
    this->bevel_size = 0;
  }
  iVar1 = this->_padding_;
  (**(code **)(iVar1 + 0xc))(this->_padding_,this->_padding_,this->_padding_,this->_padding_);
  (**(code **)(iVar1 + 0x20))(1);
  return;
}

// --------------------------------------------------

// Function: set_ime_info
// Address: 00475f20
/* public: void __thiscall TEditPanel::set_ime_info(int,int) */

void __thiscall TEditPanel::set_ime_info(TEditPanel *this,int param_1,int param_2)
{
  this->enable_ime = param_1;
  this->turn_ime_on = param_2;
  return;
}

// --------------------------------------------------

// Function: wnd_proc
// Address: 00475f40
/* public: virtual long __thiscall TEditPanel::wnd_proc(void *,unsigned int,unsigned int,long) */

long __thiscall
TEditPanel::wnd_proc(TEditPanel *this,void *param_1,uint param_2,uint param_3,long param_4)
{
  void *pvVar1;
  long lVar2;
  
  pvVar1 = this->edit_wnd;
  if ((((pvVar1 != (void *)0x0) && (this->_padding_ != 0)) && (this->_padding_ != 0)) &&
     (this->hidden == 0)) {
    if (param_2 == 7) {
      lVar2 = TPanel::wnd_proc((TPanel *)this,param_1,7,param_3,param_4);
      return lVar2;
    }
    if (param_2 == 0x111) {
      if (((void *)param_4 == pvVar1) && ((short)(param_3 >> 0x10) == 0x400)) {
        InvalidateRect(pvVar1,0,1);
      }
    }
    else if (((param_2 == 0x133) && (this->brush != (void *)0x0)) &&
            ((void *)(param_4 & 0xffffU) == pvVar1)) {
      SetBkColor(param_3,this->back_color);
      SetBkMode(param_3,2);
      SetTextColor(param_3,this->highlight_text_color1);
      return (long)this->brush;
    }
  }
  lVar2 = TPanel::wnd_proc((TPanel *)this,param_1,param_2,param_3,param_4);
  return lVar2;
}

// --------------------------------------------------

// Function: sub_wnd_proc
// Address: 00476040
/* WARNING: Variable defined which should be unmapped: old_start */
/* public: long __thiscall TEditPanel::sub_wnd_proc(void *,unsigned int,unsigned int,long) */

long __thiscall
TEditPanel::sub_wnd_proc(TEditPanel *this,void *param_1,uint param_2,uint param_3,long param_4)
{
  int iVar1;
  uint uVar2;
  long lVar3;
  short sVar4;
  short sVar5;
  int iVar6;
  long lVar7;
  TPanel *pTVar8;
  uint uVar9;
  ulong old_start;
  ulong new_end;
  ulong old_end;
  tagRECT rect;
  
  lVar3 = param_4;
  uVar9 = param_3;
  uVar2 = param_2;
  if ((((this->edit_wnd != (void *)0x0) && (this->_padding_ != 0)) && (this->_padding_ != 0)) &&
     (this->hidden == 0)) {
    if (param_2 < 0x15) {
      if (param_2 == 0x14) {
        if (this->brush != (void *)0x0) {
          SelectObject(param_3,this->brush);
          GetClientRect(param_1,&rect.top);
          FillRect(uVar9,&rect.top,this->brush);
          return 1;
        }
      }
      else if (param_2 == 0xf) {
        InvalidateRect(param_1,0,1);
      }
    }
    else if (param_2 < 0x201) {
      if (param_2 == 0x200) {
        if (rge_base_game->windows_mouse == 0) {
          MouseCursorInChildContol = 1;
          RGE_Base_Game::mouse_off(rge_base_game);
        }
      }
      else {
        switch(param_2) {
        case 0x100:
          if ((int *)this->_padding_ == (int *)0x0) {
            if (param_3 == 0x1b) {
              SendMessageA(this->edit_wnd,199,0,0);
              return 0;
            }
          }
          else {
            iVar6 = (**(code **)(*(int *)this->_padding_ + 0x48))(param_1,param_2,param_3,param_4);
            if (iVar6 != 0) {
              return 0;
            }
            if (uVar9 == 9) {
              sVar4 = GetKeyState(0x12);
              sVar5 = GetKeyState(0x11);
              param_3 = (uint)(sVar5 < 0);
              sVar5 = GetKeyState(0x10);
              DAT_0086b240 = 1;
              (**(code **)(this->_padding_ + 0x58))(9,lVar3,sVar4 < 0,param_3,sVar5 < 0);
              DAT_0086b240 = 0;
              return 0;
            }
            if (uVar9 == 0xd) {
              (**(code **)(*(int *)this->_padding_ + 0xb4))(this,0,0,0);
              return 0;
            }
            if (uVar9 == 0x1b) {
              iVar6 = (**(code **)(*(int *)this->_padding_ + 0xb4))(this,1,0,0);
              if (iVar6 != 0) {
                return 0;
              }
              SendMessageA(this->edit_wnd,199,0,0);
              return 0;
            }
          }
          goto LAB_004762dd;
        case 0x101:
          if (param_3 == 9) {
            return 0;
          }
          break;
        case 0x102:
          iVar6 = verify_char(this,param_3);
          if (iVar6 == 0) {
            return 0;
          }
          break;
        case 0x104:
          if ((this->imc == 0) || (this->enable_ime == 0)) {
            SetFocus(*(undefined4 *)(this->_padding_ + 4));
            PostMessageA(*(undefined4 *)(this->_padding_ + 4),uVar2,param_2,param_3);
          }
          return 0;
        }
      }
    }
  }
  uVar9 = param_3;
LAB_004762dd:
  new_end = 0;
  rect.left = 0;
  param_2 = 0;
  old_end = 0;
  if ((this->edit_wnd == (void *)0x0) || (uVar2 == 0xb0)) {
    param_4 = 0;
  }
  else {
    param_4 = 1;
    SendMessageA(this->edit_wnd,0xb0,&new_end,&rect);
  }
  lVar7 = CallWindowProcA(this->old_sub_wnd_proc,param_1,uVar2,uVar9,lVar3);
  if ((param_4 != 0) &&
     ((SendMessageA(this->edit_wnd,0xb0,&param_2,&old_end), param_2 != new_end ||
      (old_end != rect.left)))) {
    InvalidateRect(this->edit_wnd,0,1);
    UpdateWindow(this->edit_wnd);
  }
  if (uVar2 == 0x302) {
    update_text(this);
  }
  if ((((uVar2 == 0x201) || (uVar2 == 0x202)) || (uVar2 == 0x204)) || (uVar2 == 0x205)) {
    iVar6 = this->_padding_;
    iVar1 = this->_padding_;
    pTVar8 = TPanelSystem::currentPanel(&panel_system);
    lVar7 = (**(code **)(pTVar8->_padding_ + 0x48))
                      (*(undefined4 *)(this->_padding_ + 4),uVar2,param_3,
                       (((uint)lVar3 >> 0x10) + iVar1) * 0x10000 |
                       iVar6 + (lVar3 & 0xffffU) & 0xffff);
  }
  return lVar7;
}

// --------------------------------------------------

// Function: verify_char
// Address: 00476440
// [HELPER] s_10: "10"
/* public: int __thiscall TEditPanel::verify_char(int) */

int __thiscall TEditPanel::verify_char(TEditPanel *this,int param_1)
{
  int iVar1;
  bool bVar2;
  
  if (DAT_0086b244 != 0) {
    DAT_0086b244 = 0;
    return 0;
  }
  if (param_1 == 9) {
    return 0;
  }
  if ((param_1 == 0xd) && (this->format != FormatMultiLine)) {
    return 0;
  }
  if (param_1 == 8) {
    return 1;
  }
  update_text(this);
  if (this->sel_len == 0) {
    if (this->fixed_len + -1 <= this->text_len) {
      MessageBeep(0xffffffff);
      return 0;
    }
    if ((this->fixed_len + -2 <= this->text_len) && (iVar1 = IsDBCSLeadByte(param_1), iVar1 != 0)) {
      DAT_0086b244 = 1;
      MessageBeep(0xffffffff);
      return 0;
    }
  }
  switch(this->format) {
  default:
    goto switchD_00476509_caseD_0;
  case FormatNumber:
  case FormatInteger:
  case FormatUnsignedInt:
    update_text(this);
    if ((0x2f < param_1) && (param_1 < 0x3a)) {
      return 1;
    }
    if (((param_1 == 0x2d) && (*this->text == '\0')) && (this->format != FormatUnsignedInt)) {
      return 1;
    }
    if ((param_1 != 0x2e) || (iVar1 = __mbschr(this->text,0x2e), iVar1 == 0)) goto LAB_00476634;
    bVar2 = this->format == FormatNumber;
    break;
  case FormatFile:
  case FormatFileNoExt:
    update_text(this);
    if (param_1 == 0x2e) {
      if ((this->format == FormatFile) && (iVar1 = __mbschr(this->text,0x2e), iVar1 == 0)) {
        return 1;
      }
      goto LAB_00476634;
    }
    if ((param_1 == 0x5c) || (param_1 == 0x3a)) goto LAB_00476634;
    goto LAB_00476611;
  case FormatPath:
    update_text(this);
    if ((param_1 == 0x3a) && (this->text_len != 1)) goto LAB_00476634;
LAB_00476611:
    if (((param_1 != 0x2f) &&
        ((((param_1 != 0x22 && (param_1 != 0x2a)) && (param_1 != 0x3f)) &&
         ((param_1 != 0x3e && (param_1 != 0x3c)))))) && (param_1 != 0x7c)) {
      return 1;
    }
LAB_00476634:
    MessageBeep(0xffffffff);
    return 0;
  case FormatPercent:
    if (((this->text_len < 2) && (0x2f < param_1)) && (param_1 < 0x3a)) {
      return 1;
    }
    if ((this->text_len != 2) || (param_1 != 0x30)) goto LAB_00476634;
    iVar1 = __mbscmp(s_10,this->text);
    bVar2 = iVar1 == 0;
  }
  if (!bVar2) {
    MessageBeep(0xffffffff);
    return 0;
  }
switchD_00476509_caseD_0:
  return 1;
}

// --------------------------------------------------

// Function: draw
// Address: 00476680
// [HELPER] s_pnl_edit__draw: "pnl_edit::draw"
/* WARNING: Variable defined which should be unmapped: old_font */
/* public: virtual void __thiscall TEditPanel::draw(void) */

void __thiscall TEditPanel::draw(TEditPanel *this)
{
  uchar uVar1;
  uchar uVar2;
  uchar uVar3;
  uchar uVar4;
  uchar uVar5;
  uchar uVar6;
  int *piVar7;
  byte bVar8;
  uchar *puVar9;
  int iVar10;
  void *pvVar11;
  undefined4 uVar12;
  int iVar13;
  int iVar14;
  void *old_font;
  int iStack_18;
  tagRECT r;
  
  this->_padding_ = 0;
  if (this->_padding_ == 0) {
    return;
  }
  iVar14 = this->_padding_;
  r.left = iVar14;
  (**(code **)(iVar14 + 0x28))(0);
  if (((this->brush == (void *)0x0) || (this->_padding_ == 0)) || (this->_padding_ == 0)) {
    piVar7 = (int *)this->_padding_;
    if (piVar7 == (int *)0x0) {
      bVar8 = *(byte *)((int)&this->_padding_ + 3);
      goto LAB_00476722;
    }
    if ((this->bevel_type < 2) || (7 < this->bevel_type)) {
      if (piVar7[0x21] == 0) {
        (**(code **)(*piVar7 + 0x34))(&this->_padding_);
      }
    }
    else {
      (**(code **)(*piVar7 + 0x3c))(&this->_padding_);
    }
  }
  else {
    bVar8 = GetNearestPaletteIndex(*(undefined4 *)(*(int *)this->_padding_ + 8),this->back_color);
LAB_00476722:
    TDrawArea::Clear((TDrawArea *)this->_padding_,(tagRECT *)&this->_padding_,(uint)bVar8);
  }
  if (this->bevel_type == 0) goto LAB_004768c7;
  puVar9 = TDrawArea::Lock((TDrawArea *)this->_padding_,s_pnl_edit__draw,1);
  if (puVar9 == (uchar *)0x0) goto switchD_0047675d_default;
  switch(this->bevel_type) {
  case 1:
    TDrawArea::DrawRect((TDrawArea *)this->_padding_,this->_padding_,this->_padding_,
                        this->_padding_ + -1 + this->_padding_,
                        this->_padding_ + -1 + this->_padding_,this->bevel_color1);
    break;
  case 2:
    uVar1 = this->bevel_color1;
    iVar10 = this->_padding_;
    iVar13 = this->_padding_;
    uVar2 = this->bevel_color6;
    goto LAB_00476812;
  case 3:
    uVar1 = this->bevel_color1;
    iVar10 = this->_padding_;
    iVar13 = this->_padding_;
    uVar2 = this->bevel_color2;
    uVar3 = this->bevel_color5;
    uVar4 = this->bevel_color6;
    goto LAB_00476853;
  case 4:
    uVar1 = this->bevel_color1;
    iVar10 = this->_padding_;
    uVar2 = this->bevel_color2;
    uVar3 = this->bevel_color3;
    iVar13 = this->_padding_;
    uVar4 = this->bevel_color4;
    uVar5 = this->bevel_color5;
    uVar6 = this->bevel_color6;
    goto LAB_0047689f;
  case 5:
    uVar1 = this->bevel_color6;
    iVar10 = this->_padding_;
    iVar13 = this->_padding_;
    uVar2 = this->bevel_color1;
LAB_00476812:
    TDrawArea::DrawBevel
              ((TDrawArea *)this->_padding_,iVar13,iVar10,this->_padding_ + -1 + iVar13,
               this->_padding_ + -1 + iVar10,uVar2,uVar1);
    break;
  case 6:
    uVar1 = this->bevel_color6;
    iVar10 = this->_padding_;
    iVar13 = this->_padding_;
    uVar2 = this->bevel_color5;
    uVar3 = this->bevel_color2;
    uVar4 = this->bevel_color1;
LAB_00476853:
    TDrawArea::DrawBevel2
              ((TDrawArea *)this->_padding_,iVar13,iVar10,this->_padding_ + -1 + iVar13,
               this->_padding_ + -1 + iVar10,uVar4,uVar3,uVar2,uVar1);
    break;
  case 7:
    uVar1 = this->bevel_color6;
    iVar10 = this->_padding_;
    uVar2 = this->bevel_color5;
    uVar3 = this->bevel_color4;
    iVar13 = this->_padding_;
    uVar4 = this->bevel_color3;
    uVar5 = this->bevel_color2;
    uVar6 = this->bevel_color1;
LAB_0047689f:
    TDrawArea::DrawBevel3
              ((TDrawArea *)this->_padding_,iVar13,iVar10,this->_padding_ + -1 + iVar13,
               this->_padding_ + -1 + iVar10,uVar6,uVar5,uVar4,uVar3,uVar2,uVar1);
  }
switchD_0047675d_default:
  TDrawArea::Unlock((TDrawArea *)this->_padding_,s_pnl_edit__draw);
LAB_004768c7:
  pvVar11 = this->edit_wnd;
  if ((pvVar11 != (void *)0x0) && (this->_padding_ != 0)) {
    if (this->_padding_ == 0) {
      if (this->hidden == 0) {
        ShowWindow(pvVar11,0);
        this->hidden = 1;
      }
      pvVar11 = TDrawArea::GetDc((TDrawArea *)this->_padding_,s_pnl_edit__draw);
      if (pvVar11 != (void *)0x0) {
        SelectClipRgn(pvVar11,this->_padding_);
        uVar12 = SelectObject(pvVar11,this->font);
        SetBkMode(pvVar11,1);
        SetTextColor(pvVar11,this->text_color2);
        r.left = (this->draw_rect).left + -1;
        r.top = (this->draw_rect).top + 1;
        r.right = (this->draw_rect).right + -1;
        r.bottom = (this->draw_rect).bottom + 1;
        DrawTextExA(pvVar11,this->text,0xffffffff,&r,this->draw_format,0);
        SetTextColor(pvVar11,this->text_color1);
        DrawTextExA(pvVar11,this->text,0xffffffff,&this->draw_rect,this->draw_format,0);
        SelectObject(pvVar11,uVar12);
        SelectClipRgn(pvVar11,0);
        TDrawArea::ReleaseDc((TDrawArea *)this->_padding_,s_pnl_edit__draw);
        iVar14 = iStack_18;
      }
    }
    else if (this->hidden != 0) {
      ShowWindow(pvVar11,5);
      InvalidateRect(this->edit_wnd,0,1);
      this->hidden = 0;
      (**(code **)(iVar14 + 0x2c))();
      return;
    }
  }
  (**(code **)(iVar14 + 0x2c))();
  return;
}

// --------------------------------------------------

// Function: paint
// Address: 00476a50
/* public: virtual void __thiscall TEditPanel::paint(void) */

void __thiscall TEditPanel::paint(TEditPanel *this)
{
  return;
}

// --------------------------------------------------

// Function: is_blank
// Address: 00476a60
/* public: int __thiscall TEditPanel::is_blank(void) */

int __thiscall TEditPanel::is_blank(TEditPanel *this)
{
  int iVar1;
  char *pcVar2;
  
  update_text(this);
  pcVar2 = this->text;
  if ((pcVar2 != (char *)0x0) && (*pcVar2 != '\0')) {
    for (; *pcVar2 != '\0'; pcVar2 = (char *)__mbsinc(pcVar2)) {
      iVar1 = __ismbcspace(*pcVar2);
      if (iVar1 == 0) {
        return 0;
      }
    }
  }
  return 1;
}

// --------------------------------------------------

// Function: get_trimmed_str
// Address: 00476ab0
/* WARNING: Variable defined which should be unmapped: temp_str */
/* public: char * __thiscall TEditPanel::get_trimmed_str(char *,int) */

char * __thiscall TEditPanel::get_trimmed_str(TEditPanel *this,char *param_1,int param_2)
{
  char cVar1;
  char *pcVar2;
  char *pcVar3;
  int iVar4;
  uint uVar5;
  uint uVar6;
  char *pcVar7;
  char temp_str [256];
  
  update_text(this);
  pcVar2 = temp_str;
  pcVar3 = temp_str;
  for (iVar4 = 0x40; pcVar2 = pcVar2 + 4, iVar4 != 0; iVar4 = iVar4 + -1) {
    pcVar2[0] = '\0';
    pcVar2[1] = '\0';
    pcVar2[2] = '\0';
    pcVar2[3] = '\0';
  }
  uVar5 = 0xffffffff;
  pcVar2 = this->text;
  do {
    pcVar7 = pcVar2;
    if (uVar5 == 0) break;
    uVar5 = uVar5 - 1;
    pcVar7 = pcVar2 + 1;
    cVar1 = *pcVar2;
    pcVar2 = pcVar7;
  } while (cVar1 != '\0');
  uVar5 = ~uVar5;
  pcVar2 = pcVar7 + -uVar5;
  for (uVar6 = uVar5 >> 2; pcVar3 = pcVar3 + 4, uVar6 != 0; uVar6 = uVar6 - 1) {
    *(undefined4 *)pcVar3 = *(undefined4 *)pcVar2;
    pcVar2 = pcVar2 + 4;
  }
  for (uVar5 = uVar5 & 3; uVar5 != 0; uVar5 = uVar5 - 1) {
    *pcVar3 = *pcVar2;
    pcVar2 = pcVar2 + 1;
    pcVar3 = pcVar3 + 1;
  }
  pcVar2 = param_1;
  for (uVar5 = (uint)param_2 >> 2; uVar5 != 0; uVar5 = uVar5 - 1) {
    pcVar2[0] = '\0';
    pcVar2[1] = '\0';
    pcVar2[2] = '\0';
    pcVar2[3] = '\0';
    pcVar2 = pcVar2 + 4;
  }
  for (uVar5 = param_2 & 3; uVar5 != 0; uVar5 = uVar5 - 1) {
    *pcVar2 = '\0';
    pcVar2 = pcVar2 + 1;
  }
  pcVar2 = temp_str + 4;
  iVar4 = __ismbcspace(temp_str._4_4_ & 0xff);
  while (iVar4 != 0) {
    pcVar2 = (char *)__mbsinc(pcVar2);
    iVar4 = __ismbcspace(*pcVar2);
  }
  cVar1 = *pcVar2;
  pcVar3 = param_1;
  while (cVar1 != '\0') {
    __mbsncpy(pcVar3,pcVar2,1);
    pcVar3 = (char *)__mbsinc(pcVar3);
    pcVar2 = (char *)__mbsinc(pcVar2);
    cVar1 = *pcVar2;
  }
  do {
    *pcVar3 = '\0';
    if (pcVar3 == param_1) {
      return param_1;
    }
    pcVar3 = (char *)__mbsdec(param_1,pcVar3);
    iVar4 = __ismbcspace(*pcVar3);
  } while (iVar4 != 0);
  return param_1;
}

// --------------------------------------------------

// Function: handle_reactivate
// Address: 00476bb0
/* public: virtual void __thiscall TEditPanel::handle_reactivate(void) */

void __thiscall TEditPanel::handle_reactivate(TEditPanel *this)
{
  void *pvVar1;
  
  if ((this->edit_wnd != (void *)0x0) && (this->_padding_ != 0)) {
    pvVar1 = (void *)GetFocus();
    if (pvVar1 != this->edit_wnd) {
      SetFocus(this->edit_wnd);
    }
  }
  return;
}

// --------------------------------------------------

// Function: handle_mouse_down
// Address: 00476be0
/* public: virtual long __thiscall TEditPanel::handle_mouse_down(unsigned char,long,long,int,int) */

long __thiscall
TEditPanel::handle_mouse_down
          (TEditPanel *this,uchar param_1,long param_2,long param_3,int param_4,int param_5)
{
  long lVar1;
  
  lVar1 = TPanel::handle_mouse_down((TPanel *)this,param_1,param_2,param_3,param_4,param_5);
  return lVar1;
}

// --------------------------------------------------

