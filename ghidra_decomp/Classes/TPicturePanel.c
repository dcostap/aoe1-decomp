// Class: TPicturePanel
// Size:  0x11C
//
// VTable Layout:
// [00] `scalar_deleting_destructor'
// [01] setup
// [02] set_rect
// [03] set_rect
// [04] set_color
// [05] set_active
// [06] set_positioning
// [07] set_fixed_position
// [08] set_redraw
// [09] set_overlapped_redraw
// [10] draw_setup
// [11] draw_finish
// [12] draw
// [13] draw_rect
// [14] draw_offset
// [15] draw_rect2
// [16] draw_offset2
// [17] paint
// [18] wnd_proc
// [19] handle_idle
// [20] handle_size
// [21] handle_paint
// [22] handle_key_down
// [23] handle_char
// [24] handle_command
// [25] handle_user_command
// [26] handle_timer_command
// [27] handle_scroll
// [28] handle_mouse_down
// [29] handle_mouse_move
// [30] handle_mouse_up
// [31] handle_mouse_dbl_click
// [32] mouse_move_action
// [33] mouse_left_down_action
// [34] mouse_left_hold_action
// [35] mouse_left_move_action
// [36] mouse_left_up_action
// [37] mouse_left_dbl_click_action
// [38] mouse_right_down_action
// [39] mouse_right_hold_action
// [40] mouse_right_move_action
// [41] mouse_right_up_action
// [42] mouse_right_dbl_click_action
// [43] key_down_action
// [44] char_action
// [45] action
// [46] get_true_render_rect
// [47] is_inside
// [48] set_focus
// [49] set_tab_order
// [50] set_tab_order
// [51] get_help_info
// [52] stop_sound_system
// [53] restart_sound_system
// [54] take_snapshot
// [55] handle_reactivate
// [56] `scalar_deleting_destructor'
// [57] setup
// [58] set_rect
// [59] set_rect
// [60] set_color
// [61] set_active
// [62] set_positioning
// [63] set_fixed_position
// [64] set_redraw
// [65] set_overlapped_redraw
// [66] draw_setup
// [67] draw_finish
// [68] draw
// [69] draw_rect
// [70] draw_offset
// [71] draw_rect2
// [72] draw_offset2
// [73] paint
// [74] wnd_proc
// [75] handle_idle
// [76] handle_size
// [77] handle_paint
// [78] handle_key_down
// [79] handle_char
// [80] handle_command
// [81] handle_user_command
// [82] handle_timer_command
// [83] handle_scroll
// [84] handle_mouse_down
// [85] handle_mouse_move
// [86] handle_mouse_up
// [87] handle_mouse_dbl_click
// [88] mouse_move_action
// [89] mouse_left_down_action
// [90] mouse_left_hold_action
// [91] mouse_left_move_action
// [92] mouse_left_up_action
// [93] mouse_left_dbl_click_action
// [94] mouse_right_down_action
// [95] mouse_right_hold_action
// [96] mouse_right_move_action
// [97] mouse_right_up_action
// [98] mouse_right_dbl_click_action
// [99] key_down_action
// [100] char_action
// [101] action
// [102] get_true_render_rect
// [103] is_inside
// [104] set_focus
// [105] set_tab_order
// [106] set_tab_order
// [107] get_help_info
// [108] stop_sound_system
// [109] restart_sound_system
// [110] take_snapshot
// [111] handle_reactivate
// [112] `vector_deleting_destructor'
// [113] setup
// [114] set_rect
// [115] set_rect
// [116] set_color
// [117] set_active
// [118] set_positioning
// [119] set_fixed_position
// [120] set_redraw
// [121] set_overlapped_redraw
// [122] draw_setup
// [123] draw_finish
// [124] draw
// [125] draw_rect
// [126] draw_offset
// [127] draw_rect2
// [128] draw_offset2
// [129] paint
// [130] wnd_proc
// [131] handle_idle
// [132] handle_size
// [133] handle_paint
// [134] handle_key_down
// [135] handle_char
// [136] handle_command
// [137] handle_user_command
// [138] handle_timer_command
// [139] handle_scroll
// [140] handle_mouse_down
// [141] handle_mouse_move
// [142] handle_mouse_up
// [143] handle_mouse_dbl_click
// [144] mouse_move_action
// [145] mouse_left_down_action
// [146] mouse_left_hold_action
// [147] mouse_left_move_action
// [148] mouse_left_up_action
// [149] mouse_left_dbl_click_action
// [150] mouse_right_down_action
// [151] mouse_right_hold_action
// [152] mouse_right_move_action
// [153] mouse_right_up_action
// [154] mouse_right_dbl_click_action
// [155] key_down_action
// [156] char_action
// [157] action
// [158] get_true_render_rect
// [159] is_inside
// [160] set_focus
// [161] set_tab_order
// [162] set_tab_order
// [163] get_help_info
// [164] stop_sound_system
// [165] restart_sound_system
// [166] take_snapshot
// [167] handle_reactivate
// [168] draw_background
// [169] set_ideal_size
// [170] create_button
// [171] create_button
// [172] create_check_box
// [173] create_radio_button
// [174] create_text
// [175] create_text
// [176] create_text
// [177] create_input
// [178] create_edit
// [179] create_drop_down
// [180] create_list
// [181] create_scrollbar
// [182] create_auto_scrollbar
// [183] create_vert_slider
// [184] create_horz_slider
// [185] position_panel
// [186] `scalar_deleting_destructor'
// [187] setup
// [188] set_rect
// [189] set_rect
// [190] set_color
// [191] set_active
// [192] set_positioning
// [193] set_fixed_position
// [194] set_redraw
// [195] set_overlapped_redraw
// [196] draw_setup
// [197] draw_finish
// [198] draw
// [199] draw_rect
// [200] draw_offset
// [201] draw_rect2
// [202] draw_offset2
// [203] paint
// [204] wnd_proc
// [205] handle_idle
// [206] handle_size
// [207] handle_paint
// [208] handle_key_down
// [209] handle_char
// [210] handle_command
// [211] handle_user_command
// [212] handle_timer_command
// [213] handle_scroll
// [214] handle_mouse_down
// [215] handle_mouse_move
// [216] handle_mouse_up
// [217] handle_mouse_dbl_click
// [218] mouse_move_action
// [219] mouse_left_down_action
// [220] mouse_left_hold_action
// [221] mouse_left_move_action
// [222] mouse_left_up_action
// [223] mouse_left_dbl_click_action
// [224] mouse_right_down_action
// [225] mouse_right_hold_action
// [226] mouse_right_move_action
// [227] mouse_right_up_action
// [228] mouse_right_dbl_click_action
// [229] key_down_action
// [230] char_action
// [231] action
// [232] get_true_render_rect
// [233] is_inside
// [234] set_focus
// [235] set_tab_order
// [236] set_tab_order
// [237] get_help_info
// [238] stop_sound_system
// [239] restart_sound_system
// [240] take_snapshot
// [241] handle_reactivate
// [242] `scalar_deleting_destructor'
// [243] setup
// [244] set_rect
// [245] set_rect
// [246] set_color
// [247] set_active
// [248] set_positioning
// [249] set_fixed_position
// [250] set_redraw
// [251] set_overlapped_redraw
// [252] draw_setup
// [253] draw_finish
// [254] draw
// [255] draw_rect
// [256] draw_offset
// [257] draw_rect2
// [258] draw_offset2
// [259] paint
// [260] wnd_proc
// [261] handle_idle
// [262] handle_size
// [263] handle_paint
// [264] handle_key_down
// [265] handle_char
// [266] handle_command
// [267] handle_user_command
// [268] handle_timer_command
// [269] handle_scroll
// [270] handle_mouse_down
// [271] handle_mouse_move
// [272] handle_mouse_up
// [273] handle_mouse_dbl_click
// [274] mouse_move_action
// [275] mouse_left_down_action
// [276] mouse_left_hold_action
// [277] mouse_left_move_action
// [278] mouse_left_up_action
// [279] mouse_left_dbl_click_action
// [280] mouse_right_down_action
// [281] mouse_right_hold_action
// [282] mouse_right_move_action
// [283] mouse_right_up_action
// [284] mouse_right_dbl_click_action
// [285] key_down_action
// [286] char_action
// [287] action
// [288] get_true_render_rect
// [289] is_inside
// [290] set_focus
// [291] set_tab_order
// [292] set_tab_order
// [293] get_help_info
// [294] stop_sound_system
// [295] restart_sound_system
// [296] take_snapshot
// [297] handle_reactivate
// [298] `scalar_deleting_destructor'
// [299] setup
// [300] set_rect
// [301] set_rect
// [302] set_color
// [303] set_active
// [304] set_positioning
// [305] set_fixed_position
// [306] set_redraw
// [307] set_overlapped_redraw
// [308] draw_setup
// [309] draw_finish
// [310] draw
// [311] draw_rect
// [312] draw_offset
// [313] draw_rect2
// [314] draw_offset2
// [315] paint
// [316] wnd_proc
// [317] handle_idle
// [318] handle_size
// [319] handle_paint
// [320] handle_key_down
// [321] handle_char
// [322] handle_command
// [323] handle_user_command
// [324] handle_timer_command
// [325] handle_scroll
// [326] handle_mouse_down
// [327] handle_mouse_move
// [328] handle_mouse_up
// [329] handle_mouse_dbl_click
// [330] mouse_move_action
// [331] mouse_left_down_action
// [332] mouse_left_hold_action
// [333] mouse_left_move_action
// [334] mouse_left_up_action
// [335] mouse_left_dbl_click_action
// [336] mouse_right_down_action
// [337] mouse_right_hold_action
// [338] mouse_right_move_action
// [339] mouse_right_up_action
// [340] mouse_right_dbl_click_action
// [341] key_down_action
// [342] char_action
// [343] action
// [344] get_true_render_rect
// [345] is_inside
// [346] set_focus
// [347] set_tab_order
// [348] set_tab_order
// [349] get_help_info
// [350] stop_sound_system
// [351] restart_sound_system
// [352] take_snapshot
// [353] handle_reactivate
// [354] set_text
// [355] set_text
// [356] set_text
// [357] set_bevel_info
//
// Member Layout:
// [0x0F4] char[12] pic_name (sz: 0xC)
// [0x100] long res_id
// [0x104] int size_from_pic
// [0x108] int keep_loaded
// [0x10C] int own_pic
// [0x110] PictureType pic_type
// [0x114] TPicture * pic
// [0x118] TShape * shape
// ----------------------------------------------------------------

// Function: TPicturePanel
// Address: 0047a1d0
/* public: __thiscall TPicturePanel::TPicturePanel(void) */

TPicturePanel * __thiscall TPicturePanel::TPicturePanel(TPicturePanel *this)
{
  TPanel::TPanel((TPanel *)this);
  this->keep_loaded = 1;
  this->size_from_pic = 0;
  this->own_pic = 0;
  this->pic_type = Picture;
  this->pic = (TPicture *)0x0;
  this->shape = (TShape *)0x0;
  this->_padding_ = 0;
  this->pic_name[0] = '\0';
  this->_padding_ = (int)&_vftable_;
  *(undefined1 *)((int)&this->_padding_ + 2) = 2;
  this->res_id = -1;
  return this;
}

// --------------------------------------------------

// Function: `scalar_deleting_destructor'
// Address: 0047a230
/* public: virtual void * __thiscall TPicturePanel::`scalar deleting destructor'(unsigned int) */

void * __thiscall TPicturePanel::_scalar_deleting_destructor_(TPicturePanel *this,uint param_1)
{
  ~TPicturePanel(this);
  if ((param_1 & 1) != 0) {
    operator_delete(this);
  }
  return this;
}

// --------------------------------------------------

// Function: ~TPicturePanel
// Address: 0047a250
/* public: virtual __thiscall TPicturePanel::~TPicturePanel(void) */

void __thiscall TPicturePanel::~TPicturePanel(TPicturePanel *this)
{
  undefined4 *unaff_FS_OFFSET;
  undefined4 local_c;
  code *pcStack_8;
  undefined4 local_4;
  
  pcStack_8 = FUN_0055e528;
  local_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &local_c;
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  free_pic(this);
  local_4 = 0xffffffff;
  TPanel::~TPanel((TPanel *)this);
  *unaff_FS_OFFSET = local_c;
  return;
}

// --------------------------------------------------

// Function: setup
// Address: 0047a2a0
/* public: long __thiscall TPicturePanel::setup(class TDrawArea *,class TPanel
   *,long,long,long,long,char *,long,int,int) */

long __thiscall
TPicturePanel::setup
          (TPicturePanel *this,TDrawArea *param_1,TPanel *param_2,long param_3,long param_4,
          long param_5,long param_6,char *param_7,long param_8,int param_9,int param_10)
{
  char cVar1;
  int iVar2;
  uint uVar3;
  uint uVar4;
  char *pcVar5;
  char *pcVar6;
  
  if (param_7 == (char *)0x0) {
    this->pic_name[0] = '\0';
  }
  else {
    uVar3 = 0xffffffff;
    pcVar5 = param_7;
    do {
      pcVar6 = pcVar5;
      if (uVar3 == 0) break;
      uVar3 = uVar3 - 1;
      pcVar6 = pcVar5 + 1;
      cVar1 = *pcVar5;
      pcVar5 = pcVar6;
    } while (cVar1 != '\0');
    uVar3 = ~uVar3;
    pcVar5 = pcVar6 + -uVar3;
    pcVar6 = this->pic_name;
    for (uVar4 = uVar3 >> 2; uVar4 != 0; uVar4 = uVar4 - 1) {
      *(undefined4 *)pcVar6 = *(undefined4 *)pcVar5;
      pcVar5 = pcVar5 + 4;
      pcVar6 = pcVar6 + 4;
    }
    for (uVar3 = uVar3 & 3; uVar3 != 0; uVar3 = uVar3 - 1) {
      *pcVar6 = *pcVar5;
      pcVar5 = pcVar5 + 1;
      pcVar6 = pcVar6 + 1;
    }
  }
  this->res_id = param_8;
  this->size_from_pic = param_9;
  this->keep_loaded = param_10;
  if (((param_9 != 0) || (param_10 != 0)) && (iVar2 = load_pic(this), iVar2 != 0)) {
    if (this->size_from_pic != 0) {
      if (this->pic_type == Picture) {
        param_5 = this->pic->Width;
        param_6 = this->pic->Height;
      }
      else {
        TShape::shape_bounds(this->shape,0,(short *)&param_7,(short *)&param_8);
        param_5 = (long)(short)param_7;
        param_6 = (long)(short)param_8;
      }
    }
    if (this->keep_loaded == 0) {
      free_pic(this);
    }
  }
  TPanel::setup((TPanel *)this,param_1,param_2,param_3,param_4,param_5,param_6,'\0');
  return 1;
}

// --------------------------------------------------

// Function: set_picture
// Address: 0047a3a0
/* public: void __thiscall TPicturePanel::set_picture(class TShape *,long) */

void __thiscall TPicturePanel::set_picture(TPicturePanel *this,TShape *param_1,long param_2)
{
  free_pic(this);
  this->res_id = param_2;
  this->shape = param_1;
  this->own_pic = 0;
  (**(code **)(this->_padding_ + 0x20))(1);
  return;
}

// --------------------------------------------------

// Function: load_pic
// Address: 0047a3e0
// [HELPER] s_: ""
// [HELPER] s__s_bmp: "%s.bmp"
// [HELPER] s__s_shp: "%s.shp"
/* protected: int __thiscall TPicturePanel::load_pic(void) */

int __thiscall TPicturePanel::load_pic(TPicturePanel *this)
{
  TShape *pTVar1;
  int iVar2;
  TPicture *this_00;
  undefined4 *unaff_FS_OFFSET;
  char file_name [80];
  undefined4 local_c;
  code *pcStack_8;
  undefined4 local_4;
  
  local_c = *unaff_FS_OFFSET;
  local_4 = 0xffffffff;
  pcStack_8 = FUN_0055e561;
  *unaff_FS_OFFSET = &local_c;
  free_pic(this);
  if (this->pic_name[0] == '\0') {
    if (this->res_id == -1) goto LAB_0047a59a;
    file_name._0_4_ = operator_new(0x20);
    local_4 = 1;
    if ((TShape *)file_name._0_4_ == (TShape *)0x0) {
      pTVar1 = (TShape *)0x0;
    }
    else {
      pTVar1 = (TShape *)TShape::TShape((TShape *)file_name._0_4_,s_,this->res_id);
    }
  }
  else {
    sprintf(file_name + 4,s__s_shp,this->pic_name);
    file_name._0_4_ = operator_new(0x20);
    local_4 = 0;
    if ((TShape *)file_name._0_4_ == (TShape *)0x0) {
      pTVar1 = (TShape *)0x0;
    }
    else {
      pTVar1 = (TShape *)TShape::TShape((TShape *)file_name._0_4_,file_name + 4,this->res_id);
    }
  }
  local_4 = 0xffffffff;
  this->shape = pTVar1;
  if (pTVar1 != (TShape *)0x0) {
    iVar2 = TShape::is_loaded(pTVar1);
    if (iVar2 != 0) {
      this->pic_type = Shape;
      this->own_pic = 1;
      *unaff_FS_OFFSET = local_c;
      return 1;
    }
    pTVar1 = this->shape;
    if (pTVar1 != (TShape *)0x0) {
      TShape::~TShape(pTVar1);
      operator_delete(pTVar1);
    }
    this->shape = (TShape *)0x0;
  }
  sprintf(file_name + 4,s__s_bmp,this->pic_name);
  file_name._0_4_ = operator_new(0x20);
  local_4 = 2;
  if ((TPicture *)file_name._0_4_ == (TPicture *)0x0) {
    this_00 = (TPicture *)0x0;
  }
  else {
    this_00 = (TPicture *)
              TPicture::TPicture((TPicture *)file_name._0_4_,file_name + 4,-1,0,(void *)0x0,0);
  }
  local_4 = 0xffffffff;
  this->pic = this_00;
  if (this_00 != (TPicture *)0x0) {
    if (this_00->Dib != (tagBITMAPINFOHEADER *)0x0) {
      this->pic_type = Picture;
      this->own_pic = 1;
      *unaff_FS_OFFSET = local_c;
      return 1;
    }
    TPicture::~TPicture(this_00);
    operator_delete(this_00);
    this->pic = (TPicture *)0x0;
  }
LAB_0047a59a:
  *unaff_FS_OFFSET = local_c;
  return 0;
}

// --------------------------------------------------

// Function: free_pic
// Address: 0047a5b0
/* protected: void __thiscall TPicturePanel::free_pic(void) */

void __thiscall TPicturePanel::free_pic(TPicturePanel *this)
{
  TPicture *this_00;
  TShape *this_01;
  
  this_00 = this->pic;
  if (this_00 != (TPicture *)0x0) {
    if ((this->own_pic != 0) && (this_00 != (TPicture *)0x0)) {
      TPicture::~TPicture(this_00);
      operator_delete(this_00);
    }
    this->pic = (TPicture *)0x0;
  }
  this_01 = this->shape;
  if (this_01 != (TShape *)0x0) {
    if ((this->own_pic != 0) && (this_01 != (TShape *)0x0)) {
      TShape::~TShape(this_01);
      operator_delete(this_01);
    }
    this->shape = (TShape *)0x0;
  }
  this->own_pic = 0;
  return;
}

// --------------------------------------------------

// Function: draw
// Address: 0047a630
// [HELPER] s_pnl_pic__draw: "pnl_pic::draw"
/* public: virtual void __thiscall TPicturePanel::draw(void) */

void __thiscall TPicturePanel::draw(TPicturePanel *this)
{
  int iVar1;
  uchar *puVar2;
  
  if (((this->_padding_ != 0) && (this->_padding_ != 0)) && (this->_padding_ != 0)) {
    iVar1 = this->_padding_;
    (**(code **)(iVar1 + 0x28))(0);
    if (this->keep_loaded == 0) {
      load_pic(this);
    }
    puVar2 = TDrawArea::Lock((TDrawArea *)this->_padding_,s_pnl_pic__draw,1);
    if (puVar2 != (uchar *)0x0) {
      if (this->pic_type == Picture) {
        if (this->pic != (TPicture *)0x0) {
          TPicture::Draw(this->pic,(TDrawArea *)this->_padding_,this->_padding_,this->_padding_,0,0)
          ;
        }
      }
      else if (this->shape != (TShape *)0x0) {
        TShape::shape_draw(this->shape,(TDrawArea *)this->_padding_,this->_padding_,this->_padding_,
                           0,'\0',(uchar *)0x0);
      }
      TDrawArea::Unlock((TDrawArea *)this->_padding_,s_pnl_pic__draw);
    }
    if (this->keep_loaded == 0) {
      free_pic(this);
    }
    (**(code **)(iVar1 + 0x2c))();
  }
  return;
}

// --------------------------------------------------

