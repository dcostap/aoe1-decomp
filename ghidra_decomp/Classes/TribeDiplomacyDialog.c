// Class: TribeDiplomacyDialog
// Size:  0x6B8
//
// VTable Layout:
// [00] `scalar_deleting_destructor'
// [01] setup
// [02] set_rect
// [03] set_rect
// [04] set_color
// [05] set_active
// [06] set_positioning
// [07] set_fixed_position
// [08] set_redraw
// [09] set_overlapped_redraw
// [10] draw_setup
// [11] draw_finish
// [12] draw
// [13] draw_rect
// [14] draw_offset
// [15] draw_rect2
// [16] draw_offset2
// [17] paint
// [18] wnd_proc
// [19] handle_idle
// [20] handle_size
// [21] handle_paint
// [22] handle_key_down
// [23] handle_char
// [24] handle_command
// [25] handle_user_command
// [26] handle_timer_command
// [27] handle_scroll
// [28] handle_mouse_down
// [29] handle_mouse_move
// [30] handle_mouse_up
// [31] handle_mouse_dbl_click
// [32] mouse_move_action
// [33] mouse_left_down_action
// [34] mouse_left_hold_action
// [35] mouse_left_move_action
// [36] mouse_left_up_action
// [37] mouse_left_dbl_click_action
// [38] mouse_right_down_action
// [39] mouse_right_hold_action
// [40] mouse_right_move_action
// [41] mouse_right_up_action
// [42] mouse_right_dbl_click_action
// [43] key_down_action
// [44] char_action
// [45] action
// [46] get_true_render_rect
// [47] is_inside
// [48] set_focus
// [49] set_tab_order
// [50] set_tab_order
// [51] get_help_info
// [52] stop_sound_system
// [53] restart_sound_system
// [54] take_snapshot
// [55] handle_reactivate
// [56] draw_background
// [57] set_ideal_size
// [58] create_button
// [59] create_button
// [60] create_check_box
// [61] create_radio_button
// [62] create_text
// [63] create_text
// [64] create_text
// [65] create_input
// [66] create_edit
// [67] create_drop_down
// [68] create_list
// [69] create_scrollbar
// [70] create_auto_scrollbar
// [71] create_vert_slider
// [72] create_horz_slider
// [73] position_panel
// [74] setup
// [75] setup
// [76] `scalar_deleting_destructor'
// [77] setup
// [78] set_rect
// [79] set_rect
// [80] set_color
// [81] set_active
// [82] set_positioning
// [83] set_fixed_position
// [84] set_redraw
// [85] set_overlapped_redraw
// [86] draw_setup
// [87] draw_finish
// [88] draw
// [89] draw_rect
// [90] draw_offset
// [91] draw_rect2
// [92] draw_offset2
// [93] paint
// [94] wnd_proc
// [95] handle_idle
// [96] handle_size
// [97] handle_paint
// [98] handle_key_down
// [99] handle_char
// [100] handle_command
// [101] handle_user_command
// [102] handle_timer_command
// [103] handle_scroll
// [104] handle_mouse_down
// [105] handle_mouse_move
// [106] handle_mouse_up
// [107] handle_mouse_dbl_click
// [108] mouse_move_action
// [109] mouse_left_down_action
// [110] mouse_left_hold_action
// [111] mouse_left_move_action
// [112] mouse_left_up_action
// [113] mouse_left_dbl_click_action
// [114] mouse_right_down_action
// [115] mouse_right_hold_action
// [116] mouse_right_move_action
// [117] mouse_right_up_action
// [118] mouse_right_dbl_click_action
// [119] key_down_action
// [120] char_action
// [121] action
// [122] get_true_render_rect
// [123] is_inside
// [124] set_focus
// [125] set_tab_order
// [126] set_tab_order
// [127] get_help_info
// [128] stop_sound_system
// [129] restart_sound_system
// [130] take_snapshot
// [131] handle_reactivate
// [132] draw_background
// [133] set_ideal_size
// [134] create_button
// [135] create_button
// [136] create_check_box
// [137] create_radio_button
// [138] create_text
// [139] create_text
// [140] create_text
// [141] create_input
// [142] create_edit
// [143] create_drop_down
// [144] create_list
// [145] create_scrollbar
// [146] create_auto_scrollbar
// [147] create_vert_slider
// [148] create_horz_slider
// [149] position_panel
// [150] setup
// [151] setup
// [152] `vector_deleting_destructor'
// [153] setup
// [154] set_rect
// [155] set_rect
// [156] set_color
// [157] set_active
// [158] set_positioning
// [159] set_fixed_position
// [160] set_redraw
// [161] set_overlapped_redraw
// [162] draw_setup
// [163] draw_finish
// [164] draw
// [165] draw_rect
// [166] draw_offset
// [167] draw_rect2
// [168] draw_offset2
// [169] paint
// [170] wnd_proc
// [171] handle_idle
// [172] handle_size
// [173] handle_paint
// [174] handle_key_down
// [175] handle_char
// [176] handle_command
// [177] handle_user_command
// [178] handle_timer_command
// [179] handle_scroll
// [180] handle_mouse_down
// [181] handle_mouse_move
// [182] handle_mouse_up
// [183] handle_mouse_dbl_click
// [184] mouse_move_action
// [185] mouse_left_down_action
// [186] mouse_left_hold_action
// [187] mouse_left_move_action
// [188] mouse_left_up_action
// [189] mouse_left_dbl_click_action
// [190] mouse_right_down_action
// [191] mouse_right_hold_action
// [192] mouse_right_move_action
// [193] mouse_right_up_action
// [194] mouse_right_dbl_click_action
// [195] key_down_action
// [196] char_action
// [197] action
// [198] get_true_render_rect
// [199] is_inside
// [200] set_focus
// [201] set_tab_order
// [202] set_tab_order
// [203] get_help_info
// [204] stop_sound_system
// [205] restart_sound_system
// [206] take_snapshot
// [207] handle_reactivate
// [208] draw_background
// [209] set_ideal_size
// [210] create_button
// [211] create_button
// [212] create_check_box
// [213] create_radio_button
// [214] create_text
// [215] create_text
// [216] create_text
// [217] create_input
// [218] create_edit
// [219] create_drop_down
// [220] create_list
// [221] create_scrollbar
// [222] create_auto_scrollbar
// [223] create_vert_slider
// [224] create_horz_slider
// [225] position_panel
// [226] setup
// [227] setup
// [228] get_list_id
// [229] get_list_name
// [230] `scalar_deleting_destructor'
// [231] setup
// [232] set_rect
// [233] set_rect
// [234] set_color
// [235] set_active
// [236] set_positioning
// [237] set_fixed_position
// [238] set_redraw
// [239] set_overlapped_redraw
// [240] draw_setup
// [241] draw_finish
// [242] draw
// [243] draw_rect
// [244] draw_offset
// [245] draw_rect2
// [246] draw_offset2
// [247] paint
// [248] wnd_proc
// [249] handle_idle
// [250] handle_size
// [251] handle_paint
// [252] handle_key_down
// [253] handle_char
// [254] handle_command
// [255] handle_user_command
// [256] handle_timer_command
// [257] handle_scroll
// [258] handle_mouse_down
// [259] handle_mouse_move
// [260] handle_mouse_up
// [261] handle_mouse_dbl_click
// [262] mouse_move_action
// [263] mouse_left_down_action
// [264] mouse_left_hold_action
// [265] mouse_left_move_action
// [266] mouse_left_up_action
// [267] mouse_left_dbl_click_action
// [268] mouse_right_down_action
// [269] mouse_right_hold_action
// [270] mouse_right_move_action
// [271] mouse_right_up_action
// [272] mouse_right_dbl_click_action
// [273] key_down_action
// [274] char_action
// [275] action
// [276] get_true_render_rect
// [277] is_inside
// [278] set_focus
// [279] set_tab_order
// [280] set_tab_order
// [281] get_help_info
// [282] stop_sound_system
// [283] restart_sound_system
// [284] take_snapshot
// [285] handle_reactivate
// [286] draw_background
// [287] set_ideal_size
// [288] create_button
// [289] create_button
// [290] create_check_box
// [291] create_radio_button
// [292] create_text
// [293] create_text
// [294] create_text
// [295] create_input
// [296] create_edit
// [297] create_drop_down
// [298] create_list
// [299] create_scrollbar
// [300] create_auto_scrollbar
// [301] create_vert_slider
// [302] create_horz_slider
// [303] position_panel
// [304] setup
// [305] setup
// [306] `scalar_deleting_destructor'
// [307] setup
// [308] set_rect
// [309] set_rect
// [310] set_color
// [311] set_active
// [312] set_positioning
// [313] set_fixed_position
// [314] set_redraw
// [315] set_overlapped_redraw
// [316] draw_setup
// [317] draw_finish
// [318] draw
// [319] draw_rect
// [320] draw_offset
// [321] draw_rect2
// [322] draw_offset2
// [323] paint
// [324] wnd_proc
// [325] handle_idle
// [326] handle_size
// [327] handle_paint
// [328] handle_key_down
// [329] handle_char
// [330] handle_command
// [331] handle_user_command
// [332] handle_timer_command
// [333] handle_scroll
// [334] handle_mouse_down
// [335] handle_mouse_move
// [336] handle_mouse_up
// [337] handle_mouse_dbl_click
// [338] mouse_move_action
// [339] mouse_left_down_action
// [340] mouse_left_hold_action
// [341] mouse_left_move_action
// [342] mouse_left_up_action
// [343] mouse_left_dbl_click_action
// [344] mouse_right_down_action
// [345] mouse_right_hold_action
// [346] mouse_right_move_action
// [347] mouse_right_up_action
// [348] mouse_right_dbl_click_action
// [349] key_down_action
// [350] char_action
// [351] action
// [352] get_true_render_rect
// [353] is_inside
// [354] set_focus
// [355] set_tab_order
// [356] set_tab_order
// [357] get_help_info
// [358] stop_sound_system
// [359] restart_sound_system
// [360] take_snapshot
// [361] handle_reactivate
// [362] draw_background
// [363] set_ideal_size
// [364] create_button
// [365] create_button
// [366] create_check_box
// [367] create_radio_button
// [368] create_text
// [369] create_text
// [370] create_text
// [371] create_input
// [372] create_edit
// [373] create_drop_down
// [374] create_list
// [375] create_scrollbar
// [376] create_auto_scrollbar
// [377] create_vert_slider
// [378] create_horz_slider
// [379] position_panel
// [380] setup
// [381] setup
// [382] `scalar_deleting_destructor'
// [383] setup
// [384] set_rect
// [385] set_rect
// [386] set_color
// [387] set_active
// [388] set_positioning
// [389] set_fixed_position
// [390] set_redraw
// [391] set_overlapped_redraw
// [392] draw_setup
// [393] draw_finish
// [394] draw
// [395] draw_rect
// [396] draw_offset
// [397] draw_rect2
// [398] draw_offset2
// [399] paint
// [400] wnd_proc
// [401] handle_idle
// [402] handle_size
// [403] handle_paint
// [404] handle_key_down
// [405] handle_char
// [406] handle_command
// [407] handle_user_command
// [408] handle_timer_command
// [409] handle_scroll
// [410] handle_mouse_down
// [411] handle_mouse_move
// [412] handle_mouse_up
// [413] handle_mouse_dbl_click
// [414] mouse_move_action
// [415] mouse_left_down_action
// [416] mouse_left_hold_action
// [417] mouse_left_move_action
// [418] mouse_left_up_action
// [419] mouse_left_dbl_click_action
// [420] mouse_right_down_action
// [421] mouse_right_hold_action
// [422] mouse_right_move_action
// [423] mouse_right_up_action
// [424] mouse_right_dbl_click_action
// [425] key_down_action
// [426] char_action
// [427] action
// [428] get_true_render_rect
// [429] is_inside
// [430] set_focus
// [431] set_tab_order
// [432] set_tab_order
// [433] get_help_info
// [434] stop_sound_system
// [435] restart_sound_system
// [436] take_snapshot
// [437] handle_reactivate
// [438] draw_background
// [439] set_ideal_size
// [440] create_button
// [441] create_button
// [442] create_check_box
// [443] create_radio_button
// [444] create_text
// [445] create_text
// [446] create_text
// [447] create_input
// [448] create_edit
// [449] create_drop_down
// [450] create_list
// [451] create_scrollbar
// [452] create_auto_scrollbar
// [453] create_vert_slider
// [454] create_horz_slider
// [455] position_panel
// [456] setup
// [457] setup
// [458] `scalar_deleting_destructor'
// [459] setup
// [460] set_rect
// [461] set_rect
// [462] set_color
// [463] set_active
// [464] set_positioning
// [465] set_fixed_position
// [466] set_redraw
// [467] set_overlapped_redraw
// [468] draw_setup
// [469] draw_finish
// [470] draw
// [471] draw_rect
// [472] draw_offset
// [473] draw_rect2
// [474] draw_offset2
// [475] paint
// [476] wnd_proc
// [477] handle_idle
// [478] handle_size
// [479] handle_paint
// [480] handle_key_down
// [481] handle_char
// [482] handle_command
// [483] handle_user_command
// [484] handle_timer_command
// [485] handle_scroll
// [486] handle_mouse_down
// [487] handle_mouse_move
// [488] handle_mouse_up
// [489] handle_mouse_dbl_click
// [490] mouse_move_action
// [491] mouse_left_down_action
// [492] mouse_left_hold_action
// [493] mouse_left_move_action
// [494] mouse_left_up_action
// [495] mouse_left_dbl_click_action
// [496] mouse_right_down_action
// [497] mouse_right_hold_action
// [498] mouse_right_move_action
// [499] mouse_right_up_action
// [500] mouse_right_dbl_click_action
// [501] key_down_action
// [502] char_action
// [503] action
// [504] get_true_render_rect
// [505] is_inside
// [506] set_focus
// [507] set_tab_order
// [508] set_tab_order
// [509] get_help_info
// [510] stop_sound_system
// [511] restart_sound_system
// [512] take_snapshot
// [513] handle_reactivate
// [514] draw_background
// [515] set_ideal_size
// [516] create_button
// [517] create_button
// [518] create_check_box
// [519] create_radio_button
// [520] create_text
// [521] create_text
// [522] create_text
// [523] create_input
// [524] create_edit
// [525] create_drop_down
// [526] create_list
// [527] create_scrollbar
// [528] create_auto_scrollbar
// [529] create_vert_slider
// [530] create_horz_slider
// [531] position_panel
// [532] setup
// [533] setup
// [534] `vector_deleting_destructor'
// [535] setup
// [536] set_rect
// [537] set_rect
// [538] set_color
// [539] set_active
// [540] set_positioning
// [541] set_fixed_position
// [542] set_redraw
// [543] set_overlapped_redraw
// [544] draw_setup
// [545] draw_finish
// [546] draw
// [547] draw_rect
// [548] draw_offset
// [549] draw_rect2
// [550] draw_offset2
// [551] paint
// [552] wnd_proc
// [553] handle_idle
// [554] handle_size
// [555] handle_paint
// [556] handle_key_down
// [557] handle_char
// [558] handle_command
// [559] handle_user_command
// [560] handle_timer_command
// [561] handle_scroll
// [562] handle_mouse_down
// [563] handle_mouse_move
// [564] handle_mouse_up
// [565] handle_mouse_dbl_click
// [566] mouse_move_action
// [567] mouse_left_down_action
// [568] mouse_left_hold_action
// [569] mouse_left_move_action
// [570] mouse_left_up_action
// [571] mouse_left_dbl_click_action
// [572] mouse_right_down_action
// [573] mouse_right_hold_action
// [574] mouse_right_move_action
// [575] mouse_right_up_action
// [576] mouse_right_dbl_click_action
// [577] key_down_action
// [578] char_action
// [579] action
// [580] get_true_render_rect
// [581] is_inside
// [582] set_focus
// [583] set_tab_order
// [584] set_tab_order
// [585] get_help_info
// [586] stop_sound_system
// [587] restart_sound_system
// [588] take_snapshot
// [589] handle_reactivate
// [590] draw_background
// [591] set_ideal_size
// [592] create_button
// [593] create_button
// [594] create_check_box
// [595] create_radio_button
// [596] create_text
// [597] create_text
// [598] create_text
// [599] create_input
// [600] create_edit
// [601] create_drop_down
// [602] create_list
// [603] create_scrollbar
// [604] create_auto_scrollbar
// [605] create_vert_slider
// [606] create_horz_slider
// [607] position_panel
// [608] setup
// [609] setup
// [610] `scalar_deleting_destructor'
// [611] recycle_in_to_game
// [612] recycle_out_of_game
// [613] draw
// [614] shadow_draw
// [615] normal_draw
// [616] draw_front_frame
// [617] draw_back_frame
// [618] draw_frame
// [619] update
// [620] check_damage_sprites
// [621] rehook
// [622] save
// [623] teleport
// [624] new_sprite
// [625] add_overlay_sprite
// [626] remove_overlay_sprite
// [627] change_ownership
// [628] modify
// [629] modify_delta
// [630] modify_percent
// [631] transform
// [632] copy_obj
// [633] set_object_state
// [634] remove_visible_resource
// [635] create_doppleganger_when_dying
// [636] destroy_obj
// [637] die_die_die
// [638] damage
// [639] calculateDamage
// [640] rotate
// [641] can_attack
// [642] set_attribute
// [643] set_attribute_amount
// [644] heal
// [645] heal
// [646] canRepair
// [647] notify_of_relation
// [648] do_command
// [649] move_to
// [650] work
// [651] stop
// [652] set_attack
// [653] play_command_sound
// [654] play_move_sound
// [655] new_angle
// [656] spawn_death_obj
// [657] get_command_master
// [658] set_being_worked_on
// [659] release_being_worked_on
// [660] is_moving
// [661] get_target_obj
// [662] enter_obj
// [663] exit_obj
// [664] explore_terrain
// [665] unexplore_terrain
// [666] get_los_table
// [667] inAttackRange
// [668] underAttack
// [669] setUnderAttack
// [670] calc_attack_modifier
// [671] getSpeed
// [672] getAngle
// [673] maximumSpeed
// [674] rateOfFire
// [675] damageCapability
// [676] damageCapability
// [677] weaponRange
// [678] minimumWeaponRange
// [679] passableTile
// [680] facetToNextWaypoint
// [681] currentTargetID
// [682] currentTargetX
// [683] currentTargetY
// [684] currentTargetZ
// [685] setWaitingToMove
// [686] waitingToMove
// [687] actionState
// [688] keepGatheringWhenObjectIsOut
// [689] produceWhenKilledBy
// [690] useSameZoneDropsite
// [691] logDebug
// [692] notify
// [693] attack
// [694] attack
// [695] moveTo
// [696] moveTo
// [697] moveTo
// [698] moveAwayFrom
// [699] hunt
// [700] gather
// [701] convert
// [702] repair
// [703] build
// [704] trade
// [705] explore
// [706] enter
// [707] unload
// [708] transport
// [709] stopAction
// [710] pause
// [711] canPath
// [712] canPath
// [713] canBidirectionPath
// [714] canPathWithObstructions
// [715] canPathWithAdditionalPassability
// [716] findFirstTerrainAlongExceptionPath
// [717] canLinePath
// [718] canLinePath
// [719] firstTileAlongLine
// [720] userDefinedWaypoint
// [721] addUserDefinedWaypoint
// [722] removeAllUserDefinedWaypoints
// [723] removeUserDefinedWaypoint
// [724] numberUserDefinedWaypoints
// [725] findAvoidancePath
// [726] get_action_checksum
// [727] get_waypoint_checksum
// [728] setup
// [729] setup
// [730] create_object_list
// [731] create_sprite_list
// [732] setup
// [733] recycle_in_to_game
// [734] validate
// [735] setup
//
// Member Layout:
// [0x490] TTextPanel *[8] title (sz: 0x20)
// [0x4B0] TTextPanel *[8] playerName (sz: 0x20)
// [0x4D0] TTextPanel *[8] playerVictoryScores (sz: 0x20)
// [0x4F0] TTextPanel *[8] playerCivilization (sz: 0x20)
// [0x510] TTextPanel * needMarket
// [0x514] TButtonPanel *[8] goldTributeButton (sz: 0x20)
// [0x534] TButtonPanel *[8] woodTributeButton (sz: 0x20)
// [0x554] TButtonPanel *[8] foodTributeButton (sz: 0x20)
// [0x574] TButtonPanel *[8] stoneTributeButton (sz: 0x20)
// [0x594] TButtonPanel *[24] allyButton (sz: 0x60)
// [0x5F4] TButtonPanel * allianceButton
// [0x5F8] TButtonPanel * okButton
// [0x5FC] TButtonPanel * clearButton
// [0x600] TButtonPanel * cancelButton
// [0x604] TButtonPanel * help_button
// [0x608] TShape * buttonPics
// [0x60C] TShape * backgroundPics
// [0x610] float foodTotal
// [0x614] float woodTotal
// [0x618] float goldTotal
// [0x61C] float stoneTotal
// [0x620] TTextPanel * playerFood
// [0x624] TTextPanel * playerGold
// [0x628] TTextPanel * playerWood
// [0x62C] TTextPanel * playerStone
// [0x630] float[8] goldTributeAmount (sz: 0x20)
// [0x650] float[8] foodTributeAmount (sz: 0x20)
// [0x670] float[8] stoneTributeAmount (sz: 0x20)
// [0x690] float[8] woodTributeAmount (sz: 0x20)
// [0x6B0] int cur_player_row
// [0x6B4] int tribute_flag
// ----------------------------------------------------------------

// Function: TribeDiplomacyDialog
// Address: 0043c930
// [HELPER] s_Diplomacy_Dialog: "Diplomacy Dialog"
// [HELPER] s__ld: "%ld"
// [HELPER] s_dlg_plbn_shp: "dlg_plbn.shp"
// [HELPER] s_tradicon_shp: "tradicon.shp"
TribeDiplomacyDialog * __thiscall
TribeDiplomacyDialog::TribeDiplomacyDialog(TribeDiplomacyDialog *this,TScreenPanel *param_1)
{
  TButtonPanel **ppTVar1;
  TTextPanel **ppTVar2;
  RGE_Game_World *pRVar3;
  TButtonPanel *pTVar4;
  bool bVar5;
  byte bVar6;
  uchar uVar7;
  short sVar8;
  TTextPanel **ppTVar9;
  long lVar10;
  char *pcVar11;
  TDrawArea *pTVar12;
  TShape *pTVar13;
  undefined4 uVar14;
  int iVar15;
  RGE_Game_World *pRVar16;
  RGE_Player *pRVar17;
  int iVar18;
  undefined4 extraout_ECX;
  uint uVar19;
  TButtonPanel **ppTVar20;
  TButtonPanel **ppTVar21;
  undefined4 *puVar22;
  undefined4 *unaff_FS_OFFSET;
  long lVar23;
  float fVar24;
  long lVar25;
  float fVar26;
  uchar uVar27;
  RGE_Static_Object *pRVar28;
  TButtonPanel **local_130;
  int a;
  RGE_Game_World *world;
  int humanity;
  int iStack_120;
  int tabCount;
  uint local_118;
  int disable_buttons;
  tagPALETTEENTRY paletteColor;
  char temp_str [100];
  TPanel *tabList [35];
  undefined4 local_c;
  code *pcStack_8;
  int local_4;
  
  local_4 = 0xffffffff;
  pcStack_8 = FUN_0055d047;
  local_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &local_c;
  TDialogPanel::TDialogPanel((TDialogPanel *)this,s_Diplomacy_Dialog);
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  ppTVar9 = this->playerName;
  iVar18 = 8;
  do {
    ppTVar9[-8] = (TTextPanel *)0x0;
    *ppTVar9 = (TTextPanel *)0x0;
    ppTVar9[8] = (TTextPanel *)0x0;
    ppTVar9[0x10] = (TTextPanel *)0x0;
    ppTVar9[0x19] = (TTextPanel *)0x0;
    ppTVar9[0x29] = (TTextPanel *)0x0;
    ppTVar9[0x21] = (TTextPanel *)0x0;
    ppTVar9[0x31] = (TTextPanel *)0x0;
    ppTVar9[0x60] = (TTextPanel *)0x0;
    ppTVar9[0x68] = (TTextPanel *)0x0;
    ppTVar9[0x70] = (TTextPanel *)0x0;
    ppTVar9[0x78] = (TTextPanel *)0x0;
    ppTVar9 = ppTVar9 + 1;
    iVar18 = iVar18 + -1;
  } while (iVar18 != 0);
  ppTVar21 = this->allyButton;
  for (iVar18 = 0x18; iVar18 != 0; iVar18 = iVar18 + -1) {
    *ppTVar21 = (TButtonPanel *)0x0;
    ppTVar21 = ppTVar21 + 1;
  }
  iVar18 = 1;
  this->allianceButton = (TButtonPanel *)0x0;
  this->okButton = (TButtonPanel *)0x0;
  this->cancelButton = (TButtonPanel *)0x0;
  this->clearButton = (TButtonPanel *)0x0;
  this->help_button = (TButtonPanel *)0x0;
  this->needMarket = (TTextPanel *)0x0;
  this->buttonPics = (TShape *)0x0;
  this->backgroundPics = (TShape *)0x0;
  this->playerWood = (TTextPanel *)0x0;
  this->playerStone = (TTextPanel *)0x0;
  this->playerGold = (TTextPanel *)0x0;
  this->playerFood = (TTextPanel *)0x0;
  this->woodTotal = 0.0;
  this->stoneTotal = 0.0;
  this->foodTotal = 0.0;
  this->goldTotal = 0.0;
  this->tribute_flag = 0;
  lVar10 = TEasy_Panel::get_popup_info_id((TEasy_Panel *)param_1);
  pcVar11 = TEasy_Panel::get_popup_info_file((TEasy_Panel *)param_1);
  lVar25 = 0x195;
  lVar23 = 0x271;
  pTVar12 = TPanel::renderArea((TPanel *)param_1);
  iVar18 = TDialogPanel::setup((TDialogPanel *)this,pTVar12,(TPanel *)param_1,lVar23,lVar25,pcVar11,
                               lVar10,iVar18);
  if (iVar18 != 0) {
    pTVar13 = (TShape *)operator_new(0x20);
    local_4._0_1_ = 1;
    if (pTVar13 == (TShape *)0x0) {
      pTVar13 = (TShape *)0x0;
    }
    else {
      pTVar13 = (TShape *)TShape::TShape(pTVar13,s_tradicon_shp,0xc62c);
    }
    local_4._0_1_ = 0;
    this->buttonPics = pTVar13;
    if (pTVar13 != (TShape *)0x0) {
      pTVar13 = (TShape *)operator_new(0x20);
      local_4._0_1_ = 2;
      if (pTVar13 == (TShape *)0x0) {
        pTVar13 = (TShape *)0x0;
      }
      else {
        pTVar13 = (TShape *)TShape::TShape(pTVar13,s_dlg_plbn_shp,0xc63a);
      }
      local_4 = (uint)local_4._1_3_ << 8;
      this->backgroundPics = pTVar13;
      if (pTVar13 != (TShape *)0x0) {
        RGE_Base_Game::get_font(rge_base_game,1);
        iVar18 = TEasy_Panel::create_text
                           ((TEasy_Panel *)this,(TPanel *)this,this->title,0x267b,0x48,5,500,0x1e,1,
                            1,1,0);
        if (((((iVar18 != 0) &&
              (iVar18 = TEasy_Panel::create_text
                                  ((TEasy_Panel *)this,(TPanel *)this,&this->needMarket,0x2687,0x1b8
                                   ,0x6e,0xaf,0x3c,0xb,1,1,1), iVar18 != 0)) &&
             (iVar18 = TEasy_Panel::create_text
                                 ((TEasy_Panel *)this,(TPanel *)this,this->title + 1,0x2686,5,0x32,
                                  0x82,0x1e,0xb,0,1,0), iVar18 != 0)) &&
            ((iVar18 = TEasy_Panel::create_text
                                 ((TEasy_Panel *)this,(TPanel *)this,this->title + 2,0x267c,0x89,
                                  0x32,0x50,0x1e,0xb,0,1,0), iVar18 != 0 &&
             (iVar18 = TEasy_Panel::create_text
                                 ((TEasy_Panel *)this,(TPanel *)this,this->title + 3,0x267d,0xeb,
                                  0x32,0x46,0x1e,0xb,0,1,0), iVar18 != 0)))) &&
           ((iVar18 = TEasy_Panel::create_text
                                ((TEasy_Panel *)this,(TPanel *)this,this->title + 4,0x267e,0x122,
                                 0x32,0x46,0x1e,0xb,0,1,0), iVar18 != 0 &&
            (iVar18 = TEasy_Panel::create_text
                                ((TEasy_Panel *)this,(TPanel *)this,this->title + 5,0x267f,0x168,
                                 0x32,0x46,0x1e,0xb,0,1,0), iVar18 != 0)))) {
          RGE_Base_Game::get_player(rge_base_game);
          uVar14 = __ftol();
          pcVar11 = TPanel::get_string((TPanel *)this,0x2680);
          sprintf(temp_str + 4,pcVar11,uVar14);
          iVar18 = TEasy_Panel::create_text
                             ((TEasy_Panel *)this,(TPanel *)this,this->title + 6,temp_str + 4,0x1b8,
                              0x32,0xb4,0x1e,0xb,0,1,0);
          if ((iVar18 != 0) &&
             (iVar18 = TEasy_Panel::create_text
                                 ((TEasy_Panel *)this,(TPanel *)this,this->title + 7,0x2681,0x13e,
                                  0x14a,300,0x1e,0xb,0,1,0), iVar18 != 0)) {
            this->cur_player_row = -1;
            world = (RGE_Game_World *)0x1;
            pRVar3 = rge_base_game->world;
            if (pRVar3->player_num != 1 && -1 < pRVar3->player_num + -1) {
              local_130 = this->woodTributeButton;
              tabCount = (int)this->allyButton;
              disable_buttons = 0;
              a = 0x50;
              do {
                iVar18 = (-0x530 - (int)this) + (int)local_130;
                GetPaletteEntries(this->_padding_,
                                  *(undefined1 *)
                                   (*(int *)(*(int *)(iVar18 + (int)pRVar3->players) + 0x108) + 0x25
                                   ),1,temp_str);
                if (((rge_base_game->prog_mode == 5) ||
                    (world == (RGE_Game_World *)(int)pRVar3->curr_player)) ||
                   (*(char *)(*(int *)(iVar18 + (int)pRVar3->players) + 0x80) != '\0')) {
                  bVar5 = true;
                }
                else {
                  bVar5 = false;
                }
                if (world == (RGE_Game_World *)(int)pRVar3->curr_player) {
                  this->cur_player_row = (int)((int)&world[-1].difficultyLevelValue + 3);
                }
                bVar6 = 0;
                if (*(char *)(*(int *)(iVar18 + (int)pRVar3->players) + 0x80) == '\x02') {
LAB_0043ce5d:
                  bVar6 = 1;
                }
                else {
                  iVar15 = RGE_Base_Game::multiplayerGame(rge_base_game);
                  if (iVar15 != 0) {
                    iStack_120 = 0;
                    uVar19 = 1;
                    iVar15 = RGE_Base_Game::numberPlayers(rge_base_game);
                    if (0 < iVar15) {
                      do {
                        pRVar16 = (RGE_Game_World *)RGE_Base_Game::playerID(rge_base_game,uVar19);
                        if ((pRVar16 == world) &&
                           ((iVar15 = TCommunications_Handler::GetPlayerHumanity(comm,uVar19),
                            iVar15 == 2 || (iVar15 == 4)))) {
                          iStack_120 = iVar15;
                        }
                        uVar19 = uVar19 + 1;
                        iVar15 = RGE_Base_Game::numberPlayers(rge_base_game);
                      } while ((int)uVar19 <= iVar15);
                    }
                    if ((iStack_120 != 2) && (iStack_120 != 4)) goto LAB_0043ce5d;
                  }
                }
                iVar15 = TEasy_Panel::create_text
                                   ((TEasy_Panel *)this,(TPanel *)this,
                                    (TTextPanel **)(local_130 + -0x21),
                                    *(char **)(*(int *)(iVar18 + (int)pRVar3->players) + 0x44),5,a,
                                    0x82,0x1e,(-(uint)bVar6 & 0xfffffffd) + 0xb,0,1,0);
                if (iVar15 == 0) goto LAB_0043d694;
                (**(code **)(rge_base_game->_padding_ + 0x28))
                          (0x69,*(undefined1 *)(*(int *)(iVar18 + (int)pRVar3->players) + 0x105),0,
                           temp_str + 4,100);
                iVar18 = TEasy_Panel::create_text
                                   ((TEasy_Panel *)this,(TPanel *)this,
                                    (TTextPanel **)(local_130 + -0x11),temp_str + 4,0x89,a,100,0x1e,
                                    0xb,0,1,0);
                if (iVar18 == 0) goto LAB_0043d694;
                if (world != (RGE_Game_World *)(int)pRVar3->curr_player) {
                  iVar18 = (-0x594 - (int)this) + tabCount;
                  iVar15 = TEasy_Panel::create_radio_button
                                     ((TEasy_Panel *)this,(TPanel *)this,(TButtonPanel **)tabCount,
                                      0xf0,a,0x1e,0x1e,0,0);
                  if (iVar15 == 0) goto LAB_0043d694;
                  TPanel::set_help_info(*(TPanel **)tabCount,0x7684,-1);
                  iVar15 = TEasy_Panel::create_radio_button
                                     ((TEasy_Panel *)this,(TPanel *)this,
                                      (TButtonPanel **)(tabCount + 4),0x136,a,0x1e,0x1e,0,0);
                  if (iVar15 == 0) goto LAB_0043d694;
                  TPanel::set_help_info((TPanel *)*(TButtonPanel **)(tabCount + 4),0x7685,-1);
                  iVar15 = TEasy_Panel::create_radio_button
                                     ((TEasy_Panel *)this,(TPanel *)this,
                                      (TButtonPanel **)(tabCount + 8),0x17c,a,0x1e,0x1e,0,0);
                  if (iVar15 == 0) goto LAB_0043d694;
                  TPanel::set_help_info((TPanel *)*(TButtonPanel **)(tabCount + 8),0x7686,-1);
                  if (disable_buttons < disable_buttons + 3) {
                    iVar15 = (disable_buttons + 3) - disable_buttons;
                    puVar22 = (undefined4 *)tabCount;
                    do {
                      TButtonPanel::set_radio_info
                                ((TButtonPanel *)*puVar22,(TButtonPanel **)tabCount,3);
                      if (rge_base_game->prog_mode == 5) {
                        TButtonPanel::set_disabled((TButtonPanel *)*puVar22,1);
                      }
                      puVar22 = puVar22 + 1;
                      iVar15 = iVar15 + -1;
                    } while (iVar15 != 0);
                  }
                  pRVar16 = world;
                  pRVar17 = RGE_Base_Game::get_player(rge_base_game);
                  uVar7 = RGE_Player::relation(pRVar17,(long)pRVar16);
                  if ((world == (RGE_Game_World *)(int)pRVar3->curr_player) || (uVar7 == '\0')) {
                    TButtonPanel::set_radio_button(*(TButtonPanel **)((int)this + iVar18 + 0x594));
                  }
                  else if (uVar7 == '\x01') {
                    TButtonPanel::set_radio_button(*(TButtonPanel **)((int)this + iVar18 + 0x598));
                  }
                  else {
                    TButtonPanel::set_radio_button(*(TButtonPanel **)((int)this + iVar18 + 0x59c));
                  }
                }
                if (!bVar5) {
                  iVar18 = TEasy_Panel::create_button
                                     ((TEasy_Panel *)this,(TPanel *)this,local_130,-1,0,0x1b8,a,0x28
                                      ,0x1e,0xb,0,0);
                  if (iVar18 == 0) goto LAB_0043d694;
                  ppTVar21 = local_130 + 8;
                  iVar18 = TEasy_Panel::create_button
                                     ((TEasy_Panel *)this,(TPanel *)this,ppTVar21,-1,0,0x1e0,a,0x28,
                                      0x1e,0xb,0,0);
                  if (iVar18 == 0) goto LAB_0043d694;
                  ppTVar20 = local_130 + -8;
                  iVar18 = TEasy_Panel::create_button
                                     ((TEasy_Panel *)this,(TPanel *)this,ppTVar20,-1,0,0x208,a,0x28,
                                      0x1e,0xb,0,0);
                  if (iVar18 == 0) goto LAB_0043d694;
                  ppTVar1 = local_130 + 0x10;
                  iVar18 = TEasy_Panel::create_button
                                     ((TEasy_Panel *)this,(TPanel *)this,ppTVar1,-1,0,0x230,a,0x28,
                                      0x1e,0xb,0,0);
                  if (iVar18 == 0) goto LAB_0043d694;
                  TButtonPanel::set_picture(*local_130,0,this->buttonPics,0);
                  TButtonPanel::set_picture(*ppTVar21,0,this->buttonPics,2);
                  TButtonPanel::set_picture(*ppTVar20,0,this->buttonPics,3);
                  TButtonPanel::set_picture(*ppTVar1,0,this->buttonPics,1);
                  TButtonPanel::setDrawType(*local_130,DrawPictureAndText);
                  TButtonPanel::setDrawType(*ppTVar21,DrawPictureAndText);
                  TButtonPanel::setDrawType(*ppTVar20,DrawPictureAndText);
                  TButtonPanel::setDrawType(*ppTVar1,DrawPictureAndText);
                  TPanel::set_help_info((TPanel *)*local_130,0x7687,-1);
                  TPanel::set_help_info((TPanel *)*ppTVar21,0x7688,-1);
                  TPanel::set_help_info((TPanel *)*ppTVar20,0x7689,-1);
                  TPanel::set_help_info((TPanel *)*ppTVar1,0x768a,-1);
                }
                disable_buttons = disable_buttons + 3;
                tabCount = tabCount + 0xc;
                a = a + 0x1e;
                local_130 = local_130 + 1;
                bVar5 = (int)world < pRVar3->player_num + -1;
                world = (RGE_Game_World *)((int)&world->_padding_ + 1);
              } while (bVar5);
            }
            ppTVar21 = &this->allianceButton;
            iVar18 = TEasy_Panel::create_check_box
                               ((TEasy_Panel *)this,(TPanel *)this,ppTVar21,0x11a,0x147,0x1e,0x1e,0,
                                0);
            if (iVar18 != 0) {
              iVar18 = (*ppTVar21)->_padding_;
              pRVar17 = RGE_Base_Game::get_player(rge_base_game);
              uVar7 = RGE_Player::get_allied_victory(pRVar17);
              (**(code **)(iVar18 + 0xe0))
                        (CONCAT31((int3)((uint)extraout_ECX >> 8),uVar7) & 0xffff00ff);
              TPanel::set_help_info((TPanel *)*ppTVar21,0x768c,-1);
              if (rge_base_game->prog_mode == 5) {
                TButtonPanel::set_disabled(*ppTVar21,1);
              }
              if (rge_base_game->prog_mode != 5) {
                iVar18 = TEasy_Panel::create_button
                                   ((TEasy_Panel *)this,(TPanel *)this,&this->okButton,0xfa1,0,10,
                                    0x16f,0xbe,0x1e,0,0,0);
                if (iVar18 == 0) goto LAB_0043d694;
                TPanel::set_help_info((TPanel *)this->okButton,0x7531,-1);
                iVar18 = TEasy_Panel::create_button
                                   ((TEasy_Panel *)this,(TPanel *)this,&this->clearButton,0x2683,0,
                                    0xd7,0x16f,0xbe,0x1e,0,0,0);
                if (iVar18 == 0) goto LAB_0043d694;
                TPanel::set_help_info((TPanel *)this->clearButton,0x768b,-1);
              }
              ppTVar21 = &this->cancelButton;
              iVar18 = TEasy_Panel::create_button
                                 ((TEasy_Panel *)this,(TPanel *)this,ppTVar21,0xfa2,0,0x1a4,0x16f,
                                  0xbe,0x1e,0,0,0);
              if (iVar18 != 0) {
                TPanel::set_help_info((TPanel *)*ppTVar21,0x7532,-1);
                pTVar4 = *ppTVar21;
                pTVar4->hotkey = 0x1b;
                pTVar4->hotkey_shift = 0;
                iVar18 = TEasy_Panel::create_button
                                   ((TEasy_Panel *)this,(TPanel *)this,&this->help_button,0xfa9,0,
                                    500,0x147,0x1e,0x1e,0,0,0);
                if (iVar18 != 0) {
                  RGE_Base_Game::get_player(rge_base_game);
                  uVar14 = __ftol();
                  sprintf(temp_str + 4,s__ld,uVar14);
                  iVar18 = TEasy_Panel::create_text
                                     ((TEasy_Panel *)this,(TPanel *)this,&this->playerWood,
                                      temp_str + 4,0x1b8,this->cur_player_row * 0x1e + 0x50,0x28,
                                      0x1e,0xb,0,1,0);
                  if (iVar18 != 0) {
                    RGE_Base_Game::get_player(rge_base_game);
                    uVar14 = __ftol();
                    sprintf(temp_str + 4,s__ld,uVar14);
                    iVar18 = TEasy_Panel::create_text
                                       ((TEasy_Panel *)this,(TPanel *)this,&this->playerFood,
                                        temp_str + 4,0x1e0,this->cur_player_row * 0x1e + 0x50,0x28,
                                        0x1e,0xb,0,1,0);
                    if (iVar18 != 0) {
                      RGE_Base_Game::get_player(rge_base_game);
                      uVar14 = __ftol();
                      sprintf(temp_str + 4,s__ld,uVar14);
                      ppTVar9 = &this->playerGold;
                      iVar18 = TEasy_Panel::create_text
                                         ((TEasy_Panel *)this,(TPanel *)this,ppTVar9,temp_str + 4,
                                          0x208,this->cur_player_row * 0x1e + 0x50,0x28,0x1e,0xb,0,1
                                          ,0);
                      if (iVar18 != 0) {
                        RGE_Base_Game::get_player(rge_base_game);
                        uVar14 = __ftol();
                        sprintf(temp_str + 4,s__ld,uVar14);
                        ppTVar2 = &this->playerStone;
                        iVar18 = TEasy_Panel::create_text
                                           ((TEasy_Panel *)this,(TPanel *)this,ppTVar2,temp_str + 4,
                                            0x230,this->cur_player_row * 0x1e + 0x50,0x28,0x1e,0xb,0
                                            ,1,0);
                        if (iVar18 != 0) {
                          pRVar28 = (RGE_Static_Object *)0x0;
                          uVar27 = '\x02';
                          uVar7 = '\x01';
                          fVar26 = -1.0;
                          fVar24 = -1.0;
                          lVar10 = 0x54;
                          pRVar17 = RGE_Base_Game::get_player(rge_base_game);
                          pRVar28 = RGE_Object_List::find_by_master_id
                                              (pRVar17->objects,lVar10,fVar24,fVar26,uVar7,uVar27,
                                               pRVar28);
                          if (pRVar28 == (RGE_Static_Object *)0x0) {
                            this->tribute_flag = 0;
                            (**(code **)(this->needMarket->_padding_ + 0x14))(1);
                            (**(code **)(this->title[6]->_padding_ + 0x14))(0);
                            (**(code **)(this->playerWood->_padding_ + 0x14))(0);
                            (**(code **)(this->playerFood->_padding_ + 0x14))(0);
                            (**(code **)((*ppTVar9)->_padding_ + 0x14))(0);
                            iVar18 = (*ppTVar2)->_padding_;
                          }
                          else {
                            this->tribute_flag = 1;
                            (**(code **)(this->needMarket->_padding_ + 0x14))(0);
                            (**(code **)(this->title[6]->_padding_ + 0x14))(1);
                            (**(code **)(this->playerWood->_padding_ + 0x14))(1);
                            (**(code **)(this->playerFood->_padding_ + 0x14))(1);
                            (**(code **)((*ppTVar9)->_padding_ + 0x14))(1);
                            iVar18 = (*ppTVar2)->_padding_;
                          }
                          (**(code **)(iVar18 + 0x14))(pRVar28 != (RGE_Static_Object *)0x0);
                          sVar8 = 0x1e;
                          pRVar17 = RGE_Base_Game::get_player(rge_base_game);
                          sVar8 = TRIBE_Player_Tech::get_tech_state
                                            ((TRIBE_Player_Tech *)pRVar17[1]._padding_,sVar8);
                          if (sVar8 == 3) {
                            (**(code **)(this->title[6]->_padding_ + 0x14))(0);
                          }
                          check_gold(this);
                          check_wood(this);
                          check_food(this);
                          check_stone(this);
                          TPanel::set_curr_child((TPanel *)this,(TPanel *)this->okButton);
                          pTVar4 = this->okButton;
                          if (pTVar4 != (TButtonPanel *)0x0) {
                            tabList[1] = (TPanel *)pTVar4;
                          }
                          local_118 = (uint)(pTVar4 != (TButtonPanel *)0x0);
                          if (this->clearButton != (TButtonPanel *)0x0) {
                            tabList[local_118 + 1] = (TPanel *)this->clearButton;
                            local_118 = local_118 + 1;
                          }
                          if (this->cancelButton != (TButtonPanel *)0x0) {
                            tabList[local_118 + 1] = (TPanel *)this->cancelButton;
                            local_118 = local_118 + 1;
                          }
                          TPanel::set_tab_order((TPanel *)this,tabList + 1,(short)local_118);
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
LAB_0043d694:
  *unaff_FS_OFFSET = local_c;
  return this;
}

// --------------------------------------------------

// Function: `scalar_deleting_destructor'
// Address: 0043d6c0
void * __thiscall
TribeDiplomacyDialog::_scalar_deleting_destructor_(TribeDiplomacyDialog *this,uint param_1)
{
  ~TribeDiplomacyDialog(this);
  if ((param_1 & 1) != 0) {
    operator_delete(this);
  }
  return this;
}

// --------------------------------------------------

// Function: ~TribeDiplomacyDialog
// Address: 0043d6e0
void __thiscall TribeDiplomacyDialog::~TribeDiplomacyDialog(TribeDiplomacyDialog *this)
{
  TShape *pTVar1;
  TTextPanel **ppTVar2;
  TButtonPanel **ppTVar3;
  int iVar4;
  undefined4 *unaff_FS_OFFSET;
  undefined4 uStack_c;
  code *pcStack_8;
  undefined4 local_4;
  
  pcStack_8 = FUN_0055d068;
  uStack_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &uStack_c;
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  ppTVar2 = this->playerVictoryScores;
  iVar4 = 8;
  do {
    if (ppTVar2[-0x10] != (TTextPanel *)0x0) {
      (**(code **)ppTVar2[-0x10]->_padding_)(1);
    }
    if (*ppTVar2 != (TTextPanel *)0x0) {
      (**(code **)(*ppTVar2)->_padding_)(1);
    }
    if (ppTVar2[-8] != (TTextPanel *)0x0) {
      (**(code **)ppTVar2[-8]->_padding_)(1);
    }
    if (ppTVar2[8] != (TTextPanel *)0x0) {
      (**(code **)ppTVar2[8]->_padding_)(1);
    }
    if ((TButtonPanel *)ppTVar2[0x19] != (TButtonPanel *)0x0) {
      (**(code **)((TButtonPanel *)ppTVar2[0x19])->_padding_)(1);
    }
    if ((TButtonPanel *)ppTVar2[0x21] != (TButtonPanel *)0x0) {
      (**(code **)((TButtonPanel *)ppTVar2[0x21])->_padding_)(1);
    }
    if ((TButtonPanel *)ppTVar2[0x11] != (TButtonPanel *)0x0) {
      (**(code **)((TButtonPanel *)ppTVar2[0x11])->_padding_)(1);
    }
    if ((TButtonPanel *)ppTVar2[0x29] != (TButtonPanel *)0x0) {
      (**(code **)((TButtonPanel *)ppTVar2[0x29])->_padding_)(1);
    }
    ppTVar2 = ppTVar2 + 1;
    iVar4 = iVar4 + -1;
  } while (iVar4 != 0);
  ppTVar3 = this->allyButton;
  iVar4 = 0x18;
  do {
    if (*ppTVar3 != (TButtonPanel *)0x0) {
      (**(code **)(*ppTVar3)->_padding_)(1);
    }
    ppTVar3 = ppTVar3 + 1;
    iVar4 = iVar4 + -1;
  } while (iVar4 != 0);
  if (this->allianceButton != (TButtonPanel *)0x0) {
    (**(code **)this->allianceButton->_padding_)(1);
  }
  if (this->okButton != (TButtonPanel *)0x0) {
    (**(code **)this->okButton->_padding_)(1);
  }
  if (this->cancelButton != (TButtonPanel *)0x0) {
    (**(code **)this->cancelButton->_padding_)(1);
  }
  if (this->clearButton != (TButtonPanel *)0x0) {
    (**(code **)this->clearButton->_padding_)(1);
  }
  if (this->help_button != (TButtonPanel *)0x0) {
    (**(code **)this->help_button->_padding_)(1);
  }
  if (this->playerFood != (TTextPanel *)0x0) {
    (**(code **)this->playerFood->_padding_)(1);
  }
  if (this->playerGold != (TTextPanel *)0x0) {
    (**(code **)this->playerGold->_padding_)(1);
  }
  if (this->playerWood != (TTextPanel *)0x0) {
    (**(code **)this->playerWood->_padding_)(1);
  }
  if (this->playerStone != (TTextPanel *)0x0) {
    (**(code **)this->playerStone->_padding_)(1);
  }
  if (this->needMarket != (TTextPanel *)0x0) {
    (**(code **)this->needMarket->_padding_)(1);
  }
  pTVar1 = this->buttonPics;
  if (pTVar1 != (TShape *)0x0) {
    TShape::~TShape(pTVar1);
    operator_delete(pTVar1);
  }
  pTVar1 = this->backgroundPics;
  if (pTVar1 != (TShape *)0x0) {
    TShape::~TShape(pTVar1);
    operator_delete(pTVar1);
  }
  local_4 = 0xffffffff;
  TDialogPanel::~TDialogPanel((TDialogPanel *)this);
  *unaff_FS_OFFSET = uStack_c;
  return;
}

// --------------------------------------------------

// Function: action
// Address: 0043d8a0
// [HELPER] s_: ""
// [HELPER] s_Diplomacy_Dialog: "Diplomacy Dialog"
// [HELPER] s_Game_Screen: "Game Screen"
// [HELPER] s__ld: "%ld"
long __thiscall
TribeDiplomacyDialog::action
          (TribeDiplomacyDialog *this,TPanel *param_1,long param_2,ulong param_3,ulong param_4)
{
  RGE_Command *this_00;
  bool bVar1;
  float fVar2;
  byte bVar3;
  uchar uVar4;
  byte bVar5;
  RGE_Player *pRVar6;
  uint uVar7;
  RGE_Game_World *pRVar9;
  int iVar10;
  undefined4 uVar11;
  TButtonPanel **ppTVar12;
  long lVar13;
  float *pfVar14;
  TRIBE_Command *pTVar15;
  int iVar16;
  ushort uVar17;
  float cost;
  TRIBE_Command *tc;
  char temp_str [256];
  int iVar8;
  
  if ((param_1 == (TPanel *)0x0) || (param_2 != 1)) {
LAB_0043de3c:
    lVar13 = TPanel::action((TPanel *)this,param_1,param_2,param_3,param_4);
    return lVar13;
  }
  if ((TButtonPanel *)param_1 == this->okButton) {
    this_00 = rge_base_game->world->commands;
    temp_str._0_4_ = this_00;
    if (allow_user_commands != 0) {
      pRVar6 = RGE_Base_Game::get_player(rge_base_game);
      bVar3 = RGE_Player::get_allied_victory(pRVar6);
      uVar7 = TButtonPanel::get_state(this->allianceButton);
      if (uVar7 != bVar3) {
        iVar8 = TButtonPanel::get_state(this->allianceButton);
        uVar4 = (uchar)iVar8;
        pRVar6 = RGE_Base_Game::get_player(rge_base_game);
        TRIBE_Command::command_allied_victory((TRIBE_Command *)this_00,pRVar6->id,uVar4);
      }
    }
    pRVar9 = rge_base_game->world;
    if (pRVar9->player_num != 1 && -1 < pRVar9->player_num + -1) {
      pfVar14 = this->woodTributeAmount;
      pTVar15 = (TRIBE_Command *)this->allyButton;
      iVar8 = 1;
      do {
        tc = pTVar15;
        if ((iVar8 != pRVar9->curr_player) && (*(TButtonPanel **)pTVar15 != (TButtonPanel *)0x0)) {
          iVar10 = TButtonPanel::get_state(*(TButtonPanel **)pTVar15);
          if (iVar10 == 1) {
            bVar3 = 0;
          }
          else {
            iVar10 = TButtonPanel::get_state(*(TButtonPanel **)&pTVar15->field_0x4);
            bVar3 = (-(iVar10 != 1) & 2U) + 1;
          }
          if (allow_user_commands != 0) {
            iVar10 = iVar8;
            pRVar6 = RGE_Base_Game::get_player(rge_base_game);
            bVar5 = RGE_Player::relation(pRVar6,iVar10);
            if (bVar5 != bVar3) {
              uVar17 = (ushort)bVar3;
              iVar10 = iVar8;
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              TRIBE_Command::command_relation
                        ((TRIBE_Command *)temp_str._0_4_,pRVar6->id,(short)iVar10,uVar17);
            }
            if (_DAT_0056f884 < pfVar14[-0x18]) {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              iVar10 = pRVar6->_padding_;
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              (**(code **)(iVar10 + 0xf8))(iVar8,3,pfVar14[-0x18],pRVar6->attributes[0x2e]);
            }
            if (_DAT_0056f884 < *pfVar14) {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              iVar10 = pRVar6->_padding_;
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              (**(code **)(iVar10 + 0xf8))(iVar8,1,*pfVar14,pRVar6->attributes[0x2e]);
            }
            if (_DAT_0056f884 < pfVar14[-0x10]) {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              iVar10 = pRVar6->_padding_;
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              (**(code **)(iVar10 + 0xf8))(iVar8,0,pfVar14[-0x10],pRVar6->attributes[0x2e]);
            }
            if (_DAT_0056f884 < pfVar14[-8]) {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              iVar10 = pRVar6->_padding_;
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              (**(code **)(iVar10 + 0xf8))(iVar8,2,pfVar14[-8],pRVar6->attributes[0x2e]);
            }
          }
        }
        pTVar15 = (TRIBE_Command *)&tc->field_0xc;
        pRVar9 = rge_base_game->world;
        pfVar14 = pfVar14 + 1;
        bVar1 = iVar8 < pRVar9->player_num + -1;
        iVar8 = iVar8 + 1;
      } while (bVar1);
      tc = pTVar15;
      iVar8 = RGE_Base_Game::singlePlayerGame(rge_base_game);
      if ((iVar8 == 1) && (rge_base_game->save_paused == 0)) {
        RGE_Base_Game::set_paused(rge_base_game,0,0);
        TPanelSystem::setCurrentPanel(&panel_system,s_Game_Screen,0);
        TPanelSystem::destroyPanel(&panel_system,s_Diplomacy_Dialog);
        return 1;
      }
      goto LAB_0043dbaa;
    }
  }
  else if ((TButtonPanel *)param_1 != this->cancelButton) {
    if ((TButtonPanel *)param_1 == this->help_button) {
      TEasy_Panel::setup_popup_help((TEasy_Panel *)this);
      return 1;
    }
    if ((TButtonPanel *)param_1 == this->clearButton) {
      ppTVar12 = this->foodTributeButton;
      this->foodTotal = 0.0;
      this->goldTotal = 0.0;
      this->stoneTotal = 0.0;
      this->woodTotal = 0.0;
      iVar8 = 8;
      do {
        if (ppTVar12[-0x10] != (TButtonPanel *)0x0) {
          TButtonPanel::set_text(ppTVar12[-0x10],0,s_);
        }
        if (*ppTVar12 != (TButtonPanel *)0x0) {
          TButtonPanel::set_text(*ppTVar12,0,s_);
        }
        if (ppTVar12[-8] != (TButtonPanel *)0x0) {
          TButtonPanel::set_text(ppTVar12[-8],0,s_);
        }
        if (ppTVar12[8] != (TButtonPanel *)0x0) {
          TButtonPanel::set_text(ppTVar12[8],0,s_);
        }
        ppTVar12[0x37] = (TButtonPanel *)0x0;
        ppTVar12[0x3f] = (TButtonPanel *)0x0;
        ppTVar12[0x47] = (TButtonPanel *)0x0;
        ppTVar12[0x4f] = (TButtonPanel *)0x0;
        ppTVar12 = ppTVar12 + 1;
        iVar8 = iVar8 + -1;
      } while (iVar8 != 0);
      RGE_Base_Game::get_player(rge_base_game);
      uVar11 = __ftol();
      sprintf(temp_str + 4,s__ld,uVar11);
      (**(code **)(this->playerGold->_padding_ + 0xe8))(temp_str + 4);
      RGE_Base_Game::get_player(rge_base_game);
      uVar11 = __ftol();
      sprintf(temp_str,s__ld,uVar11);
      (**(code **)(this->playerFood->_padding_ + 0xe8))(temp_str);
      RGE_Base_Game::get_player(rge_base_game);
      uVar11 = __ftol();
      sprintf(&tc,s__ld,uVar11);
      (**(code **)(this->playerWood->_padding_ + 0xe8))(&tc);
      RGE_Base_Game::get_player(rge_base_game);
      uVar11 = __ftol();
      sprintf(&cost,s__ld,uVar11);
      (**(code **)(this->playerStone->_padding_ + 0xe8))(&cost);
      check_gold(this);
      check_wood(this);
      check_stone(this);
      check_food(this);
      return 1;
    }
    tc = (TRIBE_Command *)0x0;
    pRVar6 = RGE_Base_Game::get_player(rge_base_game);
    if ((float)_DAT_0056f888 < pRVar6->attributes[0x2e]) {
      pRVar6 = RGE_Base_Game::get_player(rge_base_game);
      tc = (TRIBE_Command *)pRVar6->attributes[0x2e];
    }
    iVar10 = 0;
    iVar16 = 1;
    iVar8 = rge_base_game->world->player_num + -1;
    if (0 < iVar8) {
      ppTVar12 = this->woodTributeButton;
      do {
        if ((TButtonPanel *)param_1 == ppTVar12[-8]) {
          iVar8 = check_gold(this);
          if (iVar8 == 0) {
            tc = (TRIBE_Command *)((float)tc - _DAT_0056f890);
            pRVar6 = RGE_Base_Game::get_player(rge_base_game);
            if ((float)tc * _DAT_0056f880 <= pRVar6->attributes[3] - this->goldTotal) {
              fVar2 = (float)tc * _DAT_0056f894;
              this->goldTributeAmount[iVar16 + -1] =
                   this->goldTributeAmount[iVar16 + -1] - _DAT_0056f894;
              fVar2 = this->goldTotal - fVar2;
            }
            else {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              fVar2 = (pRVar6->attributes[3] - this->goldTotal) / (float)tc;
              this->goldTributeAmount[iVar16 + -1] = fVar2 + this->goldTributeAmount[iVar16 + -1];
              fVar2 = fVar2 * (float)tc + this->goldTotal;
            }
            this->goldTotal = fVar2;
            RGE_Base_Game::get_player(rge_base_game);
            uVar11 = __ftol();
            sprintf(temp_str + 4,s__ld,uVar11);
            (**(code **)(this->playerGold->_padding_ + 0xe8))(temp_str + 4);
            uVar11 = __ftol();
            sprintf(temp_str,s__ld,uVar11);
            TButtonPanel::set_text(this->goldTributeButton[iVar10],0,temp_str);
            check_gold(this);
            return 1;
          }
          RGE_Base_Game::get_player(rge_base_game);
          uVar11 = __ftol();
          sprintf(temp_str + 4,s__ld,uVar11);
          (**(code **)(this->playerGold->_padding_ + 0xe8))(temp_str + 4);
          check_gold(this);
          return 1;
        }
        if ((TButtonPanel *)param_1 == *ppTVar12) {
          iVar8 = check_wood(this);
          if (iVar8 == 0) {
            tc = (TRIBE_Command *)((float)tc - _DAT_0056f890);
            pRVar6 = RGE_Base_Game::get_player(rge_base_game);
            if ((float)tc * _DAT_0056f880 <= pRVar6->attributes[1] - this->woodTotal) {
              fVar2 = (float)tc * _DAT_0056f894;
              this->stoneTributeAmount[iVar16 + 7] =
                   this->stoneTributeAmount[iVar16 + 7] - _DAT_0056f894;
              fVar2 = this->woodTotal - fVar2;
            }
            else {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              fVar2 = (pRVar6->attributes[1] - this->woodTotal) / (float)tc;
              this->stoneTributeAmount[iVar16 + 7] = fVar2 + this->stoneTributeAmount[iVar16 + 7];
              fVar2 = fVar2 * (float)tc + this->woodTotal;
            }
            this->woodTotal = fVar2;
            RGE_Base_Game::get_player(rge_base_game);
            uVar11 = __ftol();
            sprintf(temp_str + 4,s__ld,uVar11);
            (**(code **)(this->playerWood->_padding_ + 0xe8))(temp_str + 4);
            uVar11 = __ftol();
            sprintf(temp_str,s__ld,uVar11);
            TButtonPanel::set_text(this->woodTributeButton[iVar10],0,temp_str);
            check_wood(this);
            return 1;
          }
          RGE_Base_Game::get_player(rge_base_game);
          uVar11 = __ftol();
          sprintf(temp_str + 4,s__ld,uVar11);
          (**(code **)(this->playerWood->_padding_ + 0xe8))(temp_str + 4);
          check_wood(this);
          return 1;
        }
        if ((TButtonPanel *)param_1 == ppTVar12[8]) {
          iVar8 = check_food(this);
          if (iVar8 == 0) {
            tc = (TRIBE_Command *)((float)tc - _DAT_0056f890);
            pRVar6 = RGE_Base_Game::get_player(rge_base_game);
            if ((float)tc * _DAT_0056f880 <= *pRVar6->attributes - this->foodTotal) {
              fVar2 = (float)tc * _DAT_0056f894;
              this->goldTributeAmount[iVar16 + 7] =
                   this->goldTributeAmount[iVar16 + 7] - _DAT_0056f894;
              fVar2 = this->foodTotal - fVar2;
            }
            else {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              fVar2 = (*pRVar6->attributes - this->foodTotal) / (float)tc;
              this->goldTributeAmount[iVar16 + 7] = fVar2 + this->goldTributeAmount[iVar16 + 7];
              fVar2 = fVar2 * (float)tc + this->foodTotal;
            }
            this->foodTotal = fVar2;
            RGE_Base_Game::get_player(rge_base_game);
            uVar11 = __ftol();
            sprintf(temp_str + 4,s__ld,uVar11);
            (**(code **)(this->playerFood->_padding_ + 0xe8))(temp_str + 4);
            uVar11 = __ftol();
            sprintf(temp_str,s__ld,uVar11);
            TButtonPanel::set_text(this->foodTributeButton[iVar10],0,temp_str);
            check_food(this);
            return 1;
          }
          RGE_Base_Game::get_player(rge_base_game);
          uVar11 = __ftol();
          sprintf(temp_str + 4,s__ld,uVar11);
          (**(code **)(this->playerFood->_padding_ + 0xe8))(temp_str + 4);
          check_food(this);
          return 1;
        }
        if ((TButtonPanel *)param_1 == ppTVar12[0x10]) {
          iVar8 = check_stone(this);
          if (iVar8 == 0) {
            tc = (TRIBE_Command *)((float)tc - _DAT_0056f890);
            pRVar6 = RGE_Base_Game::get_player(rge_base_game);
            if ((float)tc * _DAT_0056f880 <= pRVar6->attributes[2] - this->stoneTotal) {
              fVar2 = (float)tc * _DAT_0056f894;
              this->foodTributeAmount[iVar16 + 7] =
                   this->foodTributeAmount[iVar16 + 7] - _DAT_0056f894;
              fVar2 = this->stoneTotal - fVar2;
            }
            else {
              pRVar6 = RGE_Base_Game::get_player(rge_base_game);
              fVar2 = (pRVar6->attributes[2] - this->stoneTotal) / (float)tc;
              this->foodTributeAmount[iVar16 + 7] = fVar2 + this->foodTributeAmount[iVar16 + 7];
              fVar2 = fVar2 * (float)tc + this->stoneTotal;
            }
            this->stoneTotal = fVar2;
            RGE_Base_Game::get_player(rge_base_game);
            uVar11 = __ftol();
            sprintf(temp_str + 4,s__ld,uVar11);
            (**(code **)(this->playerStone->_padding_ + 0xe8))(temp_str + 4);
            uVar11 = __ftol();
            sprintf(temp_str,s__ld,uVar11);
            TButtonPanel::set_text(this->stoneTributeButton[iVar10],0,temp_str);
            check_stone(this);
            return 1;
          }
          RGE_Base_Game::get_player(rge_base_game);
          uVar11 = __ftol();
          sprintf(temp_str + 4,s__ld,uVar11);
          (**(code **)(this->playerStone->_padding_ + 0xe8))(temp_str + 4);
          check_stone(this);
          return 1;
        }
        iVar10 = iVar10 + 1;
        ppTVar12 = ppTVar12 + 1;
        iVar16 = iVar16 + 1;
      } while (iVar10 < iVar8);
    }
    goto LAB_0043de3c;
  }
  iVar8 = RGE_Base_Game::singlePlayerGame(rge_base_game);
  if ((iVar8 == 1) && (rge_base_game->save_paused == 0)) {
    RGE_Base_Game::set_paused(rge_base_game,0,0);
  }
LAB_0043dbaa:
  TPanelSystem::setCurrentPanel(&panel_system,s_Game_Screen,0);
  TPanelSystem::destroyPanel(&panel_system,s_Diplomacy_Dialog);
  return 1;
}

// --------------------------------------------------

// Function: check_gold
// Address: 0043e530
int __thiscall TribeDiplomacyDialog::check_gold(TribeDiplomacyDialog *this)
{
  RGE_Player *pRVar1;
  int iVar2;
  TButtonPanel **ppTVar3;
  int iVar4;
  int iVar5;
  
  if ((rge_base_game->prog_mode == 5) ||
     (pRVar1 = RGE_Base_Game::get_player(rge_base_game),
     pRVar1->attributes[3] - this->goldTotal <= _DAT_0056f884)) {
    iVar2 = 1;
  }
  else {
    iVar2 = 0;
  }
  iVar4 = 0;
  ppTVar3 = this->goldTributeButton;
  do {
    if (*ppTVar3 != (TButtonPanel *)0x0) {
      iVar5 = iVar2;
      if (iVar4 == this->cur_player_row) {
        iVar5 = 1;
      }
      TButtonPanel::set_disabled(*ppTVar3,iVar5);
      if (this->tribute_flag == 0) {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(0);
      }
      else {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(1);
      }
    }
    iVar4 = iVar4 + 1;
    ppTVar3 = ppTVar3 + 1;
  } while (iVar4 < 8);
  return iVar2;
}

// --------------------------------------------------

// Function: check_wood
// Address: 0043e5c0
int __thiscall TribeDiplomacyDialog::check_wood(TribeDiplomacyDialog *this)
{
  RGE_Player *pRVar1;
  int iVar2;
  TButtonPanel **ppTVar3;
  int iVar4;
  int iVar5;
  
  if ((rge_base_game->prog_mode == 5) ||
     (pRVar1 = RGE_Base_Game::get_player(rge_base_game),
     pRVar1->attributes[1] - this->woodTotal <= _DAT_0056f884)) {
    iVar2 = 1;
  }
  else {
    iVar2 = 0;
  }
  iVar4 = 0;
  ppTVar3 = this->woodTributeButton;
  do {
    if (*ppTVar3 != (TButtonPanel *)0x0) {
      iVar5 = iVar2;
      if (iVar4 == this->cur_player_row) {
        iVar5 = 1;
      }
      TButtonPanel::set_disabled(*ppTVar3,iVar5);
      if (this->tribute_flag == 0) {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(0);
      }
      else {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(1);
      }
    }
    iVar4 = iVar4 + 1;
    ppTVar3 = ppTVar3 + 1;
  } while (iVar4 < 8);
  return iVar2;
}

// --------------------------------------------------

// Function: check_food
// Address: 0043e650
int __thiscall TribeDiplomacyDialog::check_food(TribeDiplomacyDialog *this)
{
  RGE_Player *pRVar1;
  int iVar2;
  TButtonPanel **ppTVar3;
  int iVar4;
  int iVar5;
  
  if ((rge_base_game->prog_mode == 5) ||
     (pRVar1 = RGE_Base_Game::get_player(rge_base_game),
     *pRVar1->attributes - this->foodTotal <= _DAT_0056f884)) {
    iVar2 = 1;
  }
  else {
    iVar2 = 0;
  }
  iVar4 = 0;
  ppTVar3 = this->foodTributeButton;
  do {
    if (*ppTVar3 != (TButtonPanel *)0x0) {
      iVar5 = iVar2;
      if (iVar4 == this->cur_player_row) {
        iVar5 = 1;
      }
      TButtonPanel::set_disabled(*ppTVar3,iVar5);
      if (this->tribute_flag == 0) {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(0);
      }
      else {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(1);
      }
    }
    iVar4 = iVar4 + 1;
    ppTVar3 = ppTVar3 + 1;
  } while (iVar4 < 8);
  return iVar2;
}

// --------------------------------------------------

// Function: check_stone
// Address: 0043e6e0
int __thiscall TribeDiplomacyDialog::check_stone(TribeDiplomacyDialog *this)
{
  RGE_Player *pRVar1;
  int iVar2;
  TButtonPanel **ppTVar3;
  int iVar4;
  int iVar5;
  
  if ((rge_base_game->prog_mode == 5) ||
     (pRVar1 = RGE_Base_Game::get_player(rge_base_game),
     pRVar1->attributes[2] - this->stoneTotal <= _DAT_0056f884)) {
    iVar2 = 1;
  }
  else {
    iVar2 = 0;
  }
  iVar4 = 0;
  ppTVar3 = this->stoneTributeButton;
  do {
    if (*ppTVar3 != (TButtonPanel *)0x0) {
      iVar5 = iVar2;
      if (iVar4 == this->cur_player_row) {
        iVar5 = 1;
      }
      TButtonPanel::set_disabled(*ppTVar3,iVar5);
      if (this->tribute_flag == 0) {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(0);
      }
      else {
        (**(code **)((*ppTVar3)->_padding_ + 0x14))(1);
      }
    }
    iVar4 = iVar4 + 1;
    ppTVar3 = ppTVar3 + 1;
  } while (iVar4 < 8);
  return iVar2;
}

// --------------------------------------------------

// Function: draw
// Address: 0043e770
void __thiscall TribeDiplomacyDialog::draw(TribeDiplomacyDialog *this)
{
  RGE_Game_World *pRVar1;
  int iVar2;
  int iVar3;
  int iVar4;
  int iVar5;
  int iStack_8;
  
  TEasy_Panel::draw((TEasy_Panel *)this);
  iVar4 = 0;
  if (this->backgroundPics != (TShape *)0x0) {
    iVar3 = this->_padding_;
    pRVar1 = rge_base_game->world;
    (**(code **)(iVar3 + 0x28))(0);
    if (pRVar1->player_num != 1 && -1 < pRVar1->player_num + -1) {
      iVar5 = 0;
      iVar2 = 4;
      do {
        iVar3 = *(int *)(*(int *)((int)pRVar1->players + iVar2) + 0x108);
        if (iVar3 != 0) {
          _ASMSet_Color_Xform((*(short *)(iVar3 + 0x26) + 1) * 0x10);
          TShape::shape_draw(this->backgroundPics,(TDrawArea *)this->_padding_,this->_padding_ + 10,
                             this->_padding_ + 0x50 + iVar4,0,'\x01',
                             (uchar *)(*(int *)(*(int *)((int)pRVar1->players + iVar2) + 0x108) +
                                      0x28));
        }
        iVar4 = iVar4 + 0x1e;
        iVar2 = iVar2 + 4;
        iVar5 = iVar5 + 1;
        iVar3 = iStack_8;
      } while (iVar5 < pRVar1->player_num + -1);
    }
    (**(code **)(iVar3 + 0x2c))();
  }
  return;
}

// --------------------------------------------------

