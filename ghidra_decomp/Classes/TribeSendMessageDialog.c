// Class: TribeSendMessageDialog
// Size:  0x54C
//
// VTable Layout:
// [00] `scalar_deleting_destructor'
// [01] setup
// [02] set_rect
// [03] set_rect
// [04] set_color
// [05] set_active
// [06] set_positioning
// [07] set_fixed_position
// [08] set_redraw
// [09] set_overlapped_redraw
// [10] draw_setup
// [11] draw_finish
// [12] draw
// [13] draw_rect
// [14] draw_offset
// [15] draw_rect2
// [16] draw_offset2
// [17] paint
// [18] wnd_proc
// [19] handle_idle
// [20] handle_size
// [21] handle_paint
// [22] handle_key_down
// [23] handle_char
// [24] handle_command
// [25] handle_user_command
// [26] handle_timer_command
// [27] handle_scroll
// [28] handle_mouse_down
// [29] handle_mouse_move
// [30] handle_mouse_up
// [31] handle_mouse_dbl_click
// [32] mouse_move_action
// [33] mouse_left_down_action
// [34] mouse_left_hold_action
// [35] mouse_left_move_action
// [36] mouse_left_up_action
// [37] mouse_left_dbl_click_action
// [38] mouse_right_down_action
// [39] mouse_right_hold_action
// [40] mouse_right_move_action
// [41] mouse_right_up_action
// [42] mouse_right_dbl_click_action
// [43] key_down_action
// [44] char_action
// [45] action
// [46] get_true_render_rect
// [47] is_inside
// [48] set_focus
// [49] set_tab_order
// [50] set_tab_order
// [51] get_help_info
// [52] stop_sound_system
// [53] restart_sound_system
// [54] take_snapshot
// [55] handle_reactivate
// [56] draw_background
// [57] set_ideal_size
// [58] create_button
// [59] create_button
// [60] create_check_box
// [61] create_radio_button
// [62] create_text
// [63] create_text
// [64] create_text
// [65] create_input
// [66] create_edit
// [67] create_drop_down
// [68] create_list
// [69] create_scrollbar
// [70] create_auto_scrollbar
// [71] create_vert_slider
// [72] create_horz_slider
// [73] position_panel
// [74] setup
// [75] setup
// [76] `vector_deleting_destructor'
// [77] setup
// [78] set_rect
// [79] set_rect
// [80] set_color
// [81] set_active
// [82] set_positioning
// [83] set_fixed_position
// [84] set_redraw
// [85] set_overlapped_redraw
// [86] draw_setup
// [87] draw_finish
// [88] draw
// [89] draw_rect
// [90] draw_offset
// [91] draw_rect2
// [92] draw_offset2
// [93] paint
// [94] wnd_proc
// [95] handle_idle
// [96] handle_size
// [97] handle_paint
// [98] handle_key_down
// [99] handle_char
// [100] handle_command
// [101] handle_user_command
// [102] handle_timer_command
// [103] handle_scroll
// [104] handle_mouse_down
// [105] handle_mouse_move
// [106] handle_mouse_up
// [107] handle_mouse_dbl_click
// [108] mouse_move_action
// [109] mouse_left_down_action
// [110] mouse_left_hold_action
// [111] mouse_left_move_action
// [112] mouse_left_up_action
// [113] mouse_left_dbl_click_action
// [114] mouse_right_down_action
// [115] mouse_right_hold_action
// [116] mouse_right_move_action
// [117] mouse_right_up_action
// [118] mouse_right_dbl_click_action
// [119] key_down_action
// [120] char_action
// [121] action
// [122] get_true_render_rect
// [123] is_inside
// [124] set_focus
// [125] set_tab_order
// [126] set_tab_order
// [127] get_help_info
// [128] stop_sound_system
// [129] restart_sound_system
// [130] take_snapshot
// [131] handle_reactivate
// [132] draw_background
// [133] set_ideal_size
// [134] create_button
// [135] create_button
// [136] create_check_box
// [137] create_radio_button
// [138] create_text
// [139] create_text
// [140] create_text
// [141] create_input
// [142] create_edit
// [143] create_drop_down
// [144] create_list
// [145] create_scrollbar
// [146] create_auto_scrollbar
// [147] create_vert_slider
// [148] create_horz_slider
// [149] position_panel
// [150] setup
// [151] setup
// [152] `scalar_deleting_destructor'
// [153] recycle_in_to_game
// [154] recycle_out_of_game
// [155] draw
// [156] shadow_draw
// [157] normal_draw
// [158] draw_front_frame
// [159] draw_back_frame
// [160] draw_frame
// [161] update
// [162] check_damage_sprites
// [163] rehook
// [164] save
// [165] teleport
// [166] new_sprite
// [167] add_overlay_sprite
// [168] remove_overlay_sprite
// [169] change_ownership
// [170] modify
// [171] modify_delta
// [172] modify_percent
// [173] transform
// [174] copy_obj
// [175] set_object_state
// [176] remove_visible_resource
// [177] create_doppleganger_when_dying
// [178] destroy_obj
// [179] die_die_die
// [180] damage
// [181] calculateDamage
// [182] rotate
// [183] can_attack
// [184] set_attribute
// [185] set_attribute_amount
// [186] heal
// [187] heal
// [188] canRepair
// [189] notify_of_relation
// [190] do_command
// [191] move_to
// [192] work
// [193] stop
// [194] set_attack
// [195] play_command_sound
// [196] play_move_sound
// [197] new_angle
// [198] spawn_death_obj
// [199] get_command_master
// [200] set_being_worked_on
// [201] release_being_worked_on
// [202] is_moving
// [203] get_target_obj
// [204] enter_obj
// [205] exit_obj
// [206] explore_terrain
// [207] unexplore_terrain
// [208] get_los_table
// [209] inAttackRange
// [210] underAttack
// [211] setUnderAttack
// [212] calc_attack_modifier
// [213] getSpeed
// [214] getAngle
// [215] maximumSpeed
// [216] rateOfFire
// [217] damageCapability
// [218] damageCapability
// [219] weaponRange
// [220] minimumWeaponRange
// [221] passableTile
// [222] facetToNextWaypoint
// [223] currentTargetID
// [224] currentTargetX
// [225] currentTargetY
// [226] currentTargetZ
// [227] setWaitingToMove
// [228] waitingToMove
// [229] actionState
// [230] keepGatheringWhenObjectIsOut
// [231] produceWhenKilledBy
// [232] useSameZoneDropsite
// [233] logDebug
// [234] notify
// [235] attack
// [236] attack
// [237] moveTo
// [238] moveTo
// [239] moveTo
// [240] moveAwayFrom
// [241] hunt
// [242] gather
// [243] convert
// [244] repair
// [245] build
// [246] trade
// [247] explore
// [248] enter
// [249] unload
// [250] transport
// [251] stopAction
// [252] pause
// [253] canPath
// [254] canPath
// [255] canBidirectionPath
// [256] canPathWithObstructions
// [257] canPathWithAdditionalPassability
// [258] findFirstTerrainAlongExceptionPath
// [259] canLinePath
// [260] canLinePath
// [261] firstTileAlongLine
// [262] userDefinedWaypoint
// [263] addUserDefinedWaypoint
// [264] removeAllUserDefinedWaypoints
// [265] removeUserDefinedWaypoint
// [266] numberUserDefinedWaypoints
// [267] findAvoidancePath
// [268] get_action_checksum
// [269] get_waypoint_checksum
// [270] setup
// [271] setup
// [272] create_object_list
// [273] create_sprite_list
// [274] setup
// [275] recycle_in_to_game
// [276] validate
// [277] setup
//
// Member Layout:
// [0x490] TTextPanel * title
// [0x494] TTextPanel *[8] playerName (sz: 0x20)
// [0x4B4] TTextPanel *[8] playerCivilization (sz: 0x20)
// [0x4D4] TButtonPanel *[8] checkButton (sz: 0x20)
// [0x4F4] TTextPanel *[4] radioTitle (sz: 0x10)
// [0x504] TButtonPanel *[4] radioButton (sz: 0x10)
// [0x514] TShape * radioButtonShapes
// [0x518] TEditPanel * chatInput
// [0x51C] TTextPanel * chatTitle
// [0x520] TButtonPanel * okButton
// [0x524] TButtonPanel * help_button
// [0x528] TShape * backgroundPics
// [0x52C] int[8] commPlayers (sz: 0x20)
// ----------------------------------------------------------------

// Function: TribeSendMessageDialog
// Address: 004407a0
// [HELPER] s_: ""
// [HELPER] s_Send_Message_Dialog: "Send Message Dialog"
// [HELPER] s_dlg_plbn_shp: "dlg_plbn.shp"
TribeSendMessageDialog * __thiscall
TribeSendMessageDialog::TribeSendMessageDialog(TribeSendMessageDialog *this,TScreenPanel *param_1)
{
  RGE_Game_World *pRVar1;
  TButtonPanel *pTVar2;
  byte bVar3;
  TTextPanel **ppTVar4;
  TButtonPanel **ppTVar5;
  TShape *pTVar6;
  long lVar7;
  char *pcVar8;
  TDrawArea *pTVar9;
  int iVar10;
  int iVar11;
  RGE_Game_World *pRVar12;
  int iVar13;
  uint uVar14;
  int iVar15;
  TButtonPanel **ppTVar16;
  undefined4 *unaff_FS_OFFSET;
  long lVar17;
  long lVar18;
  int iVar19;
  int iVar20;
  int iVar21;
  int i;
  int humanity;
  RGE_Game_World *world;
  int id;
  char temp_str [100];
  undefined4 local_c;
  code *pcStack_8;
  int local_4;
  
  local_4 = 0xffffffff;
  pcStack_8 = FUN_0055d223;
  local_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &local_c;
  temp_str._0_4_ = this;
  TDialogPanel::TDialogPanel((TDialogPanel *)this,s_Send_Message_Dialog);
  local_4 = 0;
  this->_padding_ = (int)&_vftable_;
  this->title = (TTextPanel *)0x0;
  ppTVar4 = this->playerCivilization;
  iVar13 = 8;
  do {
    ppTVar4[-8] = (TTextPanel *)0x0;
    *ppTVar4 = (TTextPanel *)0x0;
    ppTVar4[8] = (TTextPanel *)0x0;
    ppTVar4[0x1e] = (TTextPanel *)0x0;
    ppTVar4 = ppTVar4 + 1;
    iVar13 = iVar13 + -1;
  } while (iVar13 != 0);
  ppTVar5 = this->radioButton;
  iVar13 = 3;
  do {
    ppTVar5[-4] = (TButtonPanel *)0x0;
    *ppTVar5 = (TButtonPanel *)0x0;
    ppTVar5 = ppTVar5 + 1;
    iVar13 = iVar13 + -1;
  } while (iVar13 != 0);
  this->chatInput = (TEditPanel *)0x0;
  this->chatTitle = (TTextPanel *)0x0;
  this->okButton = (TButtonPanel *)0x0;
  this->help_button = (TButtonPanel *)0x0;
  this->backgroundPics = (TShape *)0x0;
  pTVar6 = (TShape *)operator_new(0x20);
  local_4._0_1_ = 1;
  if (pTVar6 == (TShape *)0x0) {
    pTVar6 = (TShape *)0x0;
  }
  else {
    pTVar6 = (TShape *)TShape::TShape(pTVar6,s_dlg_plbn_shp,0xc63a);
  }
  local_4 = (uint)local_4._1_3_ << 8;
  this->backgroundPics = pTVar6;
  if (pTVar6 != (TShape *)0x0) {
    iVar13 = 1;
    lVar7 = TEasy_Panel::get_popup_info_id((TEasy_Panel *)param_1);
    pcVar8 = TEasy_Panel::get_popup_info_file((TEasy_Panel *)param_1);
    lVar18 = 0x1d1;
    lVar17 = 0x208;
    pTVar9 = TPanel::renderArea((TPanel *)param_1);
    iVar13 = TDialogPanel::setup((TDialogPanel *)this,pTVar9,(TPanel *)param_1,lVar17,lVar18,pcVar8,
                                 lVar7,iVar13);
    if ((iVar13 != 0) &&
       (iVar13 = TEasy_Panel::create_text
                           ((TEasy_Panel *)this,(TPanel *)this,&this->title,0x2667,5,10,
                            this->_padding_ + -0x28,0x1e,1,1,1,0), iVar13 != 0)) {
      i = (int)this->checkButton;
      humanity = 1;
      pRVar1 = rge_base_game->world;
      iVar13 = 0x28;
      do {
        iVar10 = RGE_Base_Game::playerID(rge_base_game,humanity);
        if (iVar10 != 0) {
          bVar3 = 0;
          if (pRVar1->players[iVar10]->game_status == '\x02') {
LAB_004409b4:
            bVar3 = 1;
          }
          else {
            iVar11 = RGE_Base_Game::multiplayerGame(rge_base_game);
            if (iVar11 != 0) {
              world = (RGE_Game_World *)0x0;
              uVar14 = 1;
              iVar11 = RGE_Base_Game::numberPlayers(rge_base_game);
              if (0 < iVar11) {
                do {
                  iVar11 = RGE_Base_Game::playerID(rge_base_game,uVar14);
                  if ((iVar11 == iVar10) &&
                     ((pRVar12 = (RGE_Game_World *)
                                 TCommunications_Handler::GetPlayerHumanity(comm,uVar14),
                      pRVar12 == (RGE_Game_World *)0x2 || (pRVar12 == (RGE_Game_World *)0x4)))) {
                    world = pRVar12;
                  }
                  uVar14 = uVar14 + 1;
                  iVar11 = RGE_Base_Game::numberPlayers(rge_base_game);
                } while ((int)uVar14 <= iVar11);
              }
              if ((world != (RGE_Game_World *)0x2) && (world != (RGE_Game_World *)0x4))
              goto LAB_004409b4;
            }
          }
          iVar21 = 0;
          iVar20 = 1;
          iVar15 = (-(uint)bVar3 & 0xfffffffd) + 0xb;
          iVar19 = 0;
          lVar18 = 0x1e;
          lVar17 = 0xbe;
          lVar7 = 0x32;
          iVar11 = iVar13;
          pcVar8 = TCommunications_Handler::GetPlayerName(comm,humanity);
          iVar11 = TEasy_Panel::create_text
                             ((TEasy_Panel *)this,(TPanel *)this,(TTextPanel **)(i + -0x40),pcVar8,
                              lVar7,iVar11,lVar17,lVar18,iVar15,iVar19,iVar20,iVar21);
          if (iVar11 == 0) goto LAB_00440dda;
          (**(code **)(rge_base_game->_padding_ + 0x28))
                    (0x69,pRVar1->players[iVar10]->master_player_id,0,temp_str + 4,100);
          iVar10 = TEasy_Panel::create_text
                             ((TEasy_Panel *)this,(TPanel *)this,(TTextPanel **)(i + -0x20),
                              temp_str + 4,0x104,iVar13,0x78,0x1e,0xb,0,1,0);
          if (iVar10 == 0) goto LAB_00440dda;
          iVar10 = TCommunications_Handler::WhoAmI(comm);
          if ((humanity != iVar10) &&
             ((iVar10 = TCommunications_Handler::GetPlayerHumanity(comm,humanity), iVar10 == 2 ||
              (iVar10 = TCommunications_Handler::GetPlayerHumanity(comm,humanity), iVar10 == 4)))) {
            iVar10 = TEasy_Panel::create_check_box
                               ((TEasy_Panel *)this,(TPanel *)this,(TButtonPanel **)i,10,iVar13,0x1e
                                ,0x1e,0,0);
            if (iVar10 == 0) goto LAB_00440dda;
            TPanel::set_help_info(*(TPanel **)i,0x767f,-1);
            iVar10 = TChat::inChatGroup(chat,humanity);
            if (iVar10 == 0) {
              (**(code **)(**(int **)i + 0xe0))(0);
            }
            else {
              (**(code **)(**(int **)i + 0xe0))(1);
            }
          }
          *(int *)(i + 0x58) = humanity;
          i = i + 4;
          iVar13 = iVar13 + 0x1e;
        }
        humanity = humanity + 1;
      } while (humanity < 9);
      iVar13 = TEasy_Panel::create_text
                         ((TEasy_Panel *)this,(TPanel *)this,&this->chatTitle,0x2668,10,0x13b,0x78,
                          0x1e,4,1,1,0);
      if (iVar13 != 0) {
        iVar13 = TEasy_Panel::create_edit
                           ((TEasy_Panel *)this,(TPanel *)this,&this->chatInput,s_,0x41,FormatText,
                            0x82,0x13b,0x17c,0x17,0xb,1,0);
        if (iVar13 != 0) {
          TPanel::set_help_info((TPanel *)this->chatInput,0x767a,-1);
          ppTVar5 = this->radioButton;
          iVar13 = TEasy_Panel::create_radio_button
                             ((TEasy_Panel *)this,(TPanel *)this,ppTVar5,0x2d,0x15e,0x1e,0x1e,0,0);
          if ((((iVar13 != 0) &&
               (iVar13 = TEasy_Panel::create_radio_button
                                   ((TEasy_Panel *)this,(TPanel *)this,this->radioButton + 1,0x113,
                                    0x15e,0x1e,0x1e,0,0), iVar13 != 0)) &&
              (iVar13 = TEasy_Panel::create_radio_button
                                  ((TEasy_Panel *)this,(TPanel *)this,this->radioButton + 2,0x2d,
                                   0x181,0x1e,0x1e,0,0), iVar13 != 0)) &&
             (iVar13 = TEasy_Panel::create_radio_button
                                 ((TEasy_Panel *)this,(TPanel *)this,this->radioButton + 3,0x113,
                                  0x181,0x1e,0x1e,0,0), iVar13 != 0)) {
            iVar13 = TEasy_Panel::create_text
                               ((TEasy_Panel *)this,(TPanel *)this,this->radioTitle,0x2669,0x4b,
                                0x15e,200,0x1e,0xb,0,1,0);
            if (iVar13 != 0) {
              TPanel::set_help_info((TPanel *)this->radioTitle[0],-1,-1);
              iVar13 = TEasy_Panel::create_text
                                 ((TEasy_Panel *)this,(TPanel *)this,this->radioTitle + 1,0x266a,
                                  0x131,0x15e,200,0x1e,0xb,0,1,0);
              if (iVar13 != 0) {
                TPanel::set_help_info((TPanel *)this->radioTitle[1],-1,-1);
                iVar13 = TEasy_Panel::create_text
                                   ((TEasy_Panel *)this,(TPanel *)this,this->radioTitle + 2,0x266b,
                                    0x4b,0x181,200,0x1e,0xb,0,1,0);
                if (iVar13 != 0) {
                  TPanel::set_help_info((TPanel *)this->radioTitle[2],-1,-1);
                  iVar13 = TEasy_Panel::create_text
                                     ((TEasy_Panel *)this,(TPanel *)this,this->radioTitle + 3,0x266e
                                      ,0x131,0x181,200,0x1e,0xb,0,1,0);
                  if (iVar13 != 0) {
                    TPanel::set_help_info((TPanel *)this->radioTitle[3],-1,-1);
                    iVar13 = 4;
                    ppTVar16 = ppTVar5;
                    do {
                      TButtonPanel::set_radio_info(*ppTVar16,ppTVar5,4);
                      ppTVar16 = ppTVar16 + 1;
                      iVar13 = iVar13 + -1;
                    } while (iVar13 != 0);
                    (**(code **)(this->radioButton[3]->_padding_ + 0xe0))(1);
                    TPanel::set_help_info((TPanel *)*ppTVar5,0x767b,-1);
                    TPanel::set_help_info((TPanel *)this->radioButton[1],0x767c,-1);
                    TPanel::set_help_info((TPanel *)this->radioButton[2],0x767d,-1);
                    TPanel::set_help_info((TPanel *)this->radioButton[3],0x767e,-1);
                    ppTVar5 = &this->okButton;
                    iVar13 = TEasy_Panel::create_button
                                       ((TEasy_Panel *)this,(TPanel *)this,ppTVar5,0x266c,0,100,
                                        0x1a9,300,0x1e,0,0,0);
                    if (iVar13 != 0) {
                      TPanel::set_help_info((TPanel *)*ppTVar5,0x7531,-1);
                      pTVar2 = *ppTVar5;
                      pTVar2->hotkey = 0x1b;
                      pTVar2->hotkey_shift = 0;
                      TPanel::set_curr_child((TPanel *)this,(TPanel *)this->chatInput);
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
LAB_00440dda:
  *unaff_FS_OFFSET = local_c;
  return this;
}

// --------------------------------------------------

// Function: `scalar_deleting_destructor'
// Address: 00440e00
void * __thiscall
TribeSendMessageDialog::_scalar_deleting_destructor_(TribeSendMessageDialog *this,uint param_1)
{
  ~TribeSendMessageDialog(this);
  if ((param_1 & 1) != 0) {
    operator_delete(this);
  }
  return this;
}

// --------------------------------------------------

// Function: ~TribeSendMessageDialog
// Address: 00440e20
void __thiscall TribeSendMessageDialog::~TribeSendMessageDialog(TribeSendMessageDialog *this)
{
  TShape *this_00;
  int iVar1;
  TTextPanel **ppTVar2;
  TButtonPanel **ppTVar3;
  undefined4 *unaff_FS_OFFSET;
  undefined4 local_c;
  code *pcStack_8;
  undefined4 local_4;
  
  pcStack_8 = FUN_0055d238;
  local_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &local_c;
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->title);
  ppTVar2 = this->playerCivilization;
  iVar1 = 8;
  do {
    TPanel::delete_panel((TPanel *)this,(TPanel **)(ppTVar2 + -8));
    TPanel::delete_panel((TPanel *)this,(TPanel **)ppTVar2);
    TPanel::delete_panel((TPanel *)this,(TPanel **)(ppTVar2 + 8));
    ppTVar2 = ppTVar2 + 1;
    iVar1 = iVar1 + -1;
  } while (iVar1 != 0);
  ppTVar3 = this->radioButton;
  iVar1 = 4;
  do {
    TPanel::delete_panel((TPanel *)this,(TPanel **)(ppTVar3 + -4));
    TPanel::delete_panel((TPanel *)this,(TPanel **)ppTVar3);
    ppTVar3 = ppTVar3 + 1;
    iVar1 = iVar1 + -1;
  } while (iVar1 != 0);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->chatInput);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->chatTitle);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->okButton);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->help_button);
  this_00 = this->backgroundPics;
  if (this_00 != (TShape *)0x0) {
    TShape::~TShape(this_00);
    operator_delete(this_00);
  }
  local_4 = 0xffffffff;
  TDialogPanel::~TDialogPanel((TDialogPanel *)this);
  *unaff_FS_OFFSET = local_c;
  return;
}

// --------------------------------------------------

// Function: action
// Address: 00440f20
// [HELPER] s_: ""
// [HELPER] s_Game_Screen: "Game Screen"
// [HELPER] s_Send_Message_Dialog: "Send Message Dialog"
// [HELPER] s_____SEND_CHAT___u___s: "$$$ SEND CHAT @%u: %s"
long __thiscall
TribeSendMessageDialog::action
          (TribeSendMessageDialog *this,TPanel *param_1,long param_2,ulong param_3,ulong param_4)
{
  char cVar1;
  TRIBE_Screen_Game *pTVar2;
  RGE_Player *pRVar3;
  char *pcVar4;
  char *pcVar5;
  int iVar6;
  int iVar7;
  long lVar8;
  uint uVar9;
  uint uVar10;
  TButtonPanel **ppTVar11;
  char *pcVar12;
  char save_msg [66];
  
  if (param_1 == (TPanel *)0x0) {
    lVar8 = TPanel::action((TPanel *)this,(TPanel *)0x0,param_2,param_3,param_4);
    return lVar8;
  }
  if ((TEditPanel *)param_1 == this->chatInput) {
    if (param_2 == 0) {
      pTVar2 = (TRIBE_Screen_Game *)this->_padding_;
      pcVar4 = TEditPanel::currentLine(this->chatInput);
      if ((pcVar4 == (char *)0x0) ||
         (pcVar4 = TEditPanel::currentLine(this->chatInput), *pcVar4 == '\0')) {
        save_msg[4] = '\0';
      }
      else {
        pcVar5 = TEditPanel::currentLine(this->chatInput);
        uVar9 = 0xffffffff;
        pcVar4 = save_msg;
        do {
          pcVar12 = pcVar5;
          if (uVar9 == 0) break;
          uVar9 = uVar9 - 1;
          pcVar12 = pcVar5 + 1;
          cVar1 = *pcVar5;
          pcVar5 = pcVar12;
        } while (cVar1 != '\0');
        uVar9 = ~uVar9;
        pcVar5 = pcVar12 + -uVar9;
        for (uVar10 = uVar9 >> 2; pcVar4 = pcVar4 + 4, uVar10 != 0; uVar10 = uVar10 - 1) {
          *(undefined4 *)pcVar4 = *(undefined4 *)pcVar5;
          pcVar5 = pcVar5 + 4;
        }
        for (uVar9 = uVar9 & 3; uVar9 != 0; uVar9 = uVar9 - 1) {
          *pcVar4 = *pcVar5;
          pcVar5 = pcVar5 + 1;
          pcVar4 = pcVar4 + 1;
        }
      }
      if (save_msg[4] != '\0') {
        iVar6 = (**(code **)(rge_base_game->_padding_ + 0x54))
                          ((int)rge_base_game->world->curr_player,save_msg + 4);
        if (iVar6 == 0) {
          iVar6 = RGE_Base_Game::multiplayerGame(rge_base_game);
          if (iVar6 == 0) {
            RGE_Base_Game::play_sound(rge_base_game,2);
            TRIBE_Screen_Game::display_system_message(pTVar2,&stack0xffffffb4);
          }
          else if (rge_base_game->prog_mode != 5) {
            TCommunications_Handler::SendGroupChatMsg(comm,&stack0xffffffb4);
            TDebuggingLog::Log(L,(char *)L,s_____SEND_CHAT___u___s,rge_base_game->world->world_time,
                               &stack0xffffffb4);
          }
        }
        TEditPanel::set_text(this->chatInput,s_);
        return 1;
      }
    }
  }
  else {
    if ((TButtonPanel *)param_1 == this->okButton) {
      if (param_2 == 1) {
        checkButtons(this);
        pTVar2 = (TRIBE_Screen_Game *)this->_padding_;
        pcVar4 = TEditPanel::currentLine(this->chatInput);
        if ((pcVar4 == (char *)0x0) ||
           (pcVar4 = TEditPanel::currentLine(this->chatInput), *pcVar4 == '\0')) {
          save_msg[4] = '\0';
        }
        else {
          pcVar5 = TEditPanel::currentLine(this->chatInput);
          uVar9 = 0xffffffff;
          pcVar4 = save_msg;
          do {
            pcVar12 = pcVar5;
            if (uVar9 == 0) break;
            uVar9 = uVar9 - 1;
            pcVar12 = pcVar5 + 1;
            cVar1 = *pcVar5;
            pcVar5 = pcVar12;
          } while (cVar1 != '\0');
          uVar9 = ~uVar9;
          pcVar5 = pcVar12 + -uVar9;
          for (uVar10 = uVar9 >> 2; pcVar4 = pcVar4 + 4, uVar10 != 0; uVar10 = uVar10 - 1) {
            *(undefined4 *)pcVar4 = *(undefined4 *)pcVar5;
            pcVar5 = pcVar5 + 4;
          }
          for (uVar9 = uVar9 & 3; uVar9 != 0; uVar9 = uVar9 - 1) {
            *pcVar4 = *pcVar5;
            pcVar5 = pcVar5 + 1;
            pcVar4 = pcVar4 + 1;
          }
        }
        TPanelSystem::setCurrentPanel(&panel_system,s_Game_Screen,0);
        TPanelSystem::destroyPanel(&panel_system,s_Send_Message_Dialog);
        if (save_msg[4] == '\0') {
          return 1;
        }
        iVar6 = (**(code **)(rge_base_game->_padding_ + 0x54))
                          ((int)rge_base_game->world->curr_player,save_msg + 4);
        if (iVar6 != 0) {
          return 1;
        }
        iVar6 = RGE_Base_Game::multiplayerGame(rge_base_game);
        if (iVar6 == 0) {
          RGE_Base_Game::play_sound(rge_base_game,2);
          TRIBE_Screen_Game::display_system_message(pTVar2,&stack0xffffffb4);
          return 1;
        }
        if (rge_base_game->prog_mode == 5) {
          return 1;
        }
        TCommunications_Handler::SendGroupChatMsg(comm,&stack0xffffffb4);
        TDebuggingLog::Log(L,(char *)L,s_____SEND_CHAT___u___s,rge_base_game->world->world_time,
                           &stack0xffffffb4);
        return 1;
      }
    }
    else {
      if ((TButtonPanel *)param_1 == this->help_button) {
        TEasy_Panel::setup_popup_help((TEasy_Panel *)this);
        return 1;
      }
      ppTVar11 = this->checkButton;
      if ((((((TButtonPanel *)param_1 == this->checkButton[0]) ||
            ((TButtonPanel *)param_1 == this->checkButton[1])) ||
           ((TButtonPanel *)param_1 == this->checkButton[2])) ||
          (((TButtonPanel *)param_1 == this->checkButton[3] ||
           ((TButtonPanel *)param_1 == this->checkButton[4])))) ||
         (((TButtonPanel *)param_1 == this->checkButton[5] ||
          (((TButtonPanel *)param_1 == this->checkButton[6] ||
           ((TButtonPanel *)param_1 == this->checkButton[7])))))) {
        (**(code **)(this->radioButton[0]->_padding_ + 0xe0))(0);
        (**(code **)(this->radioButton[1]->_padding_ + 0xe0))(0);
        (**(code **)(this->radioButton[2]->_padding_ + 0xe0))(0);
        (**(code **)(this->radioButton[3]->_padding_ + 0xe0))(1);
      }
      else {
        if ((TButtonPanel *)param_1 == this->radioButton[0]) {
          iVar6 = 8;
          pRVar3 = rge_base_game->world->players[rge_base_game->world->curr_player];
          do {
            if (*ppTVar11 != (TButtonPanel *)0x0) {
              iVar7 = RGE_Base_Game::playerID(rge_base_game,(int)ppTVar11[0x16]);
              if ((iVar7 == pRVar3->id) ||
                 (iVar7 = (**(code **)(pRVar3->_padding_ + 0x1c))(iVar7), iVar7 != 0)) {
                (**(code **)((*ppTVar11)->_padding_ + 0xe0))(1);
              }
              else {
                (**(code **)((*ppTVar11)->_padding_ + 0xe0))(0);
              }
            }
            ppTVar11 = ppTVar11 + 1;
            iVar6 = iVar6 + -1;
          } while (iVar6 != 0);
          checkButtons(this);
          return 1;
        }
        if ((TButtonPanel *)param_1 == this->radioButton[1]) {
          iVar6 = 8;
          pRVar3 = rge_base_game->world->players[rge_base_game->world->curr_player];
          do {
            if (*ppTVar11 != (TButtonPanel *)0x0) {
              iVar7 = RGE_Base_Game::playerID(rge_base_game,(int)ppTVar11[0x16]);
              if ((iVar7 == pRVar3->id) ||
                 (iVar7 = (**(code **)(pRVar3->_padding_ + 0x18))(iVar7), iVar7 == 0)) {
                (**(code **)((*ppTVar11)->_padding_ + 0xe0))(0);
              }
              else {
                (**(code **)((*ppTVar11)->_padding_ + 0xe0))(1);
              }
            }
            ppTVar11 = ppTVar11 + 1;
            iVar6 = iVar6 + -1;
          } while (iVar6 != 0);
          checkButtons(this);
          return 1;
        }
        if ((TButtonPanel *)param_1 != this->radioButton[2]) {
          checkButtons(this);
          return 1;
        }
        if (param_2 == 1) {
          iVar6 = 8;
          do {
            if (*ppTVar11 != (TButtonPanel *)0x0) {
              (**(code **)((*ppTVar11)->_padding_ + 0xe0))(1);
            }
            ppTVar11 = ppTVar11 + 1;
            iVar6 = iVar6 + -1;
          } while (iVar6 != 0);
          checkButtons(this);
          return 1;
        }
      }
    }
    checkButtons(this);
  }
  return 1;
}

// --------------------------------------------------

// Function: checkButtons
// Address: 00441410
void __thiscall TribeSendMessageDialog::checkButtons(TribeSendMessageDialog *this)
{
  int iVar1;
  int *piVar2;
  int iVar3;
  int iVar4;
  
  piVar2 = this->commPlayers;
  iVar3 = 8;
  do {
    if ((*piVar2 != 0) && ((TButtonPanel *)piVar2[-0x16] != (TButtonPanel *)0x0)) {
      iVar1 = TButtonPanel::get_state((TButtonPanel *)piVar2[-0x16]);
      if (iVar1 != 0) {
        iVar4 = *piVar2;
      }
      else {
        iVar4 = *piVar2;
      }
      TChat::setInChatGroup(chat,iVar4,(uint)(iVar1 != 0));
    }
    piVar2 = piVar2 + 1;
    iVar3 = iVar3 + -1;
  } while (iVar3 != 0);
  return;
}

// --------------------------------------------------

// Function: draw
// Address: 00441460
void __thiscall TribeSendMessageDialog::draw(TribeSendMessageDialog *this)
{
  RGE_Game_World *pRVar1;
  RGE_Color_Table *pRVar2;
  int iVar3;
  int iVar4;
  int i;
  int iStack_8;
  
  TEasy_Panel::draw((TEasy_Panel *)this);
  if (this->backgroundPics != (TShape *)0x0) {
    pRVar1 = rge_base_game->world;
    (**(code **)(this->_padding_ + 0x28))(0);
    iVar4 = 0;
    i = 1;
    do {
      iVar3 = RGE_Base_Game::playerID(rge_base_game,i);
      if (iVar3 != 0) {
        pRVar2 = pRVar1->players[iVar3]->color_table;
        if (pRVar2 != (RGE_Color_Table *)0x0) {
          _ASMSet_Color_Xform((pRVar2->id + 1) * 0x10);
          TShape::shape_draw(this->backgroundPics,(TDrawArea *)this->_padding_,
                             this->_padding_ + 0x32,this->_padding_ + 0x28 + iVar4,0,'\x01',
                             pRVar1->players[iVar3]->color_table->table);
        }
        iVar4 = iVar4 + 0x1e;
      }
      i = i + 1;
    } while (i < 9);
    (**(code **)(iStack_8 + 0x2c))();
  }
  return;
}

// --------------------------------------------------

