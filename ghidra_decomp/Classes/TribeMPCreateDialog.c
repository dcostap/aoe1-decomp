// Class: TribeMPCreateDialog
// Size:  0x4A4
//
// VTable Layout:
// [00] `vector_deleting_destructor'
// [01] setup
// [02] set_rect
// [03] set_rect
// [04] set_color
// [05] set_active
// [06] set_positioning
// [07] set_fixed_position
// [08] set_redraw
// [09] set_overlapped_redraw
// [10] draw_setup
// [11] draw_finish
// [12] draw
// [13] draw_rect
// [14] draw_offset
// [15] draw_rect2
// [16] draw_offset2
// [17] paint
// [18] wnd_proc
// [19] handle_idle
// [20] handle_size
// [21] handle_paint
// [22] handle_key_down
// [23] handle_char
// [24] handle_command
// [25] handle_user_command
// [26] handle_timer_command
// [27] handle_scroll
// [28] handle_mouse_down
// [29] handle_mouse_move
// [30] handle_mouse_up
// [31] handle_mouse_dbl_click
// [32] mouse_move_action
// [33] mouse_left_down_action
// [34] mouse_left_hold_action
// [35] mouse_left_move_action
// [36] mouse_left_up_action
// [37] mouse_left_dbl_click_action
// [38] mouse_right_down_action
// [39] mouse_right_hold_action
// [40] mouse_right_move_action
// [41] mouse_right_up_action
// [42] mouse_right_dbl_click_action
// [43] key_down_action
// [44] char_action
// [45] action
// [46] get_true_render_rect
// [47] is_inside
// [48] set_focus
// [49] set_tab_order
// [50] set_tab_order
// [51] get_help_info
// [52] stop_sound_system
// [53] restart_sound_system
// [54] take_snapshot
// [55] handle_reactivate
// [56] draw_background
// [57] set_ideal_size
// [58] create_button
// [59] create_button
// [60] create_check_box
// [61] create_radio_button
// [62] create_text
// [63] create_text
// [64] create_text
// [65] create_input
// [66] create_edit
// [67] create_drop_down
// [68] create_list
// [69] create_scrollbar
// [70] create_auto_scrollbar
// [71] create_vert_slider
// [72] create_horz_slider
// [73] position_panel
// [74] setup
// [75] setup
// [76] `scalar_deleting_destructor'
// [77] setup
// [78] set_rect
// [79] set_rect
// [80] set_color
// [81] set_active
// [82] set_positioning
// [83] set_fixed_position
// [84] set_redraw
// [85] set_overlapped_redraw
// [86] draw_setup
// [87] draw_finish
// [88] draw
// [89] draw_rect
// [90] draw_offset
// [91] draw_rect2
// [92] draw_offset2
// [93] paint
// [94] wnd_proc
// [95] handle_idle
// [96] handle_size
// [97] handle_paint
// [98] handle_key_down
// [99] handle_char
// [100] handle_command
// [101] handle_user_command
// [102] handle_timer_command
// [103] handle_scroll
// [104] handle_mouse_down
// [105] handle_mouse_move
// [106] handle_mouse_up
// [107] handle_mouse_dbl_click
// [108] mouse_move_action
// [109] mouse_left_down_action
// [110] mouse_left_hold_action
// [111] mouse_left_move_action
// [112] mouse_left_up_action
// [113] mouse_left_dbl_click_action
// [114] mouse_right_down_action
// [115] mouse_right_hold_action
// [116] mouse_right_move_action
// [117] mouse_right_up_action
// [118] mouse_right_dbl_click_action
// [119] key_down_action
// [120] char_action
// [121] action
// [122] get_true_render_rect
// [123] is_inside
// [124] set_focus
// [125] set_tab_order
// [126] set_tab_order
// [127] get_help_info
// [128] stop_sound_system
// [129] restart_sound_system
// [130] take_snapshot
// [131] handle_reactivate
// [132] draw_background
// [133] set_ideal_size
// [134] create_button
// [135] create_button
// [136] create_check_box
// [137] create_radio_button
// [138] create_text
// [139] create_text
// [140] create_text
// [141] create_input
// [142] create_edit
// [143] create_drop_down
// [144] create_list
// [145] create_scrollbar
// [146] create_auto_scrollbar
// [147] create_vert_slider
// [148] create_horz_slider
// [149] position_panel
// [150] `vector_deleting_destructor'
// [151] setup
// [152] set_rect
// [153] set_rect
// [154] set_color
// [155] set_active
// [156] set_positioning
// [157] set_fixed_position
// [158] set_redraw
// [159] set_overlapped_redraw
// [160] draw_setup
// [161] draw_finish
// [162] draw
// [163] draw_rect
// [164] draw_offset
// [165] draw_rect2
// [166] draw_offset2
// [167] paint
// [168] wnd_proc
// [169] handle_idle
// [170] handle_size
// [171] handle_paint
// [172] handle_key_down
// [173] handle_char
// [174] handle_command
// [175] handle_user_command
// [176] handle_timer_command
// [177] handle_scroll
// [178] handle_mouse_down
// [179] handle_mouse_move
// [180] handle_mouse_up
// [181] handle_mouse_dbl_click
// [182] mouse_move_action
// [183] mouse_left_down_action
// [184] mouse_left_hold_action
// [185] mouse_left_move_action
// [186] mouse_left_up_action
// [187] mouse_left_dbl_click_action
// [188] mouse_right_down_action
// [189] mouse_right_hold_action
// [190] mouse_right_move_action
// [191] mouse_right_up_action
// [192] mouse_right_dbl_click_action
// [193] key_down_action
// [194] char_action
// [195] action
// [196] get_true_render_rect
// [197] is_inside
// [198] set_focus
// [199] set_tab_order
// [200] set_tab_order
// [201] get_help_info
// [202] stop_sound_system
// [203] restart_sound_system
// [204] take_snapshot
// [205] handle_reactivate
// [206] set_text
// [207] set_text
// [208] set_text
// [209] set_bevel_info
//
// Member Layout:
// [0x490] TTextPanel * title
// [0x494] TTextPanel * input_title
// [0x498] TEditPanel * inputGamename
// [0x49C] TButtonPanel * okButton
// [0x4A0] TButtonPanel * cancelButton
// ----------------------------------------------------------------

// Function: TribeMPCreateDialog
// Address: 004920c0
// [HELPER] s_Create_Dialog: "Create Dialog"
// [HELPER] s_Default_Age_Of_Empires_MP_Gamena: "Default Age Of Empires MP Gamename"
TribeMPCreateDialog * __thiscall
TribeMPCreateDialog::TribeMPCreateDialog(TribeMPCreateDialog *this,TPanel *param_1)
{
  TEditPanel **ppTVar1;
  char cVar2;
  TButtonPanel *pTVar3;
  long lVar4;
  char *pcVar5;
  TDrawArea *pTVar6;
  char *pcVar7;
  uint uVar8;
  uint uVar9;
  char *pcVar10;
  undefined4 *unaff_FS_OFFSET;
  long lVar11;
  long lVar12;
  int iVar13;
  TPanel *tab_list [3];
  char str [256];
  undefined4 local_c;
  code *pcStack_8;
  undefined4 local_4;
  
  local_4 = 0xffffffff;
  pcStack_8 = FUN_0055ea5b;
  local_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &local_c;
  str._0_4_ = this;
  TDialogPanel::TDialogPanel((TDialogPanel *)this,s_Create_Dialog);
  ppTVar1 = &this->inputGamename;
  iVar13 = 1;
  local_4 = 0;
  this->_padding_ = (int)&_vftable_;
  this->title = (TTextPanel *)0x0;
  this->input_title = (TTextPanel *)0x0;
  *ppTVar1 = (TEditPanel *)0x0;
  this->okButton = (TButtonPanel *)0x0;
  this->cancelButton = (TButtonPanel *)0x0;
  lVar4 = TEasy_Panel::get_popup_info_id((TEasy_Panel *)param_1);
  pcVar5 = TEasy_Panel::get_popup_info_file((TEasy_Panel *)param_1);
  lVar12 = 0xe6;
  lVar11 = 500;
  pTVar6 = TPanel::renderArea(param_1);
  iVar13 = TDialogPanel::setup((TDialogPanel *)this,pTVar6,param_1,lVar11,lVar12,pcVar5,lVar4,iVar13
                              );
  if (((iVar13 != 0) &&
      (iVar13 = TEasy_Panel::create_text
                          ((TEasy_Panel *)this,(TPanel *)this,&this->title,0x25a6,0x14,0x14,0x1cc,
                           0x1e,1,1,1,0), iVar13 != 0)) &&
     (iVar13 = TEasy_Panel::create_text
                         ((TEasy_Panel *)this,(TPanel *)this,&this->input_title,0x25aa,0x28,0x55,
                          0x1a4,0x14,4,0,1,0), iVar13 != 0)) {
    pcVar5 = TRegistry::RegGetAscii(Regs,1,s_Default_Age_Of_Empires_MP_Gamena);
    if (pcVar5 == (char *)0x0) {
      str[4] = '\0';
    }
    else {
      pcVar7 = TRegistry::RegGetAscii(Regs,1,s_Default_Age_Of_Empires_MP_Gamena);
      uVar8 = 0xffffffff;
      pcVar5 = str;
      do {
        pcVar10 = pcVar7;
        if (uVar8 == 0) break;
        uVar8 = uVar8 - 1;
        pcVar10 = pcVar7 + 1;
        cVar2 = *pcVar7;
        pcVar7 = pcVar10;
      } while (cVar2 != '\0');
      uVar8 = ~uVar8;
      pcVar7 = pcVar10 + -uVar8;
      for (uVar9 = uVar8 >> 2; pcVar5 = pcVar5 + 4, uVar9 != 0; uVar9 = uVar9 - 1) {
        *(undefined4 *)pcVar5 = *(undefined4 *)pcVar7;
        pcVar7 = pcVar7 + 4;
      }
      for (uVar8 = uVar8 & 3; uVar8 != 0; uVar8 = uVar8 - 1) {
        *pcVar5 = *pcVar7;
        pcVar7 = pcVar7 + 1;
        pcVar5 = pcVar5 + 1;
      }
    }
    iVar13 = TEasy_Panel::create_edit
                       ((TEasy_Panel *)this,(TPanel *)this,ppTVar1,str + 4,0x28,FormatText,0x28,0x6e
                        ,0x1a4,0x17,0xb,1,0);
    if (iVar13 != 0) {
      iVar13 = TEasy_Panel::create_button
                         ((TEasy_Panel *)this,(TPanel *)this,&this->okButton,0xfa1,0,0x3c,0xb4,0xb4,
                          0x1e,0,0,0);
      if (iVar13 != 0) {
        iVar13 = TEasy_Panel::create_button
                           ((TEasy_Panel *)this,(TPanel *)this,&this->cancelButton,0xfa2,0,0x104,
                            0xb4,0xb4,0x1e,0,0,0);
        if (iVar13 != 0) {
          pTVar3 = this->cancelButton;
          pTVar3->hotkey = 0x1b;
          pTVar3->hotkey_shift = 0;
          tab_list[1] = (TPanel *)*ppTVar1;
          tab_list[2] = (TPanel *)this->okButton;
          TPanel::set_tab_order((TPanel *)this,tab_list + 1,3);
          TPanel::set_curr_child((TPanel *)this,(TPanel *)*ppTVar1);
        }
      }
    }
  }
  *unaff_FS_OFFSET = local_c;
  return this;
}

// --------------------------------------------------

// Function: `vector_deleting_destructor'
// Address: 00492310
void * __thiscall
TribeMPCreateDialog::_vector_deleting_destructor_(TribeMPCreateDialog *this,uint param_1)
{
  ~TribeMPCreateDialog(this);
  if ((param_1 & 1) != 0) {
    operator_delete(this);
  }
  return this;
}

// --------------------------------------------------

// Function: ~TribeMPCreateDialog
// Address: 00492330
void __thiscall TribeMPCreateDialog::~TribeMPCreateDialog(TribeMPCreateDialog *this)
{
  undefined4 *unaff_FS_OFFSET;
  undefined4 local_c;
  code *pcStack_8;
  undefined4 local_4;
  
  pcStack_8 = FUN_0055ea78;
  local_c = *unaff_FS_OFFSET;
  *unaff_FS_OFFSET = &local_c;
  this->_padding_ = (int)&_vftable_;
  local_4 = 0;
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->title);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->input_title);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->inputGamename);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->okButton);
  TPanel::delete_panel((TPanel *)this,(TPanel **)&this->cancelButton);
  local_4 = 0xffffffff;
  TDialogPanel::~TDialogPanel((TDialogPanel *)this);
  *unaff_FS_OFFSET = local_c;
  return;
}

// --------------------------------------------------

// Function: action
// Address: 004923c0
// [HELPER] s_Create_Dialog: "Create Dialog"
// [HELPER] s_Default_Age_Of_Empires_MP_Gamena: "Default Age Of Empires MP Gamename"
// [HELPER] s_Join_Screen: "Join Screen"
// [HELPER] s_MP_Setup_Screen: "MP Setup Screen"
// [HELPER] s_Status_Screen: "Status Screen"
// [HELPER] s_____CALLING_CreateMultiplayerGam: "$$$ CALLING CreateMultiplayerGame"
// [HELPER] s_____RETURNED_FROM_CreateMultipla: "$$$ RETURNED FROM CreateMultiplayerGame"
// [HELPER] s_closedpw: "closedpw"
// [HELPER] s_data_closedpw_exe: "data\closedpw.exe"
// [HELPER] s_scr3: "scr3"
long __thiscall
TribeMPCreateDialog::action
          (TribeMPCreateDialog *this,TPanel *param_1,long param_2,ulong param_3,ulong param_4)
{
  char cVar1;
  int *piVar2;
  TEasy_Panel *this_00;
  int iVar3;
  long lVar4;
  char *pcVar5;
  uchar *puVar6;
  int iVar7;
  TribeMPSetupScreen *this_01;
  uint uVar8;
  ulong *puVar9;
  undefined4 *unaff_FS_OFFSET;
  bool bVar10;
  ulong local_1c;
  undefined4 local_18;
  undefined4 local_14;
  undefined4 local_10;
  undefined4 local_c;
  code *pcStack_8;
  undefined4 uStack_4;
  
  local_c = *unaff_FS_OFFSET;
  uStack_4 = 0xffffffff;
  pcStack_8 = FUN_0055ea9b;
  *unaff_FS_OFFSET = &local_c;
  if (param_1 != (TPanel *)0x0) {
    if ((((TButtonPanel *)param_1 == this->okButton) && (param_2 == 1)) ||
       (((TEditPanel *)param_1 == this->inputGamename && (param_2 == 0)))) {
      iVar3 = TEditPanel::is_blank(this->inputGamename);
      if (iVar3 == 0) {
        RGE_Base_Game::disable_input(rge_base_game);
        pcVar5 = TEditPanel::currentLine(this->inputGamename);
        uVar8 = 0xffffffff;
        do {
          if (uVar8 == 0) break;
          uVar8 = uVar8 - 1;
          cVar1 = *pcVar5;
          pcVar5 = pcVar5 + 1;
        } while (cVar1 != '\0');
        uVar8 = ~uVar8;
        puVar6 = (uchar *)TEditPanel::currentLine(this->inputGamename);
        TRegistry::RegSetAscii(Regs,1,s_Default_Age_Of_Empires_MP_Gamena,puVar6,uVar8);
        pcVar5 = TEditPanel::currentLine(this->inputGamename);
        TCommunications_Handler::SetGameTitle(comm,pcVar5);
        piVar2 = (int *)this->_padding_;
        TDebuggingLog::Log(L,(char *)L,s_____CALLING_CreateMultiplayerGam);
        TPanelSystem::setCurrentPanel(&panel_system,s_Join_Screen,0);
        RGE_Base_Game::draw_window(rge_base_game);
        local_1c = (comm->ServiceGUID).Data1;
        local_18._0_2_ = (comm->ServiceGUID).Data2;
        local_18._2_2_ = (comm->ServiceGUID).Data3;
        local_14 = *(undefined4 *)(comm->ServiceGUID).Data4;
        bVar10 = true;
        local_10 = *(undefined4 *)((comm->ServiceGUID).Data4 + 4);
        iVar3 = 0x10;
        puVar9 = &local_1c;
        pcVar5 = &_DPSPGUID_TCPIP;
        do {
          if (iVar3 == 0) break;
          iVar3 = iVar3 + -1;
          bVar10 = (char)*puVar9 == *pcVar5;
          puVar9 = (ulong *)((int)puVar9 + 1);
          pcVar5 = pcVar5 + 1;
        } while (bVar10);
        if (bVar10) {
          iVar3 = 0x4c3;
        }
        else {
          iVar3 = 0x4c2;
        }
        TRIBE_Game::show_status_message((TRIBE_Game *)rge_base_game,iVar3,&s_scr3,0xc385);
        RGE_Base_Game::draw_window(rge_base_game);
        WinExec(s_data_closedpw_exe,0);
        iVar3 = *piVar2;
        if ((*(char *)(iVar3 + 0x478) == '\x02') && (*(char *)(iVar3 + 0x479) == '\x02')) {
          (**(code **)(**(int **)(iVar3 + 0x18) + 0x28))(*(int **)(iVar3 + 0x18));
        }
        puVar9 = comm->PlayerStopTurn;
        for (iVar3 = 9; puVar9 = puVar9 + 1, iVar3 != 0; iVar3 = iVar3 + -1) {
          *puVar9 = 0;
        }
        iVar3 = TCommunications_Handler::CreateMultiplayerGame(comm);
        TDebuggingLog::Log(L,(char *)L,s_____RETURNED_FROM_CreateMultipla);
        iVar7 = FindWindowA(s_closedpw,s_closedpw);
        if (iVar7 != 0) {
          SendMessageA(iVar7,0x10,0,0);
        }
        if (iVar3 == 0) {
          this_00 = (TEasy_Panel *)this->_padding_;
          TPanelSystem::destroyPanel(&panel_system,s_Create_Dialog);
          TPanelSystem::setCurrentPanel(&panel_system,s_Join_Screen,0);
          TPanelSystem::destroyPanel(&panel_system,s_Status_Screen);
          TEasy_Panel::popupOKDialog(this_00,0x25ad,(char *)0x0,0x1c2,100);
          lVar4 = 1;
        }
        else {
          this_01 = (TribeMPSetupScreen *)operator_new(0x890);
          uStack_4 = 0;
          if (this_01 != (TribeMPSetupScreen *)0x0) {
            TribeMPSetupScreen::TribeMPSetupScreen(this_01);
          }
          uStack_4 = 0xffffffff;
          TPanelSystem::setCurrentPanel(&panel_system,s_MP_Setup_Screen,0);
          TPanelSystem::destroyPanel(&panel_system,s_Status_Screen);
          TPanelSystem::destroyPanel(&panel_system,s_Create_Dialog);
          TPanelSystem::destroyPanel(&panel_system,s_Join_Screen);
          lVar4 = 1;
        }
      }
      else {
        TPanel::set_curr_child((TPanel *)this,(TPanel *)this->inputGamename);
        lVar4 = 1;
      }
      goto LAB_004926c1;
    }
    if ((((TButtonPanel *)param_1 == this->cancelButton) && (param_2 == 1)) ||
       (((TEditPanel *)param_1 == this->inputGamename && (param_2 == 1)))) {
      TPanelSystem::setCurrentPanel(&panel_system,s_Join_Screen,0);
      TPanelSystem::destroyPanel(&panel_system,s_Create_Dialog);
      lVar4 = 1;
      goto LAB_004926c1;
    }
  }
  lVar4 = TPanel::action((TPanel *)this,param_1,param_2,param_3,param_4);
LAB_004926c1:
  *unaff_FS_OFFSET = local_c;
  return lVar4;
}

// --------------------------------------------------

